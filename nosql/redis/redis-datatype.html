<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis æ•°æ®ç±»å‹ | DB-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/db-tutorial/favicon.ico">
    <meta name="description" content="æ•°æ®åº“æ•™ç¨‹">
    
    <link rel="preload" href="/db-tutorial/assets/css/0.styles.f78e4e1a.css" as="style"><link rel="preload" href="/db-tutorial/assets/js/app.3241dbe7.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/4.4288f8e2.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/52.780ee075.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/5.9d6e4fe2.js" as="script"><link rel="prefetch" href="/db-tutorial/assets/js/10.ed8ad29b.js"><link rel="prefetch" href="/db-tutorial/assets/js/11.fe610bae.js"><link rel="prefetch" href="/db-tutorial/assets/js/12.a246bf62.js"><link rel="prefetch" href="/db-tutorial/assets/js/13.3e80d87c.js"><link rel="prefetch" href="/db-tutorial/assets/js/14.550882cc.js"><link rel="prefetch" href="/db-tutorial/assets/js/15.5e1b41b9.js"><link rel="prefetch" href="/db-tutorial/assets/js/16.6bca419e.js"><link rel="prefetch" href="/db-tutorial/assets/js/17.a5628e11.js"><link rel="prefetch" href="/db-tutorial/assets/js/18.11142214.js"><link rel="prefetch" href="/db-tutorial/assets/js/19.b7dd25b2.js"><link rel="prefetch" href="/db-tutorial/assets/js/20.743a9fc2.js"><link rel="prefetch" href="/db-tutorial/assets/js/21.bb9e859e.js"><link rel="prefetch" href="/db-tutorial/assets/js/22.8793bf57.js"><link rel="prefetch" href="/db-tutorial/assets/js/23.aa1a0789.js"><link rel="prefetch" href="/db-tutorial/assets/js/24.989edd40.js"><link rel="prefetch" href="/db-tutorial/assets/js/25.f951c2ea.js"><link rel="prefetch" href="/db-tutorial/assets/js/26.46d14ec4.js"><link rel="prefetch" href="/db-tutorial/assets/js/27.bbb4d038.js"><link rel="prefetch" href="/db-tutorial/assets/js/28.ca5b12bf.js"><link rel="prefetch" href="/db-tutorial/assets/js/29.ed8acf51.js"><link rel="prefetch" href="/db-tutorial/assets/js/30.4c80e86e.js"><link rel="prefetch" href="/db-tutorial/assets/js/31.270d3076.js"><link rel="prefetch" href="/db-tutorial/assets/js/32.63fd0b9f.js"><link rel="prefetch" href="/db-tutorial/assets/js/33.71243bd6.js"><link rel="prefetch" href="/db-tutorial/assets/js/34.e1c65173.js"><link rel="prefetch" href="/db-tutorial/assets/js/35.535365fb.js"><link rel="prefetch" href="/db-tutorial/assets/js/36.269fbb7d.js"><link rel="prefetch" href="/db-tutorial/assets/js/37.54d40d65.js"><link rel="prefetch" href="/db-tutorial/assets/js/38.70c2df36.js"><link rel="prefetch" href="/db-tutorial/assets/js/39.720ed2bc.js"><link rel="prefetch" href="/db-tutorial/assets/js/40.42f49b04.js"><link rel="prefetch" href="/db-tutorial/assets/js/41.816b4788.js"><link rel="prefetch" href="/db-tutorial/assets/js/42.7812fbfa.js"><link rel="prefetch" href="/db-tutorial/assets/js/43.40e17f2b.js"><link rel="prefetch" href="/db-tutorial/assets/js/44.d4bf4d23.js"><link rel="prefetch" href="/db-tutorial/assets/js/45.de070dec.js"><link rel="prefetch" href="/db-tutorial/assets/js/46.72b9fb0c.js"><link rel="prefetch" href="/db-tutorial/assets/js/47.0d15ed92.js"><link rel="prefetch" href="/db-tutorial/assets/js/48.62942aa8.js"><link rel="prefetch" href="/db-tutorial/assets/js/49.5cc48c74.js"><link rel="prefetch" href="/db-tutorial/assets/js/50.05a3829b.js"><link rel="prefetch" href="/db-tutorial/assets/js/51.c4a344da.js"><link rel="prefetch" href="/db-tutorial/assets/js/53.db2f332a.js"><link rel="prefetch" href="/db-tutorial/assets/js/54.0e78a0f9.js"><link rel="prefetch" href="/db-tutorial/assets/js/55.6541a955.js"><link rel="prefetch" href="/db-tutorial/assets/js/56.148da909.js"><link rel="prefetch" href="/db-tutorial/assets/js/57.c474daee.js"><link rel="prefetch" href="/db-tutorial/assets/js/58.c896e61d.js"><link rel="prefetch" href="/db-tutorial/assets/js/59.078e1f3a.js"><link rel="prefetch" href="/db-tutorial/assets/js/6.11804af7.js"><link rel="prefetch" href="/db-tutorial/assets/js/60.1169b208.js"><link rel="prefetch" href="/db-tutorial/assets/js/61.31b49b6a.js"><link rel="prefetch" href="/db-tutorial/assets/js/62.5e22d6f5.js"><link rel="prefetch" href="/db-tutorial/assets/js/63.d0836f60.js"><link rel="prefetch" href="/db-tutorial/assets/js/64.1e454e0d.js"><link rel="prefetch" href="/db-tutorial/assets/js/65.862548ea.js"><link rel="prefetch" href="/db-tutorial/assets/js/66.597479ba.js"><link rel="prefetch" href="/db-tutorial/assets/js/67.c19ec16c.js"><link rel="prefetch" href="/db-tutorial/assets/js/68.7794c626.js"><link rel="prefetch" href="/db-tutorial/assets/js/69.a99ae4f0.js"><link rel="prefetch" href="/db-tutorial/assets/js/7.d55602d2.js"><link rel="prefetch" href="/db-tutorial/assets/js/70.34e977d4.js"><link rel="prefetch" href="/db-tutorial/assets/js/71.c1b90167.js"><link rel="prefetch" href="/db-tutorial/assets/js/72.9792a914.js"><link rel="prefetch" href="/db-tutorial/assets/js/73.6fbf9550.js"><link rel="prefetch" href="/db-tutorial/assets/js/74.b8949f4c.js"><link rel="prefetch" href="/db-tutorial/assets/js/75.3c3abd9f.js"><link rel="prefetch" href="/db-tutorial/assets/js/76.729c9c46.js"><link rel="prefetch" href="/db-tutorial/assets/js/77.a1a0aa21.js"><link rel="prefetch" href="/db-tutorial/assets/js/8.89e9ace9.js"><link rel="prefetch" href="/db-tutorial/assets/js/9.0c40eb95.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~flowchart.5998caa6.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~notification.943e54fe.js">
    <link rel="stylesheet" href="/db-tutorial/assets/css/0.styles.f78e4e1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/db-tutorial/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="DB-TUTORIAL" class="logo"> <span class="site-name can-hide">DB-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/db-tutorial/sql/" class="nav-link">
  SQL
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/" class="nav-link router-link-active">
  NOSQL
</a></div><div class="nav-item"><a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/elasticsearch/" class="nav-link">
  Elasticsearch
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/mongodb/" class="nav-link">
  MongoDB
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/db-tutorial/sql/" class="nav-link">
  SQL
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/" class="nav-link router-link-active">
  NOSQL
</a></div><div class="nav-item"><a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/elasticsearch/" class="nav-link">
  Elasticsearch
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/mongodb/" class="nav-link">
  MongoDB
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis æ•°æ®ç±»å‹</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/nosql/redis/redis-datatype.html#ä¸€ã€redis-åŸºæœ¬æ•°æ®ç±»å‹" class="sidebar-link">ä¸€ã€Redis åŸºæœ¬æ•°æ®ç±»å‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#string" class="sidebar-link">STRING</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#hash" class="sidebar-link">HASH</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#list" class="sidebar-link">LIST</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#set" class="sidebar-link">SET</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#zset" class="sidebar-link">ZSET</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#é€šç”¨å‘½ä»¤" class="sidebar-link">é€šç”¨å‘½ä»¤</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-datatype.html#äºŒã€redis-é«˜çº§æ•°æ®ç±»å‹" class="sidebar-link">äºŒã€Redis é«˜çº§æ•°æ®ç±»å‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#bitmap" class="sidebar-link">BitMap</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#hyperloglog" class="sidebar-link">HyperLogLog</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#geo" class="sidebar-link">GEO</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-datatype.html#ä¸‰ã€redis-æ•°æ®ç±»å‹åº”ç”¨" class="sidebar-link">ä¸‰ã€Redis æ•°æ®ç±»å‹åº”ç”¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-æœ€å—æ¬¢è¿æ–‡ç« " class="sidebar-link">æ¡ˆä¾‹-æœ€å—æ¬¢è¿æ–‡ç« </a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-ç®¡ç†ä»¤ç‰Œ" class="sidebar-link">æ¡ˆä¾‹-ç®¡ç†ä»¤ç‰Œ</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-è´­ç‰©è½¦" class="sidebar-link">æ¡ˆä¾‹-è´­ç‰©è½¦</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-é¡µé¢ç¼“å­˜" class="sidebar-link">æ¡ˆä¾‹-é¡µé¢ç¼“å­˜</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-æ•°æ®è¡Œç¼“å­˜" class="sidebar-link">æ¡ˆä¾‹-æ•°æ®è¡Œç¼“å­˜</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-ç½‘é¡µåˆ†æ" class="sidebar-link">æ¡ˆä¾‹-ç½‘é¡µåˆ†æ</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-è®°å½•æ—¥å¿—" class="sidebar-link">æ¡ˆä¾‹-è®°å½•æ—¥å¿—</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-ç»Ÿè®¡æ•°æ®" class="sidebar-link">æ¡ˆä¾‹-ç»Ÿè®¡æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-æŸ¥æ‰¾-ip-æ‰€å±åœ°" class="sidebar-link">æ¡ˆä¾‹-æŸ¥æ‰¾ IP æ‰€å±åœ°</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-æœåŠ¡çš„å‘ç°ä¸é…ç½®" class="sidebar-link">æ¡ˆä¾‹-æœåŠ¡çš„å‘ç°ä¸é…ç½®</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-è‡ªåŠ¨è¡¥å…¨" class="sidebar-link">æ¡ˆä¾‹-è‡ªåŠ¨è¡¥å…¨</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-å¹¿å‘Šå®šå‘" class="sidebar-link">æ¡ˆä¾‹-å¹¿å‘Šå®šå‘</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/redis/redis-datatype.html#æ¡ˆä¾‹-èŒä½æœç´¢" class="sidebar-link">æ¡ˆä¾‹-èŒä½æœç´¢</a></li></ul></li><li><a href="/db-tutorial/nosql/redis/redis-datatype.html#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis-æ•°æ®ç±»å‹"><a href="#redis-æ•°æ®ç±»å‹" class="header-anchor">#</a> Redis æ•°æ®ç±»å‹</h1> <blockquote><p>Redis æä¾›äº†å¤šç§æ•°æ®ç±»å‹ï¼Œæ¯ç§æ•°æ®ç±»å‹æœ‰ä¸°å¯Œçš„å‘½ä»¤æ”¯æŒã€‚</p> <p>ä½¿ç”¨ Redis ï¼Œä¸ä»…è¦äº†è§£å…¶æ•°æ®ç±»å‹çš„ç‰¹æ€§ï¼Œè¿˜éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œçµæ´»çš„ã€é«˜æ•ˆçš„ä½¿ç”¨å…¶æ•°æ®ç±»å‹æ¥å»ºæ¨¡ã€‚</p></blockquote> <ul><li><a href="#%E4%B8%80redis-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">ä¸€ã€Redis åŸºæœ¬æ•°æ®ç±»å‹</a> <ul><li><a href="#string">STRING</a></li> <li><a href="#hash">HASH</a></li> <li><a href="#list">LIST</a></li> <li><a href="#set">SET</a></li> <li><a href="#zset">ZSET</a></li> <li><a href="#%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4">é€šç”¨å‘½ä»¤</a></li></ul></li> <li><a href="#%E4%BA%8Credis-%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">äºŒã€Redis é«˜çº§æ•°æ®ç±»å‹</a> <ul><li><a href="#bitmap">BitMap</a></li> <li><a href="#hyperloglog">HyperLogLog</a></li> <li><a href="#geo">GEO</a></li></ul></li> <li><a href="#%E4%B8%89redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%BA%94%E7%94%A8">ä¸‰ã€Redis æ•°æ®ç±»å‹åº”ç”¨</a> <ul><li><a href="#%E6%A1%88%E4%BE%8B-%E6%9C%80%E5%8F%97%E6%AC%A2%E8%BF%8E%E6%96%87%E7%AB%A0">æ¡ˆä¾‹-æœ€å—æ¬¢è¿æ–‡ç« </a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E7%AE%A1%E7%90%86%E4%BB%A4%E7%89%8C">æ¡ˆä¾‹-ç®¡ç†ä»¤ç‰Œ</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E8%B4%AD%E7%89%A9%E8%BD%A6">æ¡ˆä¾‹-è´­ç‰©è½¦</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E9%A1%B5%E9%9D%A2%E7%BC%93%E5%AD%98">æ¡ˆä¾‹-é¡µé¢ç¼“å­˜</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E6%95%B0%E6%8D%AE%E8%A1%8C%E7%BC%93%E5%AD%98">æ¡ˆä¾‹-æ•°æ®è¡Œç¼“å­˜</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E7%BD%91%E9%A1%B5%E5%88%86%E6%9E%90">æ¡ˆä¾‹-ç½‘é¡µåˆ†æ</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97">æ¡ˆä¾‹-è®°å½•æ—¥å¿—</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE">æ¡ˆä¾‹-ç»Ÿè®¡æ•°æ®</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E6%9F%A5%E6%89%BE-ip-%E6%89%80%E5%B1%9E%E5%9C%B0">æ¡ˆä¾‹-æŸ¥æ‰¾ IP æ‰€å±åœ°</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%8F%91%E7%8E%B0%E4%B8%8E%E9%85%8D%E7%BD%AE">æ¡ˆä¾‹-æœåŠ¡çš„å‘ç°ä¸é…ç½®</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8">æ¡ˆä¾‹-è‡ªåŠ¨è¡¥å…¨</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E5%B9%BF%E5%91%8A%E5%AE%9A%E5%90%91">æ¡ˆä¾‹-å¹¿å‘Šå®šå‘</a></li> <li><a href="#%E6%A1%88%E4%BE%8B-%E8%81%8C%E4%BD%8D%E6%90%9C%E7%B4%A2">æ¡ˆä¾‹-èŒä½æœç´¢</a></li></ul></li> <li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li></ul> <h2 id="ä¸€ã€redis-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#ä¸€ã€redis-åŸºæœ¬æ•°æ®ç±»å‹" class="header-anchor">#</a> ä¸€ã€Redis åŸºæœ¬æ•°æ®ç±»å‹</h2> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200226113813.png" alt="Redis æ•°æ®ç±»å‹"></p> <table><thead><tr><th>æ•°æ®ç±»å‹</th> <th>å¯ä»¥å­˜å‚¨çš„å€¼</th> <th>æ“ä½œ</th></tr></thead> <tbody><tr><td>STRING</td> <td>å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°</td> <td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œ<br> å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢æˆ–è€…è‡ªå‡æ“ä½œ</td></tr> <tr><td>LIST</td> <td>åˆ—è¡¨</td> <td>ä»ä¸¤ç«¯å‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ <br> è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ <br> è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td></tr> <tr><td>SET</td> <td>æ— åºé›†åˆ</td> <td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ <br> æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­<br> è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†<br> ä»é›†åˆé‡Œé¢éšæœºè·å–å…ƒç´ </td></tr> <tr><td>HASH</td> <td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td> <td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹<br> è·å–æ‰€æœ‰é”®å€¼å¯¹<br> æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦å­˜åœ¨</td></tr> <tr><td>ZSET</td> <td>æœ‰åºé›†åˆ</td> <td>æ·»åŠ ã€è·å–ã€åˆ é™¤å…ƒç´ <br> æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ <br> è®¡ç®—ä¸€ä¸ªé”®çš„æ’å</td></tr></tbody></table> <blockquote><p><a href="https://redislabs.com/ebook/part-1-getting-started/chapter-1-getting-to-know-redis/1-2-what-redis-data-structures-look-like/" target="_blank" rel="noopener noreferrer">What Redis data structures look like<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="string"><a href="#string" class="header-anchor">#</a> STRING</h3> <div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/redis/redis-datatype-string.png" width="400"></div>
**é€‚ç”¨åœºæ™¯ï¼šç¼“å­˜ã€è®¡æ•°å™¨ã€å…±äº« Session**
<p>å‘½ä»¤ï¼š</p> <table><thead><tr><th>å‘½ä»¤</th> <th>è¡Œä¸º</th></tr></thead> <tbody><tr><td><code>GET</code></td> <td>è·å–å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼ã€‚</td></tr> <tr><td><code>SET</code></td> <td>è®¾ç½®å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼ã€‚</td></tr> <tr><td><code>DEL</code></td> <td>åˆ é™¤å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼ï¼ˆè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨äºæ‰€æœ‰ç±»å‹ï¼‰ã€‚</td></tr> <tr><td><code>INCR</code></td> <td>ä¸ºé”® <code>key</code> å‚¨å­˜çš„æ•°å­—å€¼åŠ ä¸€</td></tr> <tr><td><code>DECR</code></td> <td>ä¸ºé”® <code>key</code> å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€</td></tr></tbody></table> <blockquote><p>æ›´å¤šå‘½ä»¤è¯·å‚è€ƒï¼š<a href="https://redis.io/commands#string" target="_blank" rel="noopener noreferrer">Redis String ç±»å‹å‘½ä»¤<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> hello world
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get hello
<span class="token string">&quot;world&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> del hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get hello
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre></div><h3 id="hash"><a href="#hash" class="header-anchor">#</a> HASH</h3> <div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/redis/redis-datatype-hash.png" width="400"></div>
**é€‚ç”¨åœºæ™¯ï¼šå­˜å‚¨ç»“æ„åŒ–æ•°æ®**ï¼Œå¦‚ä¸€ä¸ªå¯¹è±¡ï¼šç”¨æˆ·ä¿¡æ¯ã€äº§å“ä¿¡æ¯ç­‰ã€‚
<p>å‘½ä»¤ï¼š</p> <table><thead><tr><th>å‘½ä»¤</th> <th>è¡Œä¸º</th></tr></thead> <tbody><tr><td><code>HSET</code></td> <td>åœ¨æ•£åˆ—é‡Œé¢å…³è”èµ·ç»™å®šçš„é”®å€¼å¯¹ã€‚</td></tr> <tr><td><code>HGET</code></td> <td>è·å–æŒ‡å®šæ•£åˆ—é”®çš„å€¼ã€‚</td></tr> <tr><td><code>HGETALL</code></td> <td>è·å–æ•£åˆ—åŒ…å«çš„æ‰€æœ‰é”®å€¼å¯¹ã€‚</td></tr> <tr><td><code>HDEL</code></td> <td>å¦‚æœç»™å®šé”®å­˜åœ¨äºæ•£åˆ—é‡Œé¢ï¼Œé‚£ä¹ˆç§»é™¤è¿™ä¸ªé”®ã€‚</td></tr></tbody></table> <blockquote><p>æ›´å¤šå‘½ä»¤è¯·å‚è€ƒï¼š<a href="https://redis.io/commands#hash" target="_blank" rel="noopener noreferrer">Redis Hash ç±»å‹å‘½ä»¤<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hset hash-key sub-key1 value1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hset hash-key sub-key2 value2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hset hash-key sub-key1 value1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hset hash-key sub-key3 value2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hgetall hash-key
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;sub-key1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;value1&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;sub-key2&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;value2&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hdel hash-key sub-key2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hdel hash-key sub-key2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hget hash-key sub-key1
<span class="token string">&quot;value1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hgetall hash-key
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;sub-key1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;value1&quot;</span>
</code></pre></div><h3 id="list"><a href="#list" class="header-anchor">#</a> LIST</h3> <div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/redis/redis-datatype-list.png" width="400"></div>
**é€‚ç”¨åœºæ™¯ï¼šç”¨äºå­˜å‚¨åˆ—è¡¨å‹æ•°æ®**ã€‚å¦‚ï¼šç²‰ä¸åˆ—è¡¨ã€å•†å“åˆ—è¡¨ç­‰ã€‚
<p>å‘½ä»¤ï¼š</p> <table><thead><tr><th>å‘½ä»¤</th> <th>è¡Œä¸º</th></tr></thead> <tbody><tr><td><code>LPUSH</code></td> <td>å°†ç»™å®šå€¼æ¨å…¥åˆ—è¡¨çš„å³ç«¯ã€‚</td></tr> <tr><td><code>RPUSH</code></td> <td>å°†ç»™å®šå€¼æ¨å…¥åˆ—è¡¨çš„å³ç«¯ã€‚</td></tr> <tr><td><code>LPOP</code></td> <td>ä»åˆ—è¡¨çš„å·¦ç«¯å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›è¢«å¼¹å‡ºçš„å€¼ã€‚</td></tr> <tr><td><code>RPOP</code></td> <td>ä»åˆ—è¡¨çš„å³ç«¯å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›è¢«å¼¹å‡ºçš„å€¼ã€‚</td></tr> <tr><td><code>LRANGE</code></td> <td>è·å–åˆ—è¡¨åœ¨ç»™å®šèŒƒå›´ä¸Šçš„æ‰€æœ‰å€¼ã€‚</td></tr> <tr><td><code>LINDEX</code></td> <td>è·å–åˆ—è¡¨åœ¨ç»™å®šä½ç½®ä¸Šçš„å•ä¸ªå…ƒç´ ã€‚</td></tr> <tr><td><code>LREM</code></td> <td>ä»åˆ—è¡¨çš„å·¦ç«¯å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›è¢«å¼¹å‡ºçš„å€¼ã€‚</td></tr> <tr><td><code>LTRIM</code></td> <td>åªä¿ç•™æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼Œåˆ é™¤å…¶ä»–å…ƒç´ ã€‚</td></tr></tbody></table> <blockquote><p>æ›´å¤šå‘½ä»¤è¯·å‚è€ƒï¼š<a href="https://redis.io/commands#list" target="_blank" rel="noopener noreferrer">Redis List ç±»å‹å‘½ä»¤<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> rpush list-key item
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> rpush list-key item2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> rpush list-key item
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list-key <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;item&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;item2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;item&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lindex list-key <span class="token number">1</span>
<span class="token string">&quot;item2&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lpop list-key
<span class="token string">&quot;item&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list-key <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;item2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;item&quot;</span>
</code></pre></div><h3 id="set"><a href="#set" class="header-anchor">#</a> SET</h3> <div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/redis/redis-datatype-set.png" width="400"></div>
**é€‚ç”¨åœºæ™¯ï¼šç”¨äºå­˜å‚¨å»é‡çš„åˆ—è¡¨å‹æ•°æ®**ã€‚
<p>å‘½ä»¤ï¼š</p> <table><thead><tr><th>å‘½ä»¤</th> <th>è¡Œä¸º</th></tr></thead> <tbody><tr><td><code>SADD</code></td> <td>å°†ç»™å®šå…ƒç´ æ·»åŠ åˆ°é›†åˆã€‚</td></tr> <tr><td><code>SMEMBERS</code></td> <td>è¿”å›é›†åˆåŒ…å«çš„æ‰€æœ‰å…ƒç´ ã€‚</td></tr> <tr><td><code>SISMEMBER</code></td> <td>æ£€æŸ¥ç»™å®šå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ã€‚</td></tr> <tr><td><code>SREM</code></td> <td>å¦‚æœç»™å®šçš„å…ƒç´ å­˜åœ¨äºé›†åˆä¸­ï¼Œé‚£ä¹ˆç§»é™¤è¿™ä¸ªå…ƒç´ ã€‚</td></tr></tbody></table> <blockquote><p>æ›´å¤šå‘½ä»¤è¯·å‚è€ƒï¼š<a href="https://redis.io/commands#set" target="_blank" rel="noopener noreferrer">Redis Set ç±»å‹å‘½ä»¤<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd set-key item
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd set-key item2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd set-key item3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd set-key item
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> smembers set-key
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;item&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;item2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;item3&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sismember set-key item4
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sismember set-key item
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> srem set-key item2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> srem set-key item2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> smembers set-key
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;item&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;item3&quot;</span>
</code></pre></div><h3 id="zset"><a href="#zset" class="header-anchor">#</a> ZSET</h3> <div align="center"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/redis/redis-datatype-zset.png" width="400"></div> <p>é€‚ç”¨åœºæ™¯ï¼šç”±äºå¯ä»¥è®¾ç½® scoreï¼Œä¸”ä¸é‡å¤ã€‚<strong>é€‚åˆç”¨äºå­˜å‚¨å„ç§æ’è¡Œæ•°æ®</strong>ï¼Œå¦‚ï¼šæŒ‰è¯„åˆ†æ’åºçš„æœ‰åºå•†å“é›†åˆã€æŒ‰æ—¶é—´æ’åºçš„æœ‰åºæ–‡ç« é›†åˆã€‚</p> <p>å‘½ä»¤ï¼š</p> <table><thead><tr><th>å‘½ä»¤</th> <th>è¡Œä¸º</th></tr></thead> <tbody><tr><td><code>ZADD</code></td> <td>å°†ä¸€ä¸ªå¸¦æœ‰ç»™å®šåˆ†å€¼çš„æˆå‘˜æ·»åŠ åˆ°æœ‰åºé›†åˆé‡Œé¢ã€‚</td></tr> <tr><td><code>ZRANGE</code></td> <td>æ ¹æ®å…ƒç´ åœ¨æœ‰åºæ’åˆ—ä¸­æ‰€å¤„çš„ä½ç½®ï¼Œä»æœ‰åºé›†åˆé‡Œé¢è·å–å¤šä¸ªå…ƒç´ ã€‚</td></tr> <tr><td><code>ZRANGEBYSCORE</code></td> <td>è·å–æœ‰åºé›†åˆåœ¨ç»™å®šåˆ†å€¼èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</td></tr> <tr><td><code>ZREM</code></td> <td>å¦‚æœç»™å®šæˆå‘˜å­˜åœ¨äºæœ‰åºé›†åˆï¼Œé‚£ä¹ˆç§»é™¤è¿™ä¸ªæˆå‘˜ã€‚</td></tr></tbody></table> <blockquote><p>æ›´å¤šå‘½ä»¤è¯·å‚è€ƒï¼š<a href="https://redis.io/commands#sorted_set" target="_blank" rel="noopener noreferrer">Redis ZSet ç±»å‹å‘½ä»¤<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zadd zset-key <span class="token number">728</span> member1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zadd zset-key <span class="token number">982</span> member0
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zadd zset-key <span class="token number">982</span> member0
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange zset-key <span class="token number">0</span> -1 withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;member1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;728&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;member0&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;982&quot;</span>

<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrangebyscore zset-key <span class="token number">0</span> <span class="token number">800</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;member1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;728&quot;</span>

<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrem zset-key member1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrem zset-key member1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange zset-key <span class="token number">0</span> -1 withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;member0&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;982&quot;</span>
</code></pre></div><h3 id="é€šç”¨å‘½ä»¤"><a href="#é€šç”¨å‘½ä»¤" class="header-anchor">#</a> é€šç”¨å‘½ä»¤</h3> <h4 id="æ’åº"><a href="#æ’åº" class="header-anchor">#</a> æ’åº</h4> <p>Redis çš„ <code>SORT</code> å‘½ä»¤å¯ä»¥å¯¹ <code>LIST</code>ã€<code>SET</code>ã€<code>ZSET</code> è¿›è¡Œæ’åºã€‚</p> <table><thead><tr><th>å‘½ä»¤</th> <th>æè¿°</th></tr></thead> <tbody><tr><td><code>SORT</code></td> <td><code>SORT source-key [BY pattern] [LIMIT offset count] [GET pattern [GET pattern ...]] [ASC | DESC] [ALPHA] [STORE dest-key]</code>â€”æ ¹æ®ç»™å®šé€‰é¡¹ï¼Œå¯¹è¾“å…¥ <code>LIST</code>ã€<code>SET</code>ã€<code>ZSET</code> è¿›è¡Œæ’åºï¼Œç„¶åè¿”å›æˆ–å­˜å‚¨æ’åºçš„ç»“æœã€‚</td></tr></tbody></table> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> RPUSH <span class="token string">'sort-input'</span> <span class="token number">23</span> <span class="token number">15</span> <span class="token number">110</span> <span class="token number">7</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> SORT <span class="token string">'sort-input'</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;7&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;15&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;23&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;110&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> SORT <span class="token string">'sort-input'</span> alpha
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;110&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;15&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;23&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;7&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> HSET <span class="token string">'d-7'</span> <span class="token string">'field'</span> <span class="token number">5</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> HSET <span class="token string">'d-15'</span> <span class="token string">'field'</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> HSET <span class="token string">'d-23'</span> <span class="token string">'field'</span> <span class="token number">9</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> HSET <span class="token string">'d-110'</span> <span class="token string">'field'</span> <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> SORT <span class="token string">'sort-input'</span> by <span class="token string">'d-*-&gt;field'</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;15&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;110&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;7&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;23&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> SORT <span class="token string">'sort-input'</span> by <span class="token string">'d-*-&gt;field'</span> get <span class="token string">'d-*-&gt;field'</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;9&quot;</span>
</code></pre></div><h4 id="é”®çš„è¿‡æœŸæ—¶é—´"><a href="#é”®çš„è¿‡æœŸæ—¶é—´" class="header-anchor">#</a> é”®çš„è¿‡æœŸæ—¶é—´</h4> <p>Redis çš„ <code>EXPIRE</code> å‘½ä»¤å¯ä»¥æŒ‡å®šä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ï¼Œå½“è¾¾åˆ°è¿‡æœŸæ—¶é—´åï¼ŒRedis ä¼šè‡ªåŠ¨åˆ é™¤è¯¥é”®ã€‚</p> <table><thead><tr><th>å‘½ä»¤</th> <th>æè¿°</th></tr></thead> <tbody><tr><td><code>PERSIST</code></td> <td><code>PERSIST key-name</code>â€”ç§»é™¤é”®çš„è¿‡æœŸæ—¶é—´</td></tr> <tr><td><code>TTL</code></td> <td><code>TTL key-name</code>â€”æŸ¥çœ‹ç»™å®šé”®è·ç¦»è¿‡æœŸè¿˜æœ‰å¤šå°‘ç§’</td></tr> <tr><td><code>EXPIRE</code></td> <td><code>EXPIRE key-name seconds</code>â€”è®©ç»™å®šé”®åœ¨æŒ‡å®šçš„ç§’æ•°ä¹‹åè¿‡æœŸ</td></tr> <tr><td><code>EXPIREAT</code></td> <td><code>EXPIREAT key-name timestamp</code>â€”å°†ç»™å®šé”®çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºç»™å®šçš„ UNIX æ—¶é—´æˆ³</td></tr> <tr><td><code>PTTL</code></td> <td><code>PTTL key-name</code>â€”æŸ¥çœ‹ç»™å®šé”®è·ç¦»è¿‡æœŸæ—¶é—´è¿˜æœ‰å¤šå°‘æ¯«ç§’ï¼ˆè¿™ä¸ªå‘½ä»¤åœ¨ Redis 2.6 æˆ–ä»¥ä¸Šç‰ˆæœ¬å¯ç”¨ï¼‰</td></tr> <tr><td><code>PEXPIRE</code></td> <td><code>PEXPIRE key-name milliseconds</code>â€”è®©ç»™å®šé”®åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°ä¹‹åè¿‡æœŸï¼ˆè¿™ä¸ªå‘½ä»¤åœ¨ Redis 2.6 æˆ–ä»¥ä¸Šç‰ˆæœ¬å¯ç”¨ï¼‰</td></tr> <tr><td><code>PEXPIREAT</code></td> <td><code>PEXPIREAT key-name timestamp-milliseconds</code>â€”å°†ä¸€ä¸ªæ¯«ç§’çº§ç²¾åº¦çš„ UNIX æ—¶é—´æˆ³è®¾ç½®ä¸ºç»™å®šé”®çš„è¿‡æœŸæ—¶é—´ï¼ˆè¿™ä¸ªå‘½ä»¤åœ¨ Redis 2.6 æˆ–ä»¥ä¸Šç‰ˆæœ¬å¯ç”¨ï¼‰</td></tr></tbody></table> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> SET key value
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> GET key
<span class="token string">&quot;value&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> EXPIRE key <span class="token number">2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> GET key
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre></div><h2 id="äºŒã€redis-é«˜çº§æ•°æ®ç±»å‹"><a href="#äºŒã€redis-é«˜çº§æ•°æ®ç±»å‹" class="header-anchor">#</a> äºŒã€Redis é«˜çº§æ•°æ®ç±»å‹</h2> <h3 id="bitmap"><a href="#bitmap" class="header-anchor">#</a> BitMap</h3> <p>BitMap å³ä½å›¾ã€‚BitMap ä¸æ˜¯ä¸€ä¸ªçœŸå®çš„æ•°æ®ç»“æ„ã€‚è€Œæ˜¯ STRING ç±»å‹ä¸Šçš„ä¸€ç»„é¢å‘ bit æ“ä½œçš„é›†åˆã€‚ç”±äº STRING æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ blobï¼Œå¹¶ä¸”å®ƒä»¬çš„æœ€å¤§é•¿åº¦æ˜¯ 512mï¼Œæ‰€ä»¥ BitMap èƒ½æœ€å¤§è®¾ç½® $$2^{32}$$ ä¸ªä¸åŒçš„ bitã€‚</p> <p>Bitmaps çš„æœ€å¤§ä¼˜ç‚¹å°±æ˜¯å­˜å‚¨ä¿¡æ¯æ—¶å¯ä»¥èŠ‚çœå¤§é‡çš„ç©ºé—´ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œä¸åŒçš„ç”¨æˆ·è¢«ä¸€ä¸ªå¢é•¿çš„ç”¨æˆ· ID è¡¨ç¤ºã€‚40 äº¿ï¼ˆ$$2^{32}$$ = $$4<em>1024</em>1024*1024$$ â‰ˆ 40 äº¿ï¼‰ç”¨æˆ·åªéœ€è¦ 512M å†…å­˜å°±èƒ½è®°ä½æŸç§ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·æ˜¯å¦ç™»å½•è¿‡ã€‚</p> <h4 id="bitmap-å‘½ä»¤"><a href="#bitmap-å‘½ä»¤" class="header-anchor">#</a> BitMap å‘½ä»¤</h4> <ul><li><a href="http://redisdoc.com/bitmap/setbit.html" target="_blank" rel="noopener noreferrer">SETBIT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - å¯¹ <code>key</code> æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè®¾ç½®æˆ–æ¸…é™¤æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚</li> <li><a href="http://redisdoc.com/bitmap/getbit.html" target="_blank" rel="noopener noreferrer">GETBIT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - å¯¹ <code>key</code> æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚</li> <li><a href="http://redisdoc.com/bitmap/bitcount.html" target="_blank" rel="noopener noreferrer">BITCOUNT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - è®¡ç®—ç»™å®šå­—ç¬¦ä¸²ä¸­ï¼Œè¢«è®¾ç½®ä¸º <code>1</code> çš„æ¯”ç‰¹ä½çš„æ•°é‡ã€‚</li> <li><a href="http://redisdoc.com/bitmap/bitpos.html" target="_blank" rel="noopener noreferrer">BITPOS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://redisdoc.com/bitmap/bitop.html" target="_blank" rel="noopener noreferrer">BITOP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://redisdoc.com/bitmap/bitfield.html" target="_blank" rel="noopener noreferrer">BITFIELD<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="bitmap-ç¤ºä¾‹"><a href="#bitmap-ç¤ºä¾‹" class="header-anchor">#</a> BitMap ç¤ºä¾‹</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># å¯¹ä¸å­˜åœ¨çš„ key æˆ–è€…ä¸å­˜åœ¨çš„ offset è¿›è¡Œ GETBITï¼Œ è¿”å› 0</span>

redis<span class="token operator">&gt;</span> EXISTS bit
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

redis<span class="token operator">&gt;</span> GETBIT bit <span class="token number">10086</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>


<span class="token comment"># å¯¹å·²å­˜åœ¨çš„ offset è¿›è¡Œ GETBIT</span>

redis<span class="token operator">&gt;</span> SETBIT bit <span class="token number">10086</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

redis<span class="token operator">&gt;</span> GETBIT bit <span class="token number">10086</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>

redis<span class="token operator">&gt;</span> BITCOUNT bit
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><h4 id="bitmap-åº”ç”¨"><a href="#bitmap-åº”ç”¨" class="header-anchor">#</a> BitMap åº”ç”¨</h4> <p>Bitmap å¯¹äºä¸€äº›ç‰¹å®šç±»å‹çš„è®¡ç®—éå¸¸æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼šä½¿ç”¨ bitmap å®ç°ç”¨æˆ·ä¸Šçº¿æ¬¡æ•°ç»Ÿè®¡ã€‚</p> <p>å‡è®¾ç°åœ¨æˆ‘ä»¬å¸Œæœ›è®°å½•è‡ªå·±ç½‘ç«™ä¸Šçš„ç”¨æˆ·çš„ä¸Šçº¿é¢‘ç‡ï¼Œæ¯”å¦‚è¯´ï¼Œè®¡ç®—ç”¨æˆ· A ä¸Šçº¿äº†å¤šå°‘å¤©ï¼Œç”¨æˆ· B ä¸Šçº¿äº†å¤šå°‘å¤©ï¼Œè¯¸å¦‚æ­¤ç±»ï¼Œä»¥æ­¤ä½œä¸ºæ•°æ®ï¼Œä»è€Œå†³å®šè®©å“ªäº›ç”¨æˆ·å‚åŠ  beta æµ‹è¯•ç­‰æ´»åŠ¨ â€”â€” è¿™ä¸ªæ¨¡å¼å¯ä»¥ä½¿ç”¨ <a href="http://redisdoc.com/bitmap/setbit.html#setbit" target="_blank" rel="noopener noreferrer">SETBIT key offset value<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å’Œ [BITCOUNT key <a href="http://redisdoc.com/bitmap/bitcount.html#bitcount" target="_blank" rel="noopener noreferrer">start] [end]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ¥å®ç°ã€‚</p> <p>æ¯”å¦‚è¯´ï¼Œæ¯å½“ç”¨æˆ·åœ¨æŸä¸€å¤©ä¸Šçº¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ <a href="http://redisdoc.com/bitmap/setbit.html#setbit" target="_blank" rel="noopener noreferrer">SETBIT key offset value<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ï¼Œä»¥ç”¨æˆ·åä½œä¸º <code>key</code>ï¼Œå°†é‚£å¤©æ‰€ä»£è¡¨çš„ç½‘ç«™çš„ä¸Šçº¿æ—¥ä½œä¸º <code>offset</code> å‚æ•°ï¼Œå¹¶å°†è¿™ä¸ª <code>offset</code> ä¸Šçš„ä¸ºè®¾ç½®ä¸º <code>1</code> ã€‚</p> <blockquote><p>æ›´è¯¦ç»†çš„å®ç°å¯ä»¥å‚è€ƒï¼š</p> <p><a href="https://blog.csdn.net/u011957758/article/details/74783347" target="_blank" rel="noopener noreferrer">ä¸€çœ‹å°±æ‡‚ç³»åˆ—ä¹‹ è¯¦è§£ redis çš„ bitmap åœ¨äº¿çº§é¡¹ç›®ä¸­çš„åº”ç”¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://blog.getspool.com/2011/11/29/fast-easy-realtime-metrics-using-redis-bitmaps/" target="_blank" rel="noopener noreferrer">Fast, easy, realtime metrics using Redis bitmaps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="hyperloglog"><a href="#hyperloglog" class="header-anchor">#</a> HyperLogLog</h3> <p>HyperLogLog æ˜¯ç”¨äºè®¡ç®—å”¯ä¸€äº‹ç‰©çš„æ¦‚ç‡æ•°æ®ç»“æ„ï¼ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™è¢«ç§°ä¸ºä¼°è®¡é›†åˆçš„åŸºæ•°ï¼‰ã€‚å¦‚æœç»Ÿè®¡å”¯ä¸€é¡¹ï¼Œé¡¹ç›®è¶Šå¤šï¼Œéœ€è¦çš„å†…å­˜å°±è¶Šå¤šã€‚å› ä¸ºéœ€è¦è®°ä½è¿‡å»å·²ç»çœ‹è¿‡çš„é¡¹ï¼Œä»è€Œé¿å…å¤šæ¬¡ç»Ÿè®¡è¿™äº›é¡¹ã€‚</p> <h4 id="hyperloglog-å‘½ä»¤"><a href="#hyperloglog-å‘½ä»¤" class="header-anchor">#</a> HyperLogLog å‘½ä»¤</h4> <ul><li><a href="http://redisdoc.com/hyperloglog/pfadd.html" target="_blank" rel="noopener noreferrer">PFADD<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - å°†ä»»æ„æ•°é‡çš„å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šçš„ HyperLogLog é‡Œé¢ã€‚</li> <li><a href="http://redisdoc.com/hyperloglog/pfcount.html" target="_blank" rel="noopener noreferrer">PFCOUNT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - è¿”å› HyperLogLog åŒ…å«çš„å”¯ä¸€å…ƒç´ çš„è¿‘ä¼¼æ•°é‡ã€‚</li> <li><a href="http://redisdoc.com/hyperloglog/pfmerge.html" target="_blank" rel="noopener noreferrer">PFMERGE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - å°†å¤šä¸ª HyperLogLog åˆå¹¶ï¼ˆmergeï¼‰ä¸ºä¸€ä¸ª HyperLogLog ï¼Œ åˆå¹¶åçš„ HyperLogLog çš„åŸºæ•°æ¥è¿‘äºæ‰€æœ‰è¾“å…¥ HyperLogLog çš„å¯è§é›†åˆï¼ˆobserved setï¼‰çš„å¹¶é›†ã€‚åˆå¹¶å¾—å‡ºçš„ HyperLogLog ä¼šè¢«å‚¨å­˜åœ¨ <code>destkey</code> é”®é‡Œé¢ï¼Œ å¦‚æœè¯¥é”®å¹¶ä¸å­˜åœ¨ï¼Œ é‚£ä¹ˆå‘½ä»¤åœ¨æ‰§è¡Œä¹‹å‰ï¼Œ ä¼šå…ˆä¸ºè¯¥é”®åˆ›å»ºä¸€ä¸ªç©ºçš„ HyperLogLog ã€‚</li></ul> <p>ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis<span class="token operator">&gt;</span> PFADD  databases  <span class="token string">&quot;Redis&quot;</span>  <span class="token string">&quot;MongoDB&quot;</span>  <span class="token string">&quot;MySQL&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>

redis<span class="token operator">&gt;</span> PFCOUNT  databases
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>

redis<span class="token operator">&gt;</span> PFADD  databases  <span class="token string">&quot;Redis&quot;</span>    <span class="token comment"># Redis å·²ç»å­˜åœ¨ï¼Œä¸å¿…å¯¹ä¼°è®¡æ•°é‡è¿›è¡Œæ›´æ–°</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

redis<span class="token operator">&gt;</span> PFCOUNT  databases    <span class="token comment"># å…ƒç´ ä¼°è®¡æ•°é‡æ²¡æœ‰å˜åŒ–</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>

redis<span class="token operator">&gt;</span> PFADD  databases  <span class="token string">&quot;PostgreSQL&quot;</span>    <span class="token comment"># æ·»åŠ ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ </span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>

redis<span class="token operator">&gt;</span> PFCOUNT  databases    <span class="token comment"># ä¼°è®¡æ•°é‡å¢ä¸€</span>
<span class="token number">4</span>
</code></pre></div><h3 id="geo"><a href="#geo" class="header-anchor">#</a> GEO</h3> <p>è¿™ä¸ªåŠŸèƒ½å¯ä»¥å°†ç”¨æˆ·ç»™å®šçš„åœ°ç†ä½ç½®ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ä¿¡æ¯å‚¨å­˜èµ·æ¥ï¼Œå¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚</p> <h4 id="geo-å‘½ä»¤"><a href="#geo-å‘½ä»¤" class="header-anchor">#</a> GEO å‘½ä»¤</h4> <ul><li><a href="http://redisdoc.com/geo/geoadd.html" target="_blank" rel="noopener noreferrer">GEOADD<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - å°†æŒ‡å®šçš„åœ°ç†ç©ºé—´ä½ç½®ï¼ˆçº¬åº¦ã€ç»åº¦ã€åç§°ï¼‰æ·»åŠ åˆ°æŒ‡å®šçš„ key ä¸­ã€‚</li> <li><a href="http://redisdoc.com/geo/geopos.html" target="_blank" rel="noopener noreferrer">GEOPOS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - ä» key é‡Œè¿”å›æ‰€æœ‰ç»™å®šä½ç½®å…ƒç´ çš„ä½ç½®ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ã€‚</li> <li><a href="http://redisdoc.com/geo/geodist.html" target="_blank" rel="noopener noreferrer">GEODIST<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - è¿”å›ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»ã€‚</li> <li><a href="http://redisdoc.com/geo/geohash.html" target="_blank" rel="noopener noreferrer">GEOHASH<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - å›ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®å…ƒç´ çš„æ ‡å‡† Geohash å€¼ï¼Œå®ƒå¯ä»¥åœ¨http://geohash.org/ä½¿ç”¨ã€‚</li> <li><a href="http://redisdoc.com/geo/georadius.html" target="_blank" rel="noopener noreferrer">GEORADIUS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://redisdoc.com/geo/georadiusbymember.html" target="_blank" rel="noopener noreferrer">GEORADIUSBYMEMBER<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="ä¸‰ã€redis-æ•°æ®ç±»å‹åº”ç”¨"><a href="#ä¸‰ã€redis-æ•°æ®ç±»å‹åº”ç”¨" class="header-anchor">#</a> ä¸‰ã€Redis æ•°æ®ç±»å‹åº”ç”¨</h2> <h3 id="æ¡ˆä¾‹-æœ€å—æ¬¢è¿æ–‡ç« "><a href="#æ¡ˆä¾‹-æœ€å—æ¬¢è¿æ–‡ç« " class="header-anchor">#</a> æ¡ˆä¾‹-æœ€å—æ¬¢è¿æ–‡ç« </h3> <p>é€‰å‡ºæœ€å—æ¬¢è¿æ–‡ç« ï¼Œéœ€è¦æ”¯æŒå¯¹æ–‡ç« è¿›è¡Œè¯„åˆ†ã€‚</p> <h4 id="å¯¹æ–‡ç« è¿›è¡ŒæŠ•ç¥¨"><a href="#å¯¹æ–‡ç« è¿›è¡ŒæŠ•ç¥¨" class="header-anchor">#</a> å¯¹æ–‡ç« è¿›è¡ŒæŠ•ç¥¨</h4> <p>ï¼ˆ1ï¼‰ä½¿ç”¨ HASH å­˜å‚¨æ–‡ç« </p> <p>ä½¿ç”¨ <code>HASH</code> ç±»å‹å­˜å‚¨æ–‡ç« ä¿¡æ¯ã€‚å…¶ä¸­ï¼škey æ˜¯æ–‡ç«  IDï¼›field æ˜¯æ–‡ç« çš„å±æ€§ keyï¼›value æ˜¯å±æ€§å¯¹åº”å€¼ã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200225143038.jpg" alt="img"></p> <p>æ“ä½œï¼š</p> <ul><li>å­˜å‚¨æ–‡ç« ä¿¡æ¯ - ä½¿ç”¨ <code>HSET</code> æˆ– <code>HMGET</code> å‘½ä»¤</li> <li>æŸ¥è¯¢æ–‡ç« ä¿¡æ¯ - ä½¿ç”¨ <code>HGETALL</code> å‘½ä»¤</li> <li>æ·»åŠ æŠ•ç¥¨ - ä½¿ç”¨ <code>HINCRBY</code> å‘½ä»¤</li></ul> <p>ï¼ˆ2ï¼‰ä½¿ç”¨ <code>ZSET</code> é’ˆå¯¹ä¸åŒç»´åº¦é›†åˆæ’åº</p> <p>ä½¿ç”¨ <code>ZSET</code> ç±»å‹åˆ†åˆ«å­˜å‚¨æŒ‰ç…§æ—¶é—´æ’åºå’ŒæŒ‰ç…§è¯„åˆ†æ’åºçš„æ–‡ç«  ID é›†åˆã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200225145742.jpg" alt="img"></p> <p>æ“ä½œï¼š</p> <ul><li>æ·»åŠ è®°å½• - ä½¿ç”¨ <code>ZADD</code> å‘½ä»¤</li> <li>æ·»åŠ åˆ†æ•° - ä½¿ç”¨ <code>ZINCRBY</code> å‘½ä»¤</li> <li>å–å‡ºå¤šç¯‡æ–‡ç«  - ä½¿ç”¨ <code>ZREVRANGE</code> å‘½ä»¤</li></ul> <p>ï¼ˆ3ï¼‰ä¸ºäº†é˜²æ­¢é‡å¤æŠ•ç¥¨ï¼Œä½¿ç”¨ <code>SET</code> ç±»å‹è®°å½•æ¯ç¯‡æ–‡ç«  ID å¯¹åº”çš„æŠ•ç¥¨é›†åˆã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200225150105.jpg" alt="img"></p> <p>æ“ä½œï¼š</p> <ul><li>æ·»åŠ æŠ•ç¥¨è€… - ä½¿ç”¨ <code>SADD</code> å‘½ä»¤</li> <li>è®¾ç½®æœ‰æ•ˆæœŸ - ä½¿ç”¨ <code>EXPIRE</code> å‘½ä»¤</li></ul> <p>ï¼ˆ4ï¼‰å‡è®¾ user:115423 ç»™ article:100408 æŠ•ç¥¨ï¼Œåˆ†åˆ«éœ€è¦é«˜æ›´æ–°è¯„åˆ†æ’åºé›†åˆä»¥åŠæŠ•ç¥¨é›†åˆã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200225150138.jpg" alt="img"></p> <p>å½“éœ€è¦å¯¹ä¸€ç¯‡æ–‡ç« æŠ•ç¥¨æ—¶ï¼Œç¨‹åºéœ€è¦ç”¨ ZSCORE å‘½ä»¤æ£€æŸ¥è®°å½•æ–‡ç« å‘å¸ƒæ—¶é—´çš„æœ‰åºé›†åˆï¼Œåˆ¤æ–­æ–‡ç« çš„å‘å¸ƒæ—¶é—´æ˜¯å¦è¶…è¿‡æŠ•ç¥¨æœ‰æ•ˆæœŸï¼ˆæ¯”å¦‚ï¼šä¸€æ˜ŸæœŸï¼‰ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">articleVote</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> article<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¡ç®—æ–‡ç« çš„æŠ•ç¥¨æˆªæ­¢æ—¶é—´ã€‚</span>
        <span class="token keyword">long</span> cutoff <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">-</span> ONE_WEEK_IN_SECONDS<span class="token punctuation">;</span>

        <span class="token comment">// æ£€æŸ¥æ˜¯å¦è¿˜å¯ä»¥å¯¹æ–‡ç« è¿›è¡ŒæŠ•ç¥¨</span>
        <span class="token comment">// ï¼ˆè™½ç„¶ä½¿ç”¨æ•£åˆ—ä¹Ÿå¯ä»¥è·å–æ–‡ç« çš„å‘å¸ƒæ—¶é—´ï¼Œ</span>
        <span class="token comment">// ä½†æœ‰åºé›†åˆè¿”å›çš„æ–‡ç« å‘å¸ƒæ—¶é—´ä¸ºæµ®ç‚¹æ•°ï¼Œ</span>
        <span class="token comment">// å¯ä»¥ä¸è¿›è¡Œè½¬æ¢ç›´æ¥ä½¿ç”¨ï¼‰ã€‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">zscore</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token punctuation">,</span> article<span class="token punctuation">)</span> <span class="token operator">&lt;</span> cutoff<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ä»article:idæ ‡è¯†ç¬¦ï¼ˆidentifierï¼‰é‡Œé¢å–å‡ºæ–‡ç« çš„IDã€‚</span>
        <span class="token class-name">String</span> articleId <span class="token operator">=</span> article<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¦‚æœç”¨æˆ·æ˜¯ç¬¬ä¸€æ¬¡ä¸ºè¿™ç¯‡æ–‡ç« æŠ•ç¥¨ï¼Œé‚£ä¹ˆå¢åŠ è¿™ç¯‡æ–‡ç« çš„æŠ•ç¥¨æ•°é‡å’Œè¯„åˆ†ã€‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">&quot;voted:&quot;</span> <span class="token operator">+</span> articleId<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            conn<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span><span class="token string">&quot;score:&quot;</span><span class="token punctuation">,</span> VOTE_SCORE<span class="token punctuation">,</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">hincrBy</span><span class="token punctuation">(</span>article<span class="token punctuation">,</span> <span class="token string">&quot;votes&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="å‘å¸ƒå¹¶è·å–æ–‡ç« "><a href="#å‘å¸ƒå¹¶è·å–æ–‡ç« " class="header-anchor">#</a> å‘å¸ƒå¹¶è·å–æ–‡ç« </h4> <p>å‘å¸ƒæ–‡ç« ï¼š</p> <ul><li>æ·»åŠ æ–‡ç«  - ä½¿ç”¨ <code>INCR</code> å‘½ä»¤è®¡ç®—æ–°çš„æ–‡ç«  IDï¼Œå¡«å……æ–‡ç« ä¿¡æ¯ï¼Œç„¶åç”¨ <code>HSET</code> å‘½ä»¤æˆ– <code>HMSET</code> å‘½ä»¤å†™å…¥åˆ° <code>HASH</code> ç»“æ„ä¸­ã€‚</li> <li>å°†æ–‡ç« ä½œè€… ID æ·»åŠ åˆ°æŠ•ç¥¨åå• - ä½¿ç”¨ <code>SADD</code> å‘½ä»¤æ·»åŠ åˆ°ä»£è¡¨æŠ•ç¥¨åå•çš„ <code>SET</code> ç»“æ„ä¸­ã€‚</li> <li>è®¾ç½®æŠ•ç¥¨æœ‰æ•ˆæœŸ - ä½¿ç”¨ <code>EXPIRE</code> å‘½ä»¤è®¾ç½®æŠ•ç¥¨æœ‰æ•ˆæœŸã€‚</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">postArticle</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> link<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ç« IDã€‚</span>
        <span class="token class-name">String</span> articleId <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">&quot;article:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> voted <span class="token operator">=</span> <span class="token string">&quot;voted:&quot;</span> <span class="token operator">+</span> articleId<span class="token punctuation">;</span>
        <span class="token comment">// å°†å‘å¸ƒæ–‡ç« çš„ç”¨æˆ·æ·»åŠ åˆ°æ–‡ç« çš„å·²æŠ•ç¥¨ç”¨æˆ·åå•é‡Œé¢ï¼Œ</span>
        conn<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span>voted<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç„¶åå°†è¿™ä¸ªåå•çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºä¸€å‘¨ï¼ˆç¬¬3ç« å°†å¯¹è¿‡æœŸæ—¶é—´ä½œæ›´è¯¦ç»†çš„ä»‹ç»ï¼‰ã€‚</span>
        conn<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>voted<span class="token punctuation">,</span> ONE_WEEK_IN_SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> article <span class="token operator">=</span> <span class="token string">&quot;article:&quot;</span> <span class="token operator">+</span> articleId<span class="token punctuation">;</span>
        <span class="token comment">// å°†æ–‡ç« ä¿¡æ¯å­˜å‚¨åˆ°ä¸€ä¸ªæ•£åˆ—é‡Œé¢ã€‚</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> articleData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">,</span> link<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;now&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;votes&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conn<span class="token punctuation">.</span><span class="token function">hmset</span><span class="token punctuation">(</span>article<span class="token punctuation">,</span> articleData<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å°†æ–‡ç« æ·»åŠ åˆ°æ ¹æ®å‘å¸ƒæ—¶é—´æ’åºçš„æœ‰åºé›†åˆå’Œæ ¹æ®è¯„åˆ†æ’åºçš„æœ‰åºé›†åˆé‡Œé¢ã€‚</span>
        conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;score:&quot;</span><span class="token punctuation">,</span> now <span class="token operator">+</span> VOTE_SCORE<span class="token punctuation">,</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>
        conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token punctuation">,</span> now<span class="token punctuation">,</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> articleId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>åˆ†é¡µæŸ¥è¯¢æœ€å—æ¬¢è¿æ–‡ç« ï¼š</p> <p>ä½¿ç”¨ <code>ZINTERSTORE</code> å‘½ä»¤æ ¹æ®é¡µç ã€æ¯é¡µè®°å½•æ•°ã€æ’åºå·ï¼Œæ ¹æ®è¯„åˆ†å€¼ä»å¤§åˆ°å°åˆ†é¡µæŸ¥å‡ºæ–‡ç«  ID åˆ—è¡¨ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token class-name">String</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¾ç½®è·å–æ–‡ç« çš„èµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•ã€‚</span>
        <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> ARTICLES_PER_PAGE<span class="token punctuation">;</span>
        <span class="token keyword">int</span> end <span class="token operator">=</span> start <span class="token operator">+</span> ARTICLES_PER_PAGE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–å¤šä¸ªæ–‡ç« IDã€‚</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ids <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> articles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ ¹æ®æ–‡ç« IDè·å–æ–‡ç« çš„è¯¦ç»†ä¿¡æ¯ã€‚</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> id <span class="token operator">:</span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> articleData <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            articleData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            articles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>articleData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> articles<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="å¯¹æ–‡ç« è¿›è¡Œåˆ†ç»„"><a href="#å¯¹æ–‡ç« è¿›è¡Œåˆ†ç»„" class="header-anchor">#</a> å¯¹æ–‡ç« è¿›è¡Œåˆ†ç»„</h4> <p>å¦‚æœæ–‡ç« éœ€è¦åˆ†ç»„ï¼ŒåŠŸèƒ½éœ€è¦åˆ†ä¸ºä¸¤å—ï¼š</p> <ul><li>è®°å½•æ–‡ç« å±äºå“ªä¸ªç¾¤ç»„</li> <li>è´Ÿè´£å–å‡ºç¾¤ç»„é‡Œçš„æ–‡ç« </li></ul> <p>å°†æ–‡ç« æ·»åŠ ã€åˆ é™¤ç¾¤ç»„ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addRemoveGroups</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> articleId<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> toAdd<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> toRemove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ„å»ºå­˜å‚¨æ–‡ç« ä¿¡æ¯çš„é”®åã€‚</span>
        <span class="token class-name">String</span> article <span class="token operator">=</span> <span class="token string">&quot;article:&quot;</span> <span class="token operator">+</span> articleId<span class="token punctuation">;</span>
        <span class="token comment">// å°†æ–‡ç« æ·»åŠ åˆ°å®ƒæ‰€å±çš„ç¾¤ç»„é‡Œé¢ã€‚</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> group <span class="token operator">:</span> toAdd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            conn<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">&quot;group:&quot;</span> <span class="token operator">+</span> group<span class="token punctuation">,</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ä»ç¾¤ç»„é‡Œé¢ç§»é™¤æ–‡ç« ã€‚</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> group <span class="token operator">:</span> toRemove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            conn<span class="token punctuation">.</span><span class="token function">srem</span><span class="token punctuation">(</span><span class="token string">&quot;group:&quot;</span> <span class="token operator">+</span> group<span class="token punctuation">,</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>å–å‡ºç¾¤ç»„é‡Œçš„æ–‡ç« ï¼š</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200225214210.jpg" alt="img"></p> <ul><li>é€šè¿‡å¯¹å­˜å‚¨ç¾¤ç»„æ–‡ç« çš„é›†åˆå’Œå­˜å‚¨æ–‡ç« è¯„åˆ†çš„æœ‰åºé›†åˆæ‰§è¡Œ <code>ZINTERSTORE</code> å‘½ä»¤ï¼Œå¯ä»¥å¾—åˆ°æŒ‰ç…§æ–‡ç« è¯„åˆ†æ’åºçš„ç¾¤ç»„æ–‡ç« ã€‚</li> <li>é€šè¿‡å¯¹å­˜å‚¨ç¾¤ç»„æ–‡ç« çš„é›†åˆå’Œå­˜å‚¨æ–‡ç« å‘å¸ƒæ—¶é—´çš„æœ‰åºé›†åˆæ‰§è¡Œ <code>ZINTERSTORE</code> å‘½ä»¤ï¼Œå¯ä»¥å¾—åˆ°æŒ‰ç…§æ–‡ç« å‘å¸ƒæ—¶é—´æ’åºçš„ç¾¤ç»„æ–‡ç« ã€‚</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getGroupArticles</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> group<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token class-name">String</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸ºæ¯ä¸ªç¾¤ç»„çš„æ¯ç§æ’åˆ—é¡ºåºéƒ½åˆ›å»ºä¸€ä¸ªé”®ã€‚</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> order <span class="token operator">+</span> group<span class="token punctuation">;</span>
        <span class="token comment">// æ£€æŸ¥æ˜¯å¦æœ‰å·²ç¼“å­˜çš„æ’åºç»“æœï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±ç°åœ¨è¿›è¡Œæ’åºã€‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>conn<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ ¹æ®è¯„åˆ†æˆ–è€…å‘å¸ƒæ—¶é—´ï¼Œå¯¹ç¾¤ç»„æ–‡ç« è¿›è¡Œæ’åºã€‚</span>
            <span class="token class-name">ZParams</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token class-name">ZParams<span class="token punctuation">.</span>Aggregate</span><span class="token punctuation">.</span>MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">zinterstore</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token string">&quot;group:&quot;</span> <span class="token operator">+</span> group<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è®©Redisåœ¨60ç§’é’Ÿä¹‹åè‡ªåŠ¨åˆ é™¤è¿™ä¸ªæœ‰åºé›†åˆã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// è°ƒç”¨ä¹‹å‰å®šä¹‰çš„getArticleså‡½æ•°æ¥è¿›è¡Œåˆ†é¡µå¹¶è·å–æ–‡ç« æ•°æ®ã€‚</span>
        <span class="token keyword">return</span> <span class="token function">getArticles</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> page<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-ç®¡ç†ä»¤ç‰Œ"><a href="#æ¡ˆä¾‹-ç®¡ç†ä»¤ç‰Œ" class="header-anchor">#</a> æ¡ˆä¾‹-ç®¡ç†ä»¤ç‰Œ</h3> <p>ç½‘ç«™ä¸€èˆ¬ä¼šä»¥ Cookieã€Sessionã€ä»¤ç‰Œè¿™ç±»ä¿¡æ¯å­˜å‚¨ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚</p> <p>å¯ä»¥å°† Cookie/Session/ä»¤ç‰Œ å’Œç”¨æˆ·çš„æ˜ å°„å…³ç³»å­˜å‚¨åœ¨ <code>HASH</code> ç»“æ„ã€‚</p> <p>ä¸‹é¢ä»¥ä»¤ç‰Œæ¥ä¸¾ä¾‹ã€‚</p> <h4 id="æŸ¥è¯¢ä»¤ç‰Œ"><a href="#æŸ¥è¯¢ä»¤ç‰Œ" class="header-anchor">#</a> æŸ¥è¯¢ä»¤ç‰Œ</h4> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkToken</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°è¯•è·å–å¹¶è¿”å›ä»¤ç‰Œå¯¹åº”çš„ç”¨æˆ·ã€‚</span>
        <span class="token keyword">return</span> conn<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="æ›´æ–°ä»¤ç‰Œ"><a href="#æ›´æ–°ä»¤ç‰Œ" class="header-anchor">#</a> æ›´æ–°ä»¤ç‰Œ</h4> <ul><li>ç”¨æˆ·æ¯æ¬¡è®¿é—®é¡µé¢ï¼Œå¯ä»¥è®°å½•ä¸‹ä»¤ç‰Œå’Œå½“å‰æ—¶é—´æˆ³çš„æ˜ å°„å…³ç³»ï¼Œå­˜å…¥ä¸€ä¸ª <code>ZSET</code> ç»“æ„ä¸­ï¼Œä»¥ä¾¿åˆ†æç”¨æˆ·æ˜¯å¦æ´»è·ƒï¼Œç»§è€Œå¯ä»¥å‘¨æœŸæ€§æ¸…ç†æœ€è€çš„ä»¤ç‰Œï¼Œç»Ÿè®¡å½“å‰åœ¨çº¿ç”¨æˆ·æ•°ç­‰è¡Œä¸ºã€‚</li> <li>ç”¨æˆ·å¦‚æœæ­£åœ¨æµè§ˆå•†å“ï¼Œå¯ä»¥è®°å½•åˆ°ç”¨æˆ·æœ€è¿‘æµè§ˆè¿‡çš„å•†å“æœ‰åºé›†åˆä¸­ï¼ˆé›†åˆå¯ä»¥é™å®šæ•°é‡ï¼Œè¶…è¿‡æ•°é‡è¿›è¡Œè£å‰ªï¼‰ï¼Œå­˜å…¥åˆ°ä¸€ä¸ª <code>ZSET</code> ç»“æ„ä¸­ï¼Œä»¥ä¾¿åˆ†æç”¨æˆ·æœ€è¿‘å¯èƒ½æ„Ÿå…´è¶£çš„å•†å“ï¼Œä»¥ä¾¿æ¨èå•†å“ã€‚</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateToken</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> token<span class="token punctuation">,</span> <span class="token class-name">String</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–å½“å‰æ—¶é—´æˆ³ã€‚</span>
        <span class="token keyword">long</span> timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token comment">// ç»´æŒä»¤ç‰Œä¸å·²ç™»å½•ç”¨æˆ·ä¹‹é—´çš„æ˜ å°„ã€‚</span>
        conn<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®°å½•ä»¤ç‰Œæœ€åä¸€æ¬¡å‡ºç°çš„æ—¶é—´ã€‚</span>
        conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;recent:&quot;</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è®°å½•ç”¨æˆ·æµè§ˆè¿‡çš„å•†å“ã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;viewed:&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç§»é™¤æ—§çš„è®°å½•ï¼Œåªä¿ç•™ç”¨æˆ·æœ€è¿‘æµè§ˆè¿‡çš„25ä¸ªå•†å“ã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">zremrangeByRank</span><span class="token punctuation">(</span><span class="token string">&quot;viewed:&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span><span class="token string">&quot;viewed:&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="æ¸…ç†ä»¤ç‰Œ"><a href="#æ¸…ç†ä»¤ç‰Œ" class="header-anchor">#</a> æ¸…ç†ä»¤ç‰Œ</h4> <p>ä¸Šä¸€èŠ‚æåˆ°ï¼Œæ›´æ–°ä»¤ç‰Œæ—¶ï¼Œå°†ä»¤ç‰Œå’Œå½“å‰æ—¶é—´æˆ³çš„æ˜ å°„å…³ç³»ï¼Œå­˜å…¥ä¸€ä¸ª <code>ZSET</code> ç»“æ„ä¸­ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡æ’åºå¾—çŸ¥å“ªäº›ä»¤ç‰Œæœ€è€ã€‚å¦‚æœæ²¡æœ‰æ¸…ç†æ“ä½œï¼Œæ›´æ–°ä»¤ç‰Œå ç”¨çš„å†…å­˜ä¼šä¸æ–­è†¨èƒ€ï¼Œç›´åˆ°å¯¼è‡´æœºå™¨å®•æœºã€‚</p> <p>æ¯”å¦‚ï¼šæœ€å¤šå…è®¸å­˜å‚¨ 1000 ä¸‡æ¡ä»¤ç‰Œä¿¡æ¯ï¼Œå‘¨æœŸæ€§æ£€æŸ¥ï¼Œä¸€æ—¦å‘ç°è®°å½•æ•°è¶…å‡º 1000 ä¸‡æ¡ï¼Œå°† ZSET ä»æ–°åˆ°è€æ’åºï¼Œå°†è¶…å‡º 1000 ä¸‡æ¡çš„è®°å½•æ¸…é™¤ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CleanSessionsThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Jedis</span> conn<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> limit<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> quit<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CleanSessionsThread</span><span class="token punctuation">(</span><span class="token keyword">int</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>conn<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>limit <span class="token operator">=</span> limit<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        quit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>quit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‰¾å‡ºç›®å‰å·²æœ‰ä»¤ç‰Œçš„æ•°é‡ã€‚</span>
            <span class="token keyword">long</span> size <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zcard</span><span class="token punctuation">(</span><span class="token string">&quot;recent:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ä»¤ç‰Œæ•°é‡æœªè¶…è¿‡é™åˆ¶ï¼Œä¼‘çœ å¹¶åœ¨ä¹‹åé‡æ–°æ£€æŸ¥ã€‚</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;=</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// è·å–éœ€è¦ç§»é™¤çš„ä»¤ç‰ŒIDã€‚</span>
            <span class="token keyword">long</span> endIndex <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>size <span class="token operator">-</span> limit<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tokenSet <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">&quot;recent:&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> endIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tokens <span class="token operator">=</span> tokenSet<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>tokenSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// ä¸ºé‚£äº›å°†è¦è¢«åˆ é™¤çš„ä»¤ç‰Œæ„å»ºé”®åã€‚</span>
            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sessionKeys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> token <span class="token operator">:</span> tokens<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sessionKeys<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;viewed:&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// ç§»é™¤æœ€æ—§çš„é‚£äº›ä»¤ç‰Œã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span>sessionKeys<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>sessionKeys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">hdel</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span><span class="token punctuation">,</span> tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">zrem</span><span class="token punctuation">(</span><span class="token string">&quot;recent:&quot;</span><span class="token punctuation">,</span> tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-è´­ç‰©è½¦"><a href="#æ¡ˆä¾‹-è´­ç‰©è½¦" class="header-anchor">#</a> æ¡ˆä¾‹-è´­ç‰©è½¦</h3> <p>å¯ä»¥ä½¿ç”¨ HASH ç»“æ„æ¥å®ç°è´­ç‰©è½¦åŠŸèƒ½ã€‚</p> <p>æ¯ä¸ªç”¨æˆ·çš„è´­ç‰©è½¦ï¼Œå­˜å‚¨äº†å•†å“ ID å’Œå•†å“æ•°é‡çš„æ˜ å°„ã€‚</p> <h4 id="åœ¨è´­ç‰©è½¦ä¸­æ·»åŠ ã€åˆ é™¤å•†å“"><a href="#åœ¨è´­ç‰©è½¦ä¸­æ·»åŠ ã€åˆ é™¤å•†å“" class="header-anchor">#</a> åœ¨è´­ç‰©è½¦ä¸­æ·»åŠ ã€åˆ é™¤å•†å“</h4> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> session<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä»è´­ç‰©è½¦é‡Œé¢ç§»é™¤æŒ‡å®šçš„å•†å“ã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">hdel</span><span class="token punctuation">(</span><span class="token string">&quot;cart:&quot;</span> <span class="token operator">+</span> session<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// å°†æŒ‡å®šçš„å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦ã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;cart:&quot;</span> <span class="token operator">+</span> session<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="æ¸…ç©ºè´­ç‰©è½¦"><a href="#æ¸…ç©ºè´­ç‰©è½¦" class="header-anchor">#</a> æ¸…ç©ºè´­ç‰©è½¦</h4> <p>åœ¨ <a href="#%E6%B8%85%E7%90%86%E4%BB%A4%E7%89%8C">æ¸…ç†ä»¤ç‰Œ</a> çš„åŸºç¡€ä¸Šï¼Œæ¸…ç©ºä¼šè¯æ—¶ï¼Œé¡ºä¾¿å°†è´­ç‰©è½¦ç¼“å­˜ä¸€å¹¶æ¸…ç†ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code>   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>quit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> size <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zcard</span><span class="token punctuation">(</span><span class="token string">&quot;recent:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;=</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">long</span> endIndex <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>size <span class="token operator">-</span> limit<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sessionSet <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">&quot;recent:&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> endIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sessions <span class="token operator">=</span> sessionSet<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>sessionSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sessionKeys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> sess <span class="token operator">:</span> sessions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sessionKeys<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;viewed:&quot;</span> <span class="token operator">+</span> sess<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ–°å¢åŠ çš„è¿™è¡Œä»£ç ç”¨äºåˆ é™¤æ—§ä¼šè¯å¯¹åº”ç”¨æˆ·çš„è´­ç‰©è½¦ã€‚</span>
            sessionKeys<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;cart:&quot;</span> <span class="token operator">+</span> sess<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        conn<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span>sessionKeys<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>sessionKeys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conn<span class="token punctuation">.</span><span class="token function">hdel</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span><span class="token punctuation">,</span> sessions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        conn<span class="token punctuation">.</span><span class="token function">zrem</span><span class="token punctuation">(</span><span class="token string">&quot;recent:&quot;</span><span class="token punctuation">,</span> sessions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-é¡µé¢ç¼“å­˜"><a href="#æ¡ˆä¾‹-é¡µé¢ç¼“å­˜" class="header-anchor">#</a> æ¡ˆä¾‹-é¡µé¢ç¼“å­˜</h3> <p>å¤§éƒ¨åˆ†ç½‘é¡µå†…å®¹å¹¶ä¸ä¼šç»å¸¸æ”¹å˜ï¼Œä½†æ˜¯è®¿é—®æ—¶ï¼Œåå°éœ€è¦åŠ¨æ€è®¡ç®—ï¼Œè¿™å¯èƒ½è€—æ—¶è¾ƒå¤šï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>STRING</code> ç»“æ„å­˜å‚¨é¡µé¢ç¼“å­˜ï¼Œ</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">cacheRequest</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> request<span class="token punctuation">,</span> <span class="token class-name">Callback</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯¹äºä¸èƒ½è¢«ç¼“å­˜çš„è¯·æ±‚ï¼Œç›´æ¥è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canCache</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> callback <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> callback<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// å°†è¯·æ±‚è½¬æ¢æˆä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é”®ï¼Œæ–¹ä¾¿ä¹‹åè¿›è¡ŒæŸ¥æ‰¾ã€‚</span>
        <span class="token class-name">String</span> pageKey <span class="token operator">=</span> <span class="token string">&quot;cache:&quot;</span> <span class="token operator">+</span> <span class="token function">hashRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å°è¯•æŸ¥æ‰¾è¢«ç¼“å­˜çš„é¡µé¢ã€‚</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pageKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> callback <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœé¡µé¢è¿˜æ²¡æœ‰è¢«ç¼“å­˜ï¼Œé‚£ä¹ˆç”Ÿæˆé¡µé¢ã€‚</span>
            content <span class="token operator">=</span> callback<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å°†æ–°ç”Ÿæˆçš„é¡µé¢æ”¾åˆ°ç¼“å­˜é‡Œé¢ã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>pageKey<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// è¿”å›é¡µé¢ã€‚</span>
        <span class="token keyword">return</span> content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-æ•°æ®è¡Œç¼“å­˜"><a href="#æ¡ˆä¾‹-æ•°æ®è¡Œç¼“å­˜" class="header-anchor">#</a> æ¡ˆä¾‹-æ•°æ®è¡Œç¼“å­˜</h3> <p>ç”µå•†ç½‘ç«™å¯èƒ½ä¼šæœ‰ä¿ƒé”€ã€ç‰¹å–ã€æŠ½å¥–ç­‰æ´»åŠ¨ï¼Œè¿™äº›æ´»åŠ¨é¡µé¢åªéœ€è¦ä»æ•°æ®åº“ä¸­åŠ è½½å‡ è¡Œæ•°æ®ï¼Œå¦‚ï¼šç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ã€‚</p> <p>å¯ä»¥ä½¿ç”¨ <code>STRING</code> ç»“æ„æ¥ç¼“å­˜è¿™äº›æ•°æ®ï¼Œä½¿ç”¨ JSON å­˜å‚¨ç»“æ„åŒ–çš„ä¿¡æ¯ã€‚</p> <p>æ­¤å¤–ï¼Œéœ€è¦æœ‰ä¸¤ä¸ª <code>ZSET</code> ç»“æ„æ¥è®°å½•æ›´æ–°ç¼“å­˜çš„æ—¶æœºï¼š</p> <ul><li>ç¬¬ä¸€ä¸ªä¸ºè°ƒåº¦æœ‰åºé›†åˆï¼›</li> <li>ç¬¬äºŒä¸ªä¸ºå»¶æ—¶æœ‰åºé›†åˆã€‚</li></ul> <p>è®°å½•ç¼“å­˜æ—¶æœºï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scheduleRowCache</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> rowId<span class="token punctuation">,</span> <span class="token keyword">int</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å…ˆè®¾ç½®æ•°æ®è¡Œçš„å»¶è¿Ÿå€¼ã€‚</span>
        conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;delay:&quot;</span><span class="token punctuation">,</span> delay<span class="token punctuation">,</span> rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç«‹å³ç¼“å­˜æ•°æ®è¡Œã€‚</span>
        conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;schedule:&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">,</span> rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>å®šæ—¶æ›´æ–°æ•°æ®è¡Œç¼“å­˜ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheRowsThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Jedis</span> conn<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> quit<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CacheRowsThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>conn<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        quit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>quit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å°è¯•è·å–ä¸‹ä¸€ä¸ªéœ€è¦è¢«ç¼“å­˜çš„æ•°æ®è¡Œä»¥åŠè¯¥è¡Œçš„è°ƒåº¦æ—¶é—´æˆ³ï¼Œ</span>
            <span class="token comment">// å‘½ä»¤ä¼šè¿”å›ä¸€ä¸ªåŒ…å«é›¶ä¸ªæˆ–ä¸€ä¸ªå…ƒç»„ï¼ˆtupleï¼‰çš„åˆ—è¡¨ã€‚</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> range <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zrangeWithScores</span><span class="token punctuation">(</span><span class="token string">&quot;schedule:&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Tuple</span> next <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> range<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> next<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// æš‚æ—¶æ²¡æœ‰è¡Œéœ€è¦è¢«ç¼“å­˜ï¼Œä¼‘çœ 50æ¯«ç§’åé‡è¯•ã€‚</span>
                    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">String</span> rowId <span class="token operator">=</span> next<span class="token punctuation">.</span><span class="token function">getElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è·å–ä¸‹ä¸€æ¬¡è°ƒåº¦å‰çš„å»¶è¿Ÿæ—¶é—´ã€‚</span>
            <span class="token keyword">double</span> delay <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zscore</span><span class="token punctuation">(</span><span class="token string">&quot;delay:&quot;</span><span class="token punctuation">,</span> rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ä¸å¿…å†ç¼“å­˜è¿™ä¸ªè¡Œï¼Œå°†å®ƒä»ç¼“å­˜ä¸­ç§»é™¤ã€‚</span>
                conn<span class="token punctuation">.</span><span class="token function">zrem</span><span class="token punctuation">(</span><span class="token string">&quot;delay:&quot;</span><span class="token punctuation">,</span> rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                conn<span class="token punctuation">.</span><span class="token function">zrem</span><span class="token punctuation">(</span><span class="token string">&quot;schedule:&quot;</span><span class="token punctuation">,</span> rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                conn<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">&quot;inv:&quot;</span> <span class="token operator">+</span> rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// è¯»å–æ•°æ®è¡Œã€‚</span>
            <span class="token class-name">Inventory</span> row <span class="token operator">=</span> <span class="token class-name">Inventory</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ›´æ–°è°ƒåº¦æ—¶é—´å¹¶è®¾ç½®ç¼“å­˜å€¼ã€‚</span>
            conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;schedule:&quot;</span><span class="token punctuation">,</span> now <span class="token operator">+</span> delay<span class="token punctuation">,</span> rowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;inv:&quot;</span> <span class="token operator">+</span> rowId<span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-ç½‘é¡µåˆ†æ"><a href="#æ¡ˆä¾‹-ç½‘é¡µåˆ†æ" class="header-anchor">#</a> æ¡ˆä¾‹-ç½‘é¡µåˆ†æ</h3> <p>ç½‘ç«™å¯ä»¥é‡‡é›†ç”¨æˆ·çš„è®¿é—®ã€äº¤äº’ã€è´­ä¹°è¡Œä¸ºï¼Œå†åˆ†æç”¨æˆ·ä¹ æƒ¯ã€å–œå¥½ï¼Œä»è€Œåˆ¤æ–­å¸‚åœºè¡Œæƒ…å’Œæ½œåœ¨å•†æœºç­‰ã€‚</p> <p>é‚£ä¹ˆï¼Œç®€å•çš„ï¼Œå¦‚ä½•è®°å½•ç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´å†…è®¿é—®çš„å•†å“é¡µé¢å‘¢ï¼Ÿ</p> <p>å‚è€ƒ <a href="#%E6%9B%B4%E6%96%B0%E4%BB%A4%E7%89%8C">æ›´æ–°ä»¤ç‰Œ</a> ä»£ç ç¤ºä¾‹ï¼Œè®°å½•ç”¨æˆ·è®¿é—®ä¸åŒå•†å“çš„æµè§ˆæ¬¡æ•°ï¼Œå¹¶æ’åºã€‚</p> <p>åˆ¤æ–­é¡µé¢æ˜¯å¦éœ€è¦ç¼“å­˜ï¼Œæ ¹æ®è¯„åˆ†åˆ¤æ–­å•†å“é¡µé¢æ˜¯å¦çƒ­é—¨ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canCache</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> param <span class="token operator">:</span> url<span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pair <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pair<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// å°è¯•ä»é¡µé¢é‡Œé¢å–å‡ºå•†å“IDã€‚</span>
            <span class="token class-name">String</span> itemId <span class="token operator">=</span> <span class="token function">extractItemId</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ£€æŸ¥è¿™ä¸ªé¡µé¢èƒ½å¦è¢«ç¼“å­˜ä»¥åŠè¿™ä¸ªé¡µé¢æ˜¯å¦ä¸ºå•†å“é¡µé¢ã€‚</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>itemId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">isDynamic</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// å–å¾—å•†å“çš„æµè§ˆæ¬¡æ•°æ’åã€‚</span>
            <span class="token class-name">Long</span> rank <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zrank</span><span class="token punctuation">(</span><span class="token string">&quot;viewed:&quot;</span><span class="token punctuation">,</span> itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ ¹æ®å•†å“çš„æµè§ˆæ¬¡æ•°æ’åæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ç¼“å­˜è¿™ä¸ªé¡µé¢ã€‚</span>
            <span class="token keyword">return</span> rank <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rank <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> mue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-è®°å½•æ—¥å¿—"><a href="#æ¡ˆä¾‹-è®°å½•æ—¥å¿—" class="header-anchor">#</a> æ¡ˆä¾‹-è®°å½•æ—¥å¿—</h3> <p>å¯ç”¨ä½¿ç”¨ <code>LIST</code> ç»“æ„å­˜å‚¨æ—¥å¿—æ•°æ®ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logRecent</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> severity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> destination <span class="token operator">=</span> <span class="token string">&quot;recent:&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">':'</span> <span class="token operator">+</span> severity<span class="token punctuation">;</span>
        <span class="token class-name">Pipeline</span> pipe <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">pipelined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pipe<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span>destination<span class="token punctuation">,</span> TIMESTAMP<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">' '</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pipe<span class="token punctuation">.</span><span class="token function">ltrim</span><span class="token punctuation">(</span>destination<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pipe<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-ç»Ÿè®¡æ•°æ®"><a href="#æ¡ˆä¾‹-ç»Ÿè®¡æ•°æ®" class="header-anchor">#</a> æ¡ˆä¾‹-ç»Ÿè®¡æ•°æ®</h3> <p>æ›´æ–°è®¡æ•°å™¨ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> PRECISION <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token number">18000</span><span class="token punctuation">,</span> <span class="token number">86400</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateCounter</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> <span class="token keyword">long</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Transaction</span> trans <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> prec <span class="token operator">:</span> PRECISION<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> pnow <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">/</span> prec<span class="token punctuation">)</span> <span class="token operator">*</span> prec<span class="token punctuation">;</span>
            <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>prec<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">':'</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
            trans<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;known:&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
            trans<span class="token punctuation">.</span><span class="token function">hincrBy</span><span class="token punctuation">(</span><span class="token string">&quot;count:&quot;</span> <span class="token operator">+</span> hash<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>pnow<span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        trans<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>æŸ¥çœ‹è®¡æ•°å™¨æ•°æ®ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pair</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCounter</span><span class="token punctuation">(</span>
        <span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> precision<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>precision<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">':'</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">&quot;count:&quot;</span> <span class="token operator">+</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pair</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> data<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            results<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> results<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-æŸ¥æ‰¾-ip-æ‰€å±åœ°"><a href="#æ¡ˆä¾‹-æŸ¥æ‰¾-ip-æ‰€å±åœ°" class="header-anchor">#</a> æ¡ˆä¾‹-æŸ¥æ‰¾ IP æ‰€å±åœ°</h3> <p>Redis å®ç°çš„ IP æ‰€å±åœ°æŸ¥æ‰¾æ¯”å…³ç³»å‹æ•°æ®å®ç°æ–¹å¼æ›´å¿«ã€‚</p> <h4 id="è½½å…¥-ip-æ•°æ®"><a href="#è½½å…¥-ip-æ•°æ®" class="header-anchor">#</a> è½½å…¥ IP æ•°æ®</h4> <p>IP åœ°å€è½¬ä¸ºæ•´æ•°å€¼ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">ipToScore</span><span class="token punctuation">(</span><span class="token class-name">String</span> ipAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> v <span class="token operator">:</span> ipAddress<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            score <span class="token operator">=</span> score <span class="token operator">*</span> <span class="token number">256</span> <span class="token operator">+</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> score<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>åˆ›å»º IP åœ°å€ä¸åŸå¸‚ ID ä¹‹é—´çš„æ˜ å°„ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">importIpsToRedis</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileReader</span> reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// è½½å…¥ csv æ–‡ä»¶æ•°æ®</span>
            reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CSVFormat</span> csvFormat <span class="token operator">=</span> <span class="token class-name">CSVFormat</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">.</span><span class="token function">withRecordSeparator</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CSVParser</span> csvParser <span class="token operator">=</span> csvFormat<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CSVRecord</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> csvParser<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CSVRecord</span> line <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> startIp <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>startIp<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">'i'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// å°† IP åœ°å€è½¬ä¸ºæ•´æ•°å€¼</span>
                <span class="token keyword">int</span> score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>startIp<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    score <span class="token operator">=</span> <span class="token function">ipToScore</span><span class="token punctuation">(</span>startIp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        score <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>startIp<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span> nfe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// ç•¥è¿‡æ–‡ä»¶çš„ç¬¬ä¸€è¡Œä»¥åŠæ ¼å¼ä¸æ­£ç¡®çš„æ¡ç›®</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// æ„å»ºå”¯ä¸€çš„åŸå¸‚ ID</span>
                <span class="token class-name">String</span> cityId <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">'_'</span> <span class="token operator">+</span> count<span class="token punctuation">;</span>
                <span class="token comment">// å°†åŸå¸‚ ID åŠå…¶å¯¹åº”çš„ IP åœ°å€æ•´æ•°å€¼æ·»åŠ åˆ° ZSET</span>
                conn<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;ip2cityid:&quot;</span><span class="token punctuation">,</span> score<span class="token punctuation">,</span> cityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ignore</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>å­˜å‚¨åŸå¸‚ä¿¡æ¯ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">importCitiesToRedis</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileReader</span> reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// åŠ è½½ csv ä¿¡æ¯</span>
            reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CSVFormat</span> csvFormat <span class="token operator">=</span> <span class="token class-name">CSVFormat</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">.</span><span class="token function">withRecordSeparator</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CSVParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CSVParser</span><span class="token punctuation">(</span>reader<span class="token punctuation">,</span> csvFormat<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// String[] line;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CSVRecord</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CSVRecord</span> <span class="token keyword">record</span> <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// å°†åŸå¸‚åœ°ç†ä¿¡æ¯è½¬ä¸º json ç»“æ„ï¼Œå­˜å…¥ HASH ç»“æ„ä¸­</span>
                <span class="token class-name">String</span> cityId <span class="token operator">=</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> country <span class="token operator">=</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> region <span class="token operator">=</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> city <span class="token operator">=</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> city<span class="token punctuation">,</span> region<span class="token punctuation">,</span> country <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                conn<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;cityid2city:&quot;</span><span class="token punctuation">,</span> cityId<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ignore</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="æŸ¥æ‰¾-ip-æ‰€å±åŸå¸‚"><a href="#æŸ¥æ‰¾-ip-æ‰€å±åŸå¸‚" class="header-anchor">#</a> æŸ¥æ‰¾ IP æ‰€å±åŸå¸‚</h4> <p>æ“ä½œæ­¥éª¤ï¼š</p> <ol><li>å°†è¦æŸ¥æ‰¾çš„ IP åœ°å€è½¬ä¸ºæ•´æ•°å€¼ï¼›</li> <li>æŸ¥æ‰¾æ‰€æœ‰åˆ†å€¼å°äºç­‰äºè¦æŸ¥æ‰¾çš„ IP åœ°å€çš„åœ°å€ï¼Œå–å‡ºå…¶ä¸­æœ€å¤§åˆ†å€¼çš„é‚£ä¸ªè®°å½•ï¼›</li> <li>ç”¨æ‰¾åˆ°çš„è®°å½•æ‰€å¯¹åº”çš„åŸå¸‚ ID å»æ£€ç´¢åŸå¸‚ä¿¡æ¯ã€‚</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findCityByIp</span><span class="token punctuation">(</span><span class="token class-name">Jedis</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> ipAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> score <span class="token operator">=</span> <span class="token function">ipToScore</span><span class="token punctuation">(</span>ipAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">zrevrangeByScore</span><span class="token punctuation">(</span><span class="token string">&quot;ip2cityid:&quot;</span><span class="token punctuation">,</span> score<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> cityId <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cityId <span class="token operator">=</span> cityId<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cityId<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">'_'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">&quot;cityid2city:&quot;</span><span class="token punctuation">,</span> cityId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ˆä¾‹-æœåŠ¡çš„å‘ç°ä¸é…ç½®"><a href="#æ¡ˆä¾‹-æœåŠ¡çš„å‘ç°ä¸é…ç½®" class="header-anchor">#</a> æ¡ˆä¾‹-æœåŠ¡çš„å‘ç°ä¸é…ç½®</h3> <h3 id="æ¡ˆä¾‹-è‡ªåŠ¨è¡¥å…¨"><a href="#æ¡ˆä¾‹-è‡ªåŠ¨è¡¥å…¨" class="header-anchor">#</a> æ¡ˆä¾‹-è‡ªåŠ¨è¡¥å…¨</h3> <p>éœ€æ±‚ï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œè‡ªåŠ¨è¡¥å…¨ä¿¡æ¯ï¼Œå¦‚ï¼šè”ç³»äººã€å•†å“åç­‰ã€‚</p> <ul><li>å…¸å‹åœºæ™¯ä¸€ï¼šç¤¾äº¤ç½‘ç«™åå°è®°å½•ç”¨æˆ·æœ€è¿‘è”ç³»è¿‡çš„ 100 ä¸ªå¥½å‹ï¼Œå½“ç”¨æˆ·æŸ¥æ‰¾å¥½å‹æ—¶ï¼Œæ ¹æ®è¾“å…¥çš„å…³é”®å­—è‡ªåŠ¨è¡¥å…¨å§“åã€‚</li> <li>å…¸å‹åœºæ™¯äºŒï¼šç”µå•†ç½‘ç«™åå°è®°å½•ç”¨æˆ·æœ€è¿‘æµè§ˆè¿‡çš„ 10 ä»¶å•†å“ï¼Œå½“ç”¨æˆ·æŸ¥æ‰¾å•†å“æ˜¯ï¼Œæ ¹æ®è¾“å…¥çš„å…³é”®å­—è‡ªåŠ¨è¡¥å…¨å•†å“åç§°ã€‚</li></ul> <p>æ•°æ®æ¨¡å‹ï¼šä½¿ç”¨ Redis çš„ LIST ç±»å‹å­˜å‚¨æœ€è¿‘è”ç³»äººåˆ—è¡¨ã€‚</p> <p>æ„å»ºè‡ªåŠ¨è¡¥å…¨åˆ—è¡¨é€šå¸¸æœ‰ä»¥ä¸‹æ“ä½œï¼š</p> <ul><li>å¦‚æœæŒ‡å®šè”ç³»äººå·²ç»å­˜åœ¨äºæœ€è¿‘è”ç³»äººåˆ—è¡¨é‡Œï¼Œé‚£ä¹ˆä»åˆ—è¡¨é‡Œç§»é™¤ä»–ã€‚å¯¹åº” <code>LREM</code> å‘½ä»¤ã€‚</li> <li>å°†æŒ‡å®šè”ç³»äººæ·»åŠ åˆ°æœ€è¿‘è”ç³»äººåˆ—è¡¨çš„æœ€å‰é¢ã€‚å¯¹åº” <code>LPUSH</code> å‘½ä»¤ã€‚</li> <li>æ·»åŠ æ“ä½œå®Œæˆåï¼Œå¦‚æœè”ç³»äººåˆ—è¡¨ä¸­çš„æ•°é‡è¶…è¿‡ 100 ä¸ªï¼Œè¿›è¡Œè£å‰ªæ“ä½œã€‚å¯¹åº” <code>LTRIM</code> å‘½ä»¤ã€‚</li></ul> <h3 id="æ¡ˆä¾‹-å¹¿å‘Šå®šå‘"><a href="#æ¡ˆä¾‹-å¹¿å‘Šå®šå‘" class="header-anchor">#</a> æ¡ˆä¾‹-å¹¿å‘Šå®šå‘</h3> <h3 id="æ¡ˆä¾‹-èŒä½æœç´¢"><a href="#æ¡ˆä¾‹-èŒä½æœç´¢" class="header-anchor">#</a> æ¡ˆä¾‹-èŒä½æœç´¢</h3> <p>éœ€æ±‚ï¼šåœ¨ä¸€ä¸ªæ‹›è˜ç½‘ç«™ä¸Šï¼Œæ±‚èŒè€…æœ‰è‡ªå·±çš„æŠ€èƒ½æ¸…å•ï¼›ç”¨äººå…¬å¸çš„èŒä½æœ‰å¿…è¦çš„æŠ€èƒ½æ¸…å•ã€‚ç”¨äººå…¬å¸éœ€è¦æŸ¥è¯¢æ»¡è¶³è‡ªå·±èŒä½è¦æ±‚çš„æ±‚èŒè€…ï¼›æ±‚èŒè€…éœ€è¦æŸ¥è¯¢è‡ªå·±å¯ä»¥æŠ•é€’ç®€å†çš„èŒä½ã€‚</p> <p>å…³é”®æ•°æ®æ¨¡å‹ï¼šä½¿ç”¨ <code>SET</code> ç±»å‹å­˜å‚¨æ±‚èŒè€…çš„æŠ€èƒ½åˆ—è¡¨ï¼Œä½¿ç”¨ <code>SET</code> ç±»å‹å­˜å‚¨èŒä½çš„æŠ€èƒ½åˆ—è¡¨ã€‚</p> <p>å…³é”®æ“ä½œï¼šä½¿ç”¨ <code>SDIFF</code> å‘½ä»¤å¯¹æ¯”ä¸¤ä¸ª <code>SET</code> çš„å·®å¼‚ï¼Œè¿”å› <code>empty</code> è¡¨ç¤ºåŒ¹é…è¦æ±‚ã€‚</p> <p>redis cli ç¤ºä¾‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># -----------------------------------------------------------</span>
<span class="token comment"># Redis èŒä½æœç´¢æ•°æ®æ¨¡å‹ç¤ºä¾‹</span>
<span class="token comment"># -----------------------------------------------------------</span>

<span class="token comment"># ï¼ˆ1ï¼‰èŒä½æŠ€èƒ½è¡¨ï¼šä½¿ç”¨ set å­˜å‚¨</span>
<span class="token comment"># job:001 èŒä½æ·»åŠ  4 ç§æŠ€èƒ½</span>
SADD job:001 skill:001
SADD job:001 skill:002
SADD job:001 skill:003
SADD job:001 skill:004

<span class="token comment"># job:002 èŒä½æ·»åŠ  3 ç§æŠ€èƒ½</span>
SADD job:002 skill:001
SADD job:002 skill:002
SADD job:002 skill:003

<span class="token comment"># job:003 èŒä½æ·»åŠ  2 ç§æŠ€èƒ½</span>
SADD job:003 skill:001
SADD job:003 skill:003

<span class="token comment"># æŸ¥çœ‹</span>
SMEMBERS job:001
SMEMBERS job:002
SMEMBERS job:003

<span class="token comment"># ï¼ˆ2ï¼‰æ±‚èŒè€…æŠ€èƒ½è¡¨ï¼šä½¿ç”¨ set å­˜å‚¨</span>
SADD interviewee:001 skill:001
SADD interviewee:001 skill:003

SADD interviewee:002 skill:001
SADD interviewee:002 skill:002
SADD interviewee:002 skill:003
SADD interviewee:002 skill:004
SADD interviewee:002 skill:005

<span class="token comment"># æŸ¥çœ‹</span>
SMEMBERS interviewee:001
SMEMBERS interviewee:002

<span class="token comment"># ï¼ˆ3ï¼‰æ±‚èŒè€…éå†æŸ¥æ‰¾è‡ªå·±ç¬¦åˆè¦æ±‚çš„èŒä½ï¼ˆè¿”å›ç»“æœä¸º empty è¡¨ç¤ºè¦æ±‚çš„æŠ€èƒ½å…¨éƒ¨å‘½ä¸­ï¼‰</span>
<span class="token comment"># æ¯”è¾ƒèŒä½æŠ€èƒ½æ¸…å•å’Œæ±‚èŒè€…æŠ€èƒ½æ¸…å•çš„å·®å¼‚</span>
SDIFF job:001 interviewee:001
SDIFF job:002 interviewee:001
SDIFF job:003 interviewee:001

SDIFF job:001 interviewee:002
SDIFF job:002 interviewee:002
SDIFF job:003 interviewee:002

<span class="token comment"># ï¼ˆ4ï¼‰ç”¨äººå…¬å¸æ ¹æ®éå†æŸ¥æ‰¾ç¬¦åˆè‡ªå·±èŒä½è¦æ±‚çš„æ±‚èŒè€…ï¼ˆè¿”å›ç»“æœä¸º empty è¡¨ç¤ºè¦æ±‚çš„æŠ€èƒ½å…¨éƒ¨å‘½ä¸­ï¼‰</span>
<span class="token comment"># æ¯”è¾ƒèŒä½æŠ€èƒ½æ¸…å•å’Œæ±‚èŒè€…æŠ€èƒ½æ¸…å•çš„å·®å¼‚</span>
SDIFF interviewee:001 job:001
SDIFF interviewee:002 job:001

SDIFF interviewee:001 job:002
SDIFF interviewee:002 job:002

SDIFF interviewee:001 job:003
SDIFF interviewee:002 job:003
</code></pre></div><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <ul><li><strong>å®˜ç½‘</strong> <ul><li><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis å®˜ç½‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/antirez/redis" target="_blank" rel="noopener noreferrer">Redis github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://redis.cn/" target="_blank" rel="noopener noreferrer">Redis å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>ä¹¦ç±</strong> <ul><li><a href="https://item.jd.com/11791607.html" target="_blank" rel="noopener noreferrer">ã€ŠRedis å®æˆ˜ã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://item.jd.com/11486101.html" target="_blank" rel="noopener noreferrer">ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>æ•™ç¨‹</strong> <ul><li><a href="http://redisdoc.com/" target="_blank" rel="noopener noreferrer">Redis å‘½ä»¤å‚è€ƒ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>æ–‡ç« </strong> <ul><li><a href="https://blog.csdn.net/u011957758/article/details/74783347" target="_blank" rel="noopener noreferrer">ä¸€çœ‹å°±æ‡‚ç³»åˆ—ä¹‹ è¯¦è§£ redis çš„ bitmap åœ¨äº¿çº§é¡¹ç›®ä¸­çš„åº”ç”¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://blog.getspool.com/2011/11/29/fast-easy-realtime-metrics-using-redis-bitmaps/" target="_blank" rel="noopener noreferrer">Fast, easy, realtime metrics using Redis bitmaps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/db-tutorial/edit/master/docs/nosql/redis/redis-datatype.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">8 months ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/db-tutorial/assets/js/app.3241dbe7.js" defer></script><script src="/db-tutorial/assets/js/4.4288f8e2.js" defer></script><script src="/db-tutorial/assets/js/52.780ee075.js" defer></script><script src="/db-tutorial/assets/js/5.9d6e4fe2.js" defer></script>
  </body>
</html>
