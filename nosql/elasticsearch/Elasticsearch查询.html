<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch æŸ¥è¯¢ | DB-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/db-tutorial/favicon.ico">
    <meta name="description" content="æ•°æ®åº“æ•™ç¨‹">
    
    <link rel="preload" href="/db-tutorial/assets/css/0.styles.f78e4e1a.css" as="style"><link rel="preload" href="/db-tutorial/assets/js/app.3241dbe7.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/4.4288f8e2.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/21.bb9e859e.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/5.9d6e4fe2.js" as="script"><link rel="prefetch" href="/db-tutorial/assets/js/10.ed8ad29b.js"><link rel="prefetch" href="/db-tutorial/assets/js/11.fe610bae.js"><link rel="prefetch" href="/db-tutorial/assets/js/12.a246bf62.js"><link rel="prefetch" href="/db-tutorial/assets/js/13.3e80d87c.js"><link rel="prefetch" href="/db-tutorial/assets/js/14.550882cc.js"><link rel="prefetch" href="/db-tutorial/assets/js/15.5e1b41b9.js"><link rel="prefetch" href="/db-tutorial/assets/js/16.6bca419e.js"><link rel="prefetch" href="/db-tutorial/assets/js/17.a5628e11.js"><link rel="prefetch" href="/db-tutorial/assets/js/18.11142214.js"><link rel="prefetch" href="/db-tutorial/assets/js/19.b7dd25b2.js"><link rel="prefetch" href="/db-tutorial/assets/js/20.743a9fc2.js"><link rel="prefetch" href="/db-tutorial/assets/js/22.8793bf57.js"><link rel="prefetch" href="/db-tutorial/assets/js/23.aa1a0789.js"><link rel="prefetch" href="/db-tutorial/assets/js/24.989edd40.js"><link rel="prefetch" href="/db-tutorial/assets/js/25.f951c2ea.js"><link rel="prefetch" href="/db-tutorial/assets/js/26.46d14ec4.js"><link rel="prefetch" href="/db-tutorial/assets/js/27.bbb4d038.js"><link rel="prefetch" href="/db-tutorial/assets/js/28.ca5b12bf.js"><link rel="prefetch" href="/db-tutorial/assets/js/29.ed8acf51.js"><link rel="prefetch" href="/db-tutorial/assets/js/30.4c80e86e.js"><link rel="prefetch" href="/db-tutorial/assets/js/31.270d3076.js"><link rel="prefetch" href="/db-tutorial/assets/js/32.63fd0b9f.js"><link rel="prefetch" href="/db-tutorial/assets/js/33.71243bd6.js"><link rel="prefetch" href="/db-tutorial/assets/js/34.e1c65173.js"><link rel="prefetch" href="/db-tutorial/assets/js/35.535365fb.js"><link rel="prefetch" href="/db-tutorial/assets/js/36.269fbb7d.js"><link rel="prefetch" href="/db-tutorial/assets/js/37.54d40d65.js"><link rel="prefetch" href="/db-tutorial/assets/js/38.70c2df36.js"><link rel="prefetch" href="/db-tutorial/assets/js/39.720ed2bc.js"><link rel="prefetch" href="/db-tutorial/assets/js/40.42f49b04.js"><link rel="prefetch" href="/db-tutorial/assets/js/41.816b4788.js"><link rel="prefetch" href="/db-tutorial/assets/js/42.7812fbfa.js"><link rel="prefetch" href="/db-tutorial/assets/js/43.40e17f2b.js"><link rel="prefetch" href="/db-tutorial/assets/js/44.d4bf4d23.js"><link rel="prefetch" href="/db-tutorial/assets/js/45.de070dec.js"><link rel="prefetch" href="/db-tutorial/assets/js/46.72b9fb0c.js"><link rel="prefetch" href="/db-tutorial/assets/js/47.0d15ed92.js"><link rel="prefetch" href="/db-tutorial/assets/js/48.62942aa8.js"><link rel="prefetch" href="/db-tutorial/assets/js/49.5cc48c74.js"><link rel="prefetch" href="/db-tutorial/assets/js/50.05a3829b.js"><link rel="prefetch" href="/db-tutorial/assets/js/51.c4a344da.js"><link rel="prefetch" href="/db-tutorial/assets/js/52.780ee075.js"><link rel="prefetch" href="/db-tutorial/assets/js/53.db2f332a.js"><link rel="prefetch" href="/db-tutorial/assets/js/54.0e78a0f9.js"><link rel="prefetch" href="/db-tutorial/assets/js/55.6541a955.js"><link rel="prefetch" href="/db-tutorial/assets/js/56.148da909.js"><link rel="prefetch" href="/db-tutorial/assets/js/57.c474daee.js"><link rel="prefetch" href="/db-tutorial/assets/js/58.c896e61d.js"><link rel="prefetch" href="/db-tutorial/assets/js/59.078e1f3a.js"><link rel="prefetch" href="/db-tutorial/assets/js/6.11804af7.js"><link rel="prefetch" href="/db-tutorial/assets/js/60.1169b208.js"><link rel="prefetch" href="/db-tutorial/assets/js/61.31b49b6a.js"><link rel="prefetch" href="/db-tutorial/assets/js/62.5e22d6f5.js"><link rel="prefetch" href="/db-tutorial/assets/js/63.d0836f60.js"><link rel="prefetch" href="/db-tutorial/assets/js/64.1e454e0d.js"><link rel="prefetch" href="/db-tutorial/assets/js/65.862548ea.js"><link rel="prefetch" href="/db-tutorial/assets/js/66.597479ba.js"><link rel="prefetch" href="/db-tutorial/assets/js/67.c19ec16c.js"><link rel="prefetch" href="/db-tutorial/assets/js/68.7794c626.js"><link rel="prefetch" href="/db-tutorial/assets/js/69.a99ae4f0.js"><link rel="prefetch" href="/db-tutorial/assets/js/7.d55602d2.js"><link rel="prefetch" href="/db-tutorial/assets/js/70.34e977d4.js"><link rel="prefetch" href="/db-tutorial/assets/js/71.c1b90167.js"><link rel="prefetch" href="/db-tutorial/assets/js/72.9792a914.js"><link rel="prefetch" href="/db-tutorial/assets/js/73.6fbf9550.js"><link rel="prefetch" href="/db-tutorial/assets/js/74.b8949f4c.js"><link rel="prefetch" href="/db-tutorial/assets/js/75.3c3abd9f.js"><link rel="prefetch" href="/db-tutorial/assets/js/76.729c9c46.js"><link rel="prefetch" href="/db-tutorial/assets/js/77.a1a0aa21.js"><link rel="prefetch" href="/db-tutorial/assets/js/8.89e9ace9.js"><link rel="prefetch" href="/db-tutorial/assets/js/9.0c40eb95.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~flowchart.5998caa6.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~notification.943e54fe.js">
    <link rel="stylesheet" href="/db-tutorial/assets/css/0.styles.f78e4e1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/db-tutorial/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="DB-TUTORIAL" class="logo"> <span class="site-name can-hide">DB-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/db-tutorial/sql/" class="nav-link">
  SQL
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/" class="nav-link router-link-active">
  NOSQL
</a></div><div class="nav-item"><a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/elasticsearch/" class="nav-link router-link-active">
  Elasticsearch
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/mongodb/" class="nav-link">
  MongoDB
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/db-tutorial/sql/" class="nav-link">
  SQL
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/" class="nav-link router-link-active">
  NOSQL
</a></div><div class="nav-item"><a href="/db-tutorial/sql/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/elasticsearch/" class="nav-link router-link-active">
  Elasticsearch
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/mongodb/" class="nav-link">
  MongoDB
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Elasticsearch æŸ¥è¯¢</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-å…¨æ–‡æŸ¥è¯¢" class="sidebar-link">1. å…¨æ–‡æŸ¥è¯¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-1-intervals-query" class="sidebar-link">1.1. intervals query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-2-match-query" class="sidebar-link">1.2. match query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-3-match-bool-prefix-query" class="sidebar-link">1.3. matchboolprefix query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-4-match-phrase-query" class="sidebar-link">1.4. match_phrase query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-5-match-phrase-prefix-query" class="sidebar-link">1.5. matchphraseprefix query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-6-multi-match-query" class="sidebar-link">1.6. multi_match query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-7-combined-fields-query" class="sidebar-link">1.7. combined_fields query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-8-common-terms-query" class="sidebar-link">1.8. common_terms query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-9-query-string-query" class="sidebar-link">1.9. query_string query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-10-simple-query-string-query" class="sidebar-link">1.10. simplequerystring query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_1-11-å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹" class="sidebar-link">1.11. å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</a></li></ul></li><li><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-è¯é¡¹æŸ¥è¯¢" class="sidebar-link">2. è¯é¡¹æŸ¥è¯¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-1-exists-query" class="sidebar-link">2.1. exists query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-2-fuzzy-query" class="sidebar-link">2.2. fuzzy query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-3-ids-query" class="sidebar-link">2.3. ids query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-4-prefix-query" class="sidebar-link">2.4. prefix query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-5-range-query" class="sidebar-link">2.5. range query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-6-regexp-query" class="sidebar-link">2.6. regexp query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-7-term-query" class="sidebar-link">2.7. term query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-8-terms-query" class="sidebar-link">2.8. terms query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-9-type-query" class="sidebar-link">2.9. type query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-10-wildcard-query" class="sidebar-link">2.10. wildcard query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_2-11-è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹" class="sidebar-link">2.11. è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</a></li></ul></li><li><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_3-å¤åˆæŸ¥è¯¢" class="sidebar-link">3. å¤åˆæŸ¥è¯¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_3-1-bool-query" class="sidebar-link">3.1. bool query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_3-2-boosting-query" class="sidebar-link">3.2. boosting query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_3-3-constant-score-query" class="sidebar-link">3.3. constant_score query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_3-4-dis-max-query" class="sidebar-link">3.4. dis_max query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_3-5-function-score-query" class="sidebar-link">3.5. function_score query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_3-6-indices-query" class="sidebar-link">3.6. indices query</a></li></ul></li><li><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_4-åµŒå¥—æŸ¥è¯¢" class="sidebar-link">4. åµŒå¥—æŸ¥è¯¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_4-1-nested-query" class="sidebar-link">4.1. nested query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_4-2-has-child-query" class="sidebar-link">4.2. has_child query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_4-3-has-parent-query" class="sidebar-link">4.3. has_parent query</a></li></ul></li><li><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_5-ä½ç½®æŸ¥è¯¢" class="sidebar-link">5. ä½ç½®æŸ¥è¯¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_5-1-geo-distance-query" class="sidebar-link">5.1. geo_distance query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_5-2-geo-bounding-box-query" class="sidebar-link">5.2. geoboundingbox query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_5-3-geo-polygon-query" class="sidebar-link">5.3. geo_polygon query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_5-4-geo-shape-query" class="sidebar-link">5.4. geo_shape query</a></li></ul></li><li><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_6-ç‰¹æ®ŠæŸ¥è¯¢" class="sidebar-link">6. ç‰¹æ®ŠæŸ¥è¯¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_6-1-more-like-this-query" class="sidebar-link">6.1. morelikethis query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_6-2-script-query" class="sidebar-link">6.2. script query</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/nosql/elasticsearch/Elasticsearch%E6%9F%A5%E8%AF%A2.html#_6-3-percolate-query" class="sidebar-link">6.3. percolate query</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="elasticsearch-æŸ¥è¯¢"><a href="#elasticsearch-æŸ¥è¯¢" class="header-anchor">#</a> Elasticsearch æŸ¥è¯¢</h1> <p>Elasticsearch æŸ¥è¯¢è¯­å¥é‡‡ç”¨åŸºäº RESTful é£æ ¼çš„æ¥å£å°è£…æˆ JSON æ ¼å¼çš„å¯¹è±¡ï¼Œç§°ä¹‹ä¸º Query DSLã€‚Elasticsearch æŸ¥è¯¢åˆ†ç±»å¤§è‡´åˆ†ä¸º<strong>å…¨æ–‡æŸ¥è¯¢</strong>ã€<strong>è¯é¡¹æŸ¥è¯¢</strong>ã€<strong>å¤åˆæŸ¥è¯¢</strong>ã€<strong>åµŒå¥—æŸ¥è¯¢</strong>ã€<strong>ä½ç½®æŸ¥è¯¢</strong>ã€<strong>ç‰¹æ®ŠæŸ¥è¯¢</strong>ã€‚Elasticsearch æŸ¥è¯¢ä»æœºåˆ¶åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢è¯ï¼Œé€šè¿‡æ’åºæ¨¡å‹è®¡ç®—æ–‡æ¡£ä¸æŸ¥è¯¢è¯ä¹‹é—´çš„<strong>ç›¸å…³åº¦</strong>ï¼Œå¹¶æ ¹æ®è¯„åˆ†é«˜ä½æ’åºè¿”å›ï¼›å¦ä¸€ç§æ˜¯<strong>è¿‡æ»¤æœºåˆ¶</strong>ï¼Œåªæ ¹æ®è¿‡æ»¤æ¡ä»¶å¯¹æ–‡æ¡£è¿›è¡Œè¿‡æ»¤ï¼Œä¸è®¡ç®—è¯„åˆ†ï¼Œé€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ã€‚</p> <ul><li><a href="#1-%E5%85%A8%E6%96%87%E6%9F%A5%E8%AF%A2">1. å…¨æ–‡æŸ¥è¯¢</a> <ul><li><a href="#11-intervals-query">1.1. intervals query</a></li> <li><a href="#12-match-query">1.2. match query</a></li> <li><a href="#13-match_bool_prefix-query">1.3. match_bool_prefix query</a></li> <li><a href="#14-match_phrase-query">1.4. match_phrase query</a></li> <li><a href="#15-match_phrase_prefix-query">1.5. match_phrase_prefix query</a></li> <li><a href="#16-multi_match-query">1.6. multi_match query</a></li> <li><a href="#17-combined_fields-query">1.7. combined_fields query</a></li> <li><a href="#18-common_terms-query">1.8. common_terms query</a></li> <li><a href="#19-query_string-query">1.9. query_string query</a></li> <li><a href="#110-simple_query_string-query">1.10. simple_query_string query</a></li> <li><a href="#111-%E5%85%A8%E6%96%87%E6%9F%A5%E8%AF%A2%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B">1.11. å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</a></li></ul></li> <li><a href="#2-%E8%AF%8D%E9%A1%B9%E6%9F%A5%E8%AF%A2">2. è¯é¡¹æŸ¥è¯¢</a> <ul><li><a href="#21-exists-query">2.1. exists query</a></li> <li><a href="#22-fuzzy-query">2.2. fuzzy query</a></li> <li><a href="#23-ids-query">2.3. ids query</a></li> <li><a href="#24-prefix-query">2.4. prefix query</a></li> <li><a href="#25-range-query">2.5. range query</a></li> <li><a href="#26-regexp-query">2.6. regexp query</a></li> <li><a href="#27-term-query">2.7. term query</a></li> <li><a href="#28-terms-query">2.8. terms query</a></li> <li><a href="#29-type-query">2.9. type query</a></li> <li><a href="#210-wildcard-query">2.10. wildcard query</a></li> <li><a href="#211-%E8%AF%8D%E9%A1%B9%E6%9F%A5%E8%AF%A2%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B">2.11. è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</a></li></ul></li> <li><a href="#3-%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2">3. å¤åˆæŸ¥è¯¢</a> <ul><li><a href="#31-bool-query">3.1. bool query</a></li> <li><a href="#32-boosting-query">3.2. boosting query</a></li> <li><a href="#33-constant_score-query">3.3. constant_score query</a></li> <li><a href="#34-dis_max-query">3.4. dis_max query</a></li> <li><a href="#35-function_score-query">3.5. function_score query</a></li> <li><a href="#36-indices-query">3.6. indices query</a></li></ul></li> <li><a href="#4-%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2">4. åµŒå¥—æŸ¥è¯¢</a> <ul><li><a href="#41-nested-query">4.1. nested query</a></li> <li><a href="#42-has_child-query">4.2. has_child query</a></li> <li><a href="#43-has_parent-query">4.3. has_parent query</a></li></ul></li> <li><a href="#5-%E4%BD%8D%E7%BD%AE%E6%9F%A5%E8%AF%A2">5. ä½ç½®æŸ¥è¯¢</a> <ul><li><a href="#51-geo_distance-query">5.1. geo_distance query</a></li> <li><a href="#52-geo_bounding_box-query">5.2. geo_bounding_box query</a></li> <li><a href="#53-geo_polygon-query">5.3. geo_polygon query</a></li> <li><a href="#54-geo_shape-query">5.4. geo_shape query</a></li></ul></li> <li><a href="#6-%E7%89%B9%E6%AE%8A%E6%9F%A5%E8%AF%A2">6. ç‰¹æ®ŠæŸ¥è¯¢</a> <ul><li><a href="#61-more_like_this-query">6.1. more_like_this query</a></li> <li><a href="#62-script-query">6.2. script query</a></li> <li><a href="#63-percolate-query">6.3. percolate query</a></li></ul></li></ul> <h2 id="_1-å…¨æ–‡æŸ¥è¯¢"><a href="#_1-å…¨æ–‡æŸ¥è¯¢" class="header-anchor">#</a> 1. å…¨æ–‡æŸ¥è¯¢</h2> <p>ES å…¨æ–‡æŸ¥è¯¢ä¸»è¦ç”¨äºåœ¨å…¨æ–‡å­—æ®µä¸Šï¼Œä¸»è¦è€ƒè™‘æŸ¥è¯¢è¯ä¸æ–‡æ¡£çš„ç›¸å…³æ€§ï¼ˆRelevanceï¼‰ã€‚</p> <h3 id="_1-1-intervals-query"><a href="#_1-1-intervals-query" class="header-anchor">#</a> 1.1. intervals query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-intervals-query.html" target="_blank" rel="noopener noreferrer"><strong><code>intervals query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ ¹æ®åŒ¹é…è¯çš„é¡ºåºå’Œè¿‘ä¼¼åº¦è¿”å›æ–‡æ¡£ã€‚</p> <p>intervals query ä½¿ç”¨<strong>åŒ¹é…è§„åˆ™</strong>ï¼Œè¿™äº›è§„åˆ™åº”ç”¨äºæŒ‡å®šå­—æ®µä¸­çš„ termã€‚</p> <p>ç¤ºä¾‹ï¼šä¸‹é¢ç¤ºä¾‹æœç´¢ <code>query</code> å­—æ®µï¼Œæœç´¢å€¼æ˜¯ <code>my favorite food</code>ï¼Œæ²¡æœ‰ä»»ä½•é—´éš™ï¼›ç„¶åæ˜¯ <code>my_text</code> å­—æ®µæœç´¢åŒ¹é… <code>hot water</code>ã€<code>cold porridge</code> çš„ termã€‚</p> <p>å½“ my_text ä¸­çš„å€¼ä¸º <code>my favorite food is cold porridge</code> æ—¶ï¼Œä¼šåŒ¹é…æˆåŠŸï¼Œä½†æ˜¯ <code>when it's cold my favorite food is porridge</code> åˆ™åŒ¹é…å¤±è´¥</p> <div class="language-bash extra-class"><pre class="language-bash"><code>POST _search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;intervals&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;my_text&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;all_of&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;ordered&quot;</span> <span class="token builtin class-name">:</span> true,
          <span class="token string">&quot;intervals&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token string">&quot;match&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;my favorite food&quot;</span>,
                <span class="token string">&quot;max_gaps&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
                <span class="token string">&quot;ordered&quot;</span> <span class="token builtin class-name">:</span> <span class="token boolean">true</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>,
            <span class="token punctuation">{</span>
              <span class="token string">&quot;any_of&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;intervals&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                  <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;hot water&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
                  <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;cold porridge&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-2-match-query"><a href="#_1-2-match-query" class="header-anchor">#</a> 1.2. match query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <strong>ç”¨äºæœç´¢å•ä¸ªå­—æ®µ</strong>ï¼Œé¦–å…ˆä¼šé’ˆå¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œè§£æï¼ˆç»è¿‡ analyzerï¼‰ï¼Œä¸»è¦æ˜¯å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ†è¯ï¼Œåˆ†è¯åæŸ¥è¯¢è¯­å¥çš„ä»»ä½•ä¸€ä¸ªè¯é¡¹è¢«åŒ¹é…ï¼Œæ–‡æ¡£å°±ä¼šè¢«æœåˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ç›¸å½“äºå¯¹åˆ†è¯åè¯é¡¹è¿›è¡Œ or åŒ¹é…æ“ä½œã€‚</p> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯æ‰§è¡Œå…¨æ–‡æœç´¢çš„æ ‡å‡†æŸ¥è¯¢ï¼ŒåŒ…æ‹¬æ¨¡ç³ŠåŒ¹é…é€‰é¡¹ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;customer_full_name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;George Hubbard&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç­‰åŒäº <code>or</code> åŒ¹é…æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;customer_full_name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;George Hubbard&quot;</span>,
        <span class="token string">&quot;operator&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;or&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="match-query-ç®€å†™"><a href="#match-query-ç®€å†™" class="header-anchor">#</a> match query ç®€å†™</h4> <p>å¯ä»¥é€šè¿‡ç»„åˆ <code>&lt;field&gt;</code> å’Œ <code>query</code> å‚æ•°æ¥ç®€åŒ–åŒ¹é…æŸ¥è¯¢è¯­æ³•ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;this is a test&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="match-query-å¦‚ä½•å·¥ä½œ"><a href="#match-query-å¦‚ä½•å·¥ä½œ" class="header-anchor">#</a> match query å¦‚ä½•å·¥ä½œ</h4> <p>åŒ¹é…æŸ¥è¯¢æ˜¯å¸ƒå°”ç±»å‹ã€‚è¿™æ„å‘³ç€ä¼šå¯¹æä¾›çš„æ–‡æœ¬è¿›è¡Œåˆ†æï¼Œåˆ†æè¿‡ç¨‹ä»æä¾›çš„æ–‡æœ¬æ„é€ ä¸€ä¸ªå¸ƒå°”æŸ¥è¯¢ã€‚ <code>operator</code> å‚æ•°å¯ä»¥è®¾ç½®ä¸º <code>or</code> æˆ– <code>and</code> æ¥æ§åˆ¶å¸ƒå°”å­å¥ï¼ˆé»˜è®¤ä¸º <code>or</code>ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html" target="_blank" rel="noopener noreferrer"><code>minimum_should_match</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å‚æ•°è®¾ç½®è¦åŒ¹é…çš„å¯é€‰ <code>should</code> å­å¥çš„æœ€å°æ•°é‡ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;customer_full_name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;George Hubbard&quot;</span>,
        <span class="token string">&quot;operator&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;and&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥è®¾ç½® <code>analyzer</code> æ¥æ§åˆ¶å“ªä¸ªåˆ†æå™¨å°†å¯¹æ–‡æœ¬æ‰§è¡Œåˆ†æè¿‡ç¨‹ã€‚å®ƒé»˜è®¤ä¸ºå­—æ®µæ˜¾å¼æ˜ å°„å®šä¹‰æˆ–é»˜è®¤æœç´¢åˆ†æå™¨ã€‚</p> <p><code>lenient</code> å‚æ•°å¯ä»¥è®¾ç½®ä¸º <code>true</code> ä»¥å¿½ç•¥ç”±æ•°æ®ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„å¼‚å¸¸ï¼Œä¾‹å¦‚å°è¯•ä½¿ç”¨æ–‡æœ¬æŸ¥è¯¢å­—ç¬¦ä¸²æŸ¥è¯¢æ•°å­—å­—æ®µã€‚é»˜è®¤ä¸º <code>false</code>ã€‚</p> <h4 id="match-query-çš„æ¨¡ç³ŠæŸ¥è¯¢"><a href="#match-query-çš„æ¨¡ç³ŠæŸ¥è¯¢" class="header-anchor">#</a> match query çš„æ¨¡ç³ŠæŸ¥è¯¢</h4> <p><code>fuzziness</code> å…è®¸åŸºäºè¢«æŸ¥è¯¢å­—æ®µçš„ç±»å‹è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚è¯·å‚é˜… <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#fuzziness" target="_blank" rel="noopener noreferrer">Fuzziness<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> çš„é…ç½®ã€‚</p> <p>åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥è®¾ç½® <code>prefix_length</code> å’Œ <code>max_expansions</code> æ¥æ§åˆ¶æ¨¡ç³ŠåŒ¹é…ã€‚å¦‚æœè®¾ç½®äº†æ¨¡ç³Šé€‰é¡¹ï¼ŒæŸ¥è¯¢å°†ä½¿ç”¨ <code>top_terms_blended_freqs_${max_expansions}</code> ä½œä¸ºå…¶é‡å†™æ–¹æ³•ï¼Œ<code>fuzzy_rewrite</code> å‚æ•°å…è®¸æ§åˆ¶æŸ¥è¯¢å°†å¦‚ä½•è¢«é‡å†™ã€‚</p> <p>é»˜è®¤æƒ…å†µä¸‹å…è®¸æ¨¡ç³Šå€’è½¬ (<code>ab</code> â†’ <code>ba</code>)ï¼Œä½†å¯ä»¥é€šè¿‡å°† <code>fuzzy_transpositions</code> è®¾ç½®ä¸º <code>false</code> æ¥ç¦ç”¨ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;this is a testt&quot;</span>,
        <span class="token string">&quot;fuzziness&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;AUTO&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="zero-terms-æŸ¥è¯¢"><a href="#zero-terms-æŸ¥è¯¢" class="header-anchor">#</a> zero terms æŸ¥è¯¢</h4> <p>å¦‚æœä½¿ç”¨çš„åˆ†æå™¨åƒ stop è¿‡æ»¤å™¨ä¸€æ ·åˆ é™¤æŸ¥è¯¢ä¸­çš„æ‰€æœ‰æ ‡è®°ï¼Œåˆ™é»˜è®¤è¡Œä¸ºæ˜¯ä¸åŒ¹é…ä»»ä½•æ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨ <code>zero_terms_query</code> é€‰é¡¹æ¥æ”¹å˜é»˜è®¤è¡Œä¸ºï¼Œå®ƒæ¥å— <code>none</code>ï¼ˆé»˜è®¤ï¼‰å’Œ <code>all</code> ï¼ˆç›¸å½“äº <code>match_all</code> æŸ¥è¯¢ï¼‰ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;to be or not to be&quot;</span>,
        <span class="token string">&quot;operator&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;and&quot;</span>,
        <span class="token string">&quot;zero_terms_query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;all&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-3-match-bool-prefix-query"><a href="#_1-3-match-bool-prefix-query" class="header-anchor">#</a> 1.3. match_bool_prefix query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-bool-prefix-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match_bool_prefix query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åˆ†æå…¶è¾“å…¥å¹¶æ ¹æ®è¿™äº›è¯æ„é€ ä¸€ä¸ªå¸ƒå°”æŸ¥è¯¢ã€‚é™¤äº†æœ€åä¸€ä¸ªæœ¯è¯­ä¹‹å¤–çš„æ¯ä¸ªæœ¯è¯­éƒ½ç”¨äºæœ¯è¯­æŸ¥è¯¢ã€‚æœ€åä¸€ä¸ªè¯ç”¨äº <code>prefix query</code>ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_bool_prefix&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;quick brown f&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç­‰ä»·äº</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;quick&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,
        <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;brown&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,
        <span class="token punctuation">{</span> <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>match_bool_prefix query</code> å’Œ <code>match_phrase_prefix query</code> ä¹‹é—´çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯ï¼š<code>match_phrase_prefix query</code> å°†å…¶ term åŒ¹é…ä¸ºçŸ­è¯­ï¼Œä½† <code>match_bool_prefix query</code> å¯ä»¥åœ¨ä»»ä½•ä½ç½®åŒ¹é…å…¶ termã€‚</p> <p>ä¸Šé¢çš„ç¤ºä¾‹ <code>match_bool_prefix query</code> æŸ¥è¯¢å¯ä»¥åŒ¹é…åŒ…å« <code>quick brown fox</code> çš„å­—æ®µï¼Œä½†å®ƒä¹Ÿå¯ä»¥å¿«é€ŸåŒ¹é… <code>brown fox</code>ã€‚å®ƒè¿˜å¯ä»¥åŒ¹é…åŒ…å« <code>quick</code>ã€<code>brown</code> å’Œä»¥ <code>f</code> å¼€å¤´çš„å­—æ®µï¼Œå‡ºç°åœ¨ä»»ä½•ä½ç½®ã€‚</p> <h3 id="_1-4-match-phrase-query"><a href="#_1-4-match-phrase-query" class="header-anchor">#</a> 1.4. match_phrase query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å³çŸ­è¯­åŒ¹é…ï¼Œé¦–å…ˆä¼šæŠŠ query å†…å®¹åˆ†è¯ï¼Œåˆ†è¯å™¨å¯ä»¥è‡ªå®šä¹‰ï¼ŒåŒæ—¶æ–‡æ¡£è¿˜è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ‰ä¼šè¢«æœç´¢åˆ°ï¼š</p> <ol><li><strong>åˆ†è¯åæ‰€æœ‰è¯é¡¹éƒ½è¦å‡ºç°åœ¨è¯¥å­—æ®µä¸­ï¼ˆç›¸å½“äº and æ“ä½œï¼‰</strong>ã€‚</li> <li><strong>å­—æ®µä¸­çš„è¯é¡¹é¡ºåºè¦ä¸€è‡´</strong>ã€‚</li></ol> <p>ä¾‹å¦‚ï¼Œæœ‰ä»¥ä¸‹ 3 ä¸ªæ–‡æ¡£ï¼Œä½¿ç”¨ <strong><code>match_phrase</code></strong> æŸ¥è¯¢ &quot;How are you&quot;ï¼Œåªæœ‰å‰ä¸¤ä¸ªæ–‡æ¡£ä¼šè¢«åŒ¹é…ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>PUT demo/_create/1
<span class="token punctuation">{</span> <span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;How are you&quot;</span> <span class="token punctuation">}</span>

PUT demo/_create/2
<span class="token punctuation">{</span> <span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;How are you, Jack?&quot;</span><span class="token punctuation">}</span>

PUT demo/_create/3
<span class="token punctuation">{</span> <span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;are you&quot;</span><span class="token punctuation">}</span>

GET demo/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;How are you&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¯´æ˜ï¼š</p> <p>ä¸€ä¸ªè¢«è®¤å®šä¸ºå’ŒçŸ­è¯­ How are you åŒ¹é…çš„æ–‡æ¡£ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹è¿™äº›è¦æ±‚ï¼š</p> <ul><li>Howã€ are å’Œ you éœ€è¦å…¨éƒ¨å‡ºç°åœ¨åŸŸä¸­ã€‚</li> <li>are çš„ä½ç½®åº”è¯¥æ¯” How çš„ä½ç½®å¤§ 1 ã€‚</li> <li>you çš„ä½ç½®åº”è¯¥æ¯” How çš„ä½ç½®å¤§ 2 ã€‚</li></ul></blockquote> <h3 id="_1-5-match-phrase-prefix-query"><a href="#_1-5-match-phrase-prefix-query" class="header-anchor">#</a> 1.5. match_phrase_prefix query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase_prefix query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å’Œ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç±»ä¼¼ï¼Œåªä¸è¿‡ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase_prefix query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æœ€åä¸€ä¸ª term ä¼šè¢«ä½œä¸ºå‰ç¼€åŒ¹é…ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET demo/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase_prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;are yo&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-6-multi-match-query"><a href="#_1-6-multi-match-query" class="header-anchor">#</a> 1.6. multi_match query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>multi_match query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯ <strong><code>match query</code></strong> çš„å‡çº§ï¼Œ<strong>ç”¨äºæœç´¢å¤šä¸ªå­—æ®µ</strong>ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token number">34.98</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;taxful_total_price&quot;</span>,
        <span class="token string">&quot;taxless_total_price&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>multi_match query</code></strong> çš„æœç´¢å­—æ®µå¯ä»¥ä½¿ç”¨é€šé…ç¬¦æŒ‡å®šï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token number">34.98</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;taxful_*&quot;</span>,
        <span class="token string">&quot;taxless_total_price&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨<strong>æŒ‡æ•°ç¬¦æŒ‡å®šæœç´¢å­—æ®µçš„æƒé‡</strong>ã€‚</p> <p>ç¤ºä¾‹ï¼šæŒ‡å®š taxful_total_price å­—æ®µçš„æƒé‡æ˜¯ taxless_total_price å­—æ®µçš„ 3 å€ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token number">34.98</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;taxful_total_price^3&quot;</span>,
        <span class="token string">&quot;taxless_total_price&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-7-combined-fields-query"><a href="#_1-7-combined-fields-query" class="header-anchor">#</a> 1.7. combined_fields query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-combined-fields-query.html" target="_blank" rel="noopener noreferrer"><strong><code>combined_fields query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ”¯æŒæœç´¢å¤šä¸ªæ–‡æœ¬å­—æ®µï¼Œå°±å¥½åƒå®ƒä»¬çš„å†…å®¹å·²è¢«ç´¢å¼•åˆ°ä¸€ä¸ªç»„åˆå­—æ®µä¸­ä¸€æ ·ã€‚è¯¥æŸ¥è¯¢ä¼šç”Ÿæˆä»¥ term ä¸ºä¸­å¿ƒçš„è¾“å…¥å­—ç¬¦ä¸²è§†å›¾ï¼šé¦–å…ˆå®ƒå°†æŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºç‹¬ç«‹çš„ termï¼Œç„¶ååœ¨æ‰€æœ‰å­—æ®µä¸­æŸ¥æ‰¾æ¯ä¸ª termã€‚å½“åŒ¹é…ç»“æœå¯èƒ½è·¨è¶Šå¤šä¸ªæ–‡æœ¬å­—æ®µæ—¶ï¼Œæ­¤æŸ¥è¯¢ç‰¹åˆ«æœ‰ç”¨ï¼Œä¾‹å¦‚æ–‡ç« çš„æ ‡é¢˜ã€æ‘˜è¦å’Œæ­£æ–‡ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;combined_fields&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span>      <span class="token string">&quot;database systems&quot;</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span>     <span class="token punctuation">[</span> <span class="token string">&quot;title&quot;</span>, <span class="token string">&quot;abstract&quot;</span>, <span class="token string">&quot;body&quot;</span><span class="token punctuation">]</span>,
      <span class="token string">&quot;operator&quot;</span><span class="token builtin class-name">:</span>   <span class="token string">&quot;and&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="å­—æ®µå‰ç¼€æƒé‡"><a href="#å­—æ®µå‰ç¼€æƒé‡" class="header-anchor">#</a> å­—æ®µå‰ç¼€æƒé‡</h4> <p>å­—æ®µå‰ç¼€æƒé‡æ ¹æ®ç»„åˆå­—æ®µæ¨¡å‹è¿›è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ title å­—æ®µçš„æƒé‡ä¸º 2ï¼Œåˆ™åŒ¹é…åº¦æ‰“åˆ†æ—¶ä¼šå°† title ä¸­çš„æ¯ä¸ª term å½¢æˆçš„ç»„åˆå­—æ®µï¼ŒæŒ‰å‡ºç°ä¸¤æ¬¡è¿›è¡Œæ‰“åˆ†ã€‚</p> <h3 id="_1-8-common-terms-query"><a href="#_1-8-common-terms-query" class="header-anchor">#</a> 1.8. common_terms query</h3> <blockquote><p>7.3.0 åºŸå¼ƒ</p></blockquote> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-common-terms-query.html" target="_blank" rel="noopener noreferrer"><strong><code>common_terms query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯ä¸€ç§åœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„æƒ…å†µä¸‹æ›¿ä»£åœç”¨è¯æé«˜æœç´¢å‡†ç¡®ç‡å’Œå¬å›ç‡çš„æ–¹æ¡ˆã€‚</p> <p>æŸ¥è¯¢ä¸­çš„æ¯ä¸ªè¯é¡¹éƒ½æœ‰ä¸€å®šçš„ä»£ä»·ï¼Œä»¥æœç´¢â€œThe brown foxâ€ä¸ºä¾‹ï¼Œquery ä¼šè¢«è§£ææˆä¸‰ä¸ªè¯é¡¹â€œtheâ€â€œbrownâ€å’Œâ€œfoxâ€ï¼Œæ¯ä¸ªè¯é¡¹éƒ½ä¼šåˆ°ç´¢å¼•ä¸­æ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢ã€‚å¾ˆæ˜¾ç„¶åŒ…å«â€œtheâ€çš„æ–‡æ¡£éå¸¸å¤šï¼Œç›¸æ¯”å…¶ä»–è¯é¡¹ï¼Œâ€œtheâ€çš„é‡è¦æ€§ä¼šä½å¾ˆå¤šã€‚ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯æŠŠâ€œtheâ€å½“ä½œåœç”¨è¯å¤„ç†ï¼Œå»é™¤åœç”¨è¯ä¹‹åå¯ä»¥å‡å°‘ç´¢å¼•å¤§å°ï¼ŒåŒæ—¶åœ¨æœç´¢æ—¶å‡å°‘å¯¹åœç”¨è¯çš„æ”¶ç¼©ã€‚</p> <p>è™½ç„¶åœç”¨è¯å¯¹æ–‡æ¡£è¯„åˆ†å½±å“ä¸å¤§ï¼Œä½†æ˜¯å½“åœç”¨è¯ä»ç„¶æœ‰é‡è¦æ„ä¹‰çš„æ—¶å€™ï¼Œå»é™¤åœç”¨è¯å°±ä¸æ˜¯å®Œç¾çš„è§£å†³æ–¹æ¡ˆäº†ã€‚å¦‚æœå»é™¤åœç”¨è¯ï¼Œå°±æ— æ³•åŒºåˆ†â€œhappyâ€å’Œâ€œnot happyâ€, â€œTheâ€â€œTo be or not to beâ€å°±ä¸ä¼šåœ¨ç´¢å¼•ä¸­å­˜åœ¨ï¼Œæœç´¢çš„å‡†ç¡®ç‡å’Œå¬å›ç‡å°±ä¼šé™ä½ã€‚</p> <p>common_terms query æä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå®ƒæŠŠ query åˆ†è¯åçš„è¯é¡¹åˆ†æˆé‡è¦è¯é¡¹ï¼ˆä½é¢‘è¯é¡¹ï¼‰å’Œä¸é‡è¦çš„è¯é¡¹ï¼ˆé«˜é¢‘è¯ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„åœç”¨è¯ï¼‰ã€‚åœ¨æœç´¢çš„æ—¶å€™ï¼Œé¦–å…ˆæœç´¢å’Œé‡è¦è¯é¡¹åŒ¹é…çš„æ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£æ˜¯è¯é¡¹å‡ºç°è¾ƒå°‘å¹¶ä¸”è¯é¡¹å¯¹å…¶è¯„åˆ†å½±å“è¾ƒå¤§çš„æ–‡æ¡£ã€‚ç„¶åæ‰§è¡Œç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œæœç´¢å¯¹è¯„åˆ†å½±å“è¾ƒå°çš„é«˜é¢‘è¯é¡¹ï¼Œä½†æ˜¯ä¸è®¡ç®—æ‰€æœ‰æ–‡æ¡£çš„è¯„åˆ†ï¼Œè€Œæ˜¯åªè®¡ç®—ç¬¬ä¸€æ¬¡æŸ¥è¯¢å·²ç»åŒ¹é…çš„æ–‡æ¡£å¾—åˆ†ã€‚å¦‚æœä¸€ä¸ªæŸ¥è¯¢ä¸­åªåŒ…å«é«˜é¢‘è¯ï¼Œé‚£ä¹ˆä¼šé€šè¿‡ and è¿æ¥ç¬¦æ‰§è¡Œä¸€ä¸ªå•ç‹¬çš„æŸ¥è¯¢ï¼Œæ¢è¨€ä¹‹ï¼Œä¼šæœç´¢æ‰€æœ‰çš„è¯é¡¹ã€‚</p> <p>è¯é¡¹æ˜¯é«˜é¢‘è¯è¿˜æ˜¯ä½é¢‘è¯æ˜¯é€šè¿‡ cutoff frequency æ¥è®¾ç½®é˜€å€¼çš„ï¼Œå–å€¼å¯ä»¥æ˜¯ç»å¯¹é¢‘ç‡ï¼ˆé¢‘ç‡å¤§äº 1ï¼‰æˆ–è€…ç›¸å¯¹é¢‘ç‡ï¼ˆ0 ï½ 1ï¼‰ã€‚common_terms query æœ€æœ‰è¶£ä¹‹å¤„åœ¨äºå®ƒèƒ½è‡ªé€‚åº”ç‰¹å®šé¢†åŸŸçš„åœç”¨è¯ï¼Œä¾‹å¦‚ï¼Œåœ¨è§†é¢‘æ‰˜ç®¡ç½‘ç«™ä¸Šï¼Œè¯¸å¦‚â€œclipâ€æˆ–â€œvideoâ€ä¹‹ç±»çš„é«˜é¢‘è¯é¡¹å°†è‡ªåŠ¨è¡¨ç°ä¸ºåœç”¨è¯ï¼Œæ— é¡»ä¿ç•™æ‰‹åŠ¨åˆ—è¡¨ã€‚</p> <p>ä¾‹å¦‚ï¼Œæ–‡æ¡£é¢‘ç‡é«˜äº 0.1% çš„è¯é¡¹å°†ä¼šè¢«å½“ä½œé«˜é¢‘è¯é¡¹ï¼Œè¯é¢‘ä¹‹é—´å¯ä»¥ç”¨ low_freq_operatorã€high_freq_operator å‚æ•°è¿æ¥ã€‚è®¾ç½®ä½é¢‘è¯æ“ä½œç¬¦ä¸ºâ€œandâ€ä½¿æ‰€æœ‰çš„ä½é¢‘è¯éƒ½æ˜¯å¿…é¡»æœç´¢çš„ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET books/_search
<span class="token punctuation">{</span>
	<span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;common&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;body&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nelly the elephant as a cartoon&quot;</span>,
				<span class="token string">&quot;cutoff_frequency&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0.001</span>,
				<span class="token string">&quot;low_freq_operator&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;and&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šè¿°æ“ä½œç­‰ä»·äºï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET books/_search
<span class="token punctuation">{</span>
	<span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
			  <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nelly&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
			  <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elephant&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
			  <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cartoon&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
			<span class="token punctuation">]</span>,
			<span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
			  <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;the&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
			  <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;as&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
			  <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;body&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
			<span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-9-query-string-query"><a href="#_1-9-query-string-query" class="header-anchor">#</a> 1.9. query_string query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>query_string query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯ä¸ Lucene æŸ¥è¯¢è¯­å¥çš„è¯­æ³•ç»“åˆéå¸¸ç´§å¯†çš„ä¸€ç§æŸ¥è¯¢ï¼Œå…è®¸åœ¨ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨å¤šä¸ªç‰¹æ®Šæ¡ä»¶å…³é”®å­—ï¼ˆå¦‚ï¼šAND | OR | NOTï¼‰å¯¹å¤šä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œå»ºè®®ç†Ÿæ‚‰ Lucene æŸ¥è¯¢è¯­æ³•çš„ç”¨æˆ·å»ä½¿ç”¨ã€‚</p> <p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ query_string query æ¥åˆ›å»ºåŒ…å«é€šé…ç¬¦ã€è·¨å¤šä¸ªå­—æ®µçš„æœç´¢ç­‰å¤æ‚æœç´¢ã€‚è™½ç„¶é€šç”¨ï¼Œä½†æŸ¥è¯¢æ˜¯ä¸¥æ ¼çš„ï¼Œå¦‚æœæŸ¥è¯¢å­—ç¬¦ä¸²åŒ…å«ä»»ä½•æ— æ•ˆè¯­æ³•ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;query_string&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;(new york city) OR (big apple)&quot;</span>,
      <span class="token string">&quot;default_field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;content&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-10-simple-query-string-query"><a href="#_1-10-simple-query-string-query" class="header-anchor">#</a> 1.10. simple_query_string query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>simple_query_string query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯ä¸€ç§é€‚åˆç›´æ¥æš´éœ²ç»™ç”¨æˆ·ï¼Œå¹¶ä¸”å…·æœ‰éå¸¸å®Œå–„çš„æŸ¥è¯¢è¯­æ³•çš„æŸ¥è¯¢è¯­å¥ï¼Œæ¥å— Lucene æŸ¥è¯¢è¯­æ³•ï¼Œè§£æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p> <p>è™½ç„¶è¯­æ³•æ¯” <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>query_string query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ›´ä¸¥æ ¼ï¼Œä½† <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>simple_query_string query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸ä¼šè¿”å›æ— æ•ˆè¯­æ³•çš„é”™è¯¯ã€‚ç›¸åï¼Œå®ƒä¼šå¿½ç•¥æŸ¥è¯¢å­—ç¬¦ä¸²çš„ä»»ä½•æ— æ•ˆéƒ¨åˆ†ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;simple_query_string&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;<span class="token entity" title="\&quot;">\&quot;</span>fried eggs<span class="token entity" title="\&quot;">\&quot;</span> +(eggplant | potato) -frittata&quot;</span>,
        <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;title^5&quot;</span>, <span class="token string">&quot;body&quot;</span><span class="token punctuation">]</span>,
        <span class="token string">&quot;default_operator&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;and&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="simple-query-string-è¯­ä¹‰"><a href="#simple-query-string-è¯­ä¹‰" class="header-anchor">#</a> simple_query_string è¯­ä¹‰</h4> <ul><li><code>+</code>ï¼šç­‰ä»·äº AND æ“ä½œ</li> <li><code>|</code>ï¼šç­‰ä»·äº OR æ“ä½œ</li> <li><code>-</code>ï¼šç›¸å½“äº NOT æ“ä½œ</li> <li><code>&quot;</code>ï¼šåŒ…è£…ä¸€äº›æ ‡è®°ä»¥è¡¨ç¤ºç”¨äºæœç´¢çš„çŸ­è¯­</li> <li><code>*</code>ï¼šè¯å°¾è¡¨ç¤ºå‰ç¼€æŸ¥è¯¢</li> <li><code>(</code> and <code>)</code>ï¼šè¡¨ç¤ºä¼˜å…ˆçº§</li> <li><code>~N</code>ï¼šè¯å°¾è¡¨ç¤ºè¡¨ç¤ºç¼–è¾‘è·ç¦»ï¼ˆæ¨¡ç³Šæ€§ï¼‰</li> <li><code>~N</code>ï¼šåœ¨ä¸€ä¸ªçŸ­è¯­ä¹‹åè¡¨ç¤ºæº¢å‡ºé‡</li></ul> <p>æ³¨æ„ï¼šè¦ä½¿ç”¨ä¸Šé¢çš„å­—ç¬¦ï¼Œè¯·ä½¿ç”¨åæ–œæ  <code>/</code> å¯¹å…¶è¿›è¡Œè½¬ä¹‰ã€‚</p> <h3 id="_1-11-å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹"><a href="#_1-11-å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹" class="header-anchor">#</a> 1.11. å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#è®¾ç½® position_increment_gap</span>
DELETE <span class="token function">groups</span>
PUT <span class="token function">groups</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;names&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
        <span class="token string">&quot;position_increment_gap&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

GET groups/_mapping

POST groups/_doc
<span class="token punctuation">{</span>
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;John Water&quot;</span>, <span class="token string">&quot;Water Smith&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

POST groups/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Water Water&quot;</span>,
        <span class="token string">&quot;slop&quot;</span><span class="token builtin class-name">:</span> <span class="token number">100</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST groups/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Water Smith&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

DELETE <span class="token function">groups</span>
</code></pre></div><h2 id="_2-è¯é¡¹æŸ¥è¯¢"><a href="#_2-è¯é¡¹æŸ¥è¯¢" class="header-anchor">#</a> 2. è¯é¡¹æŸ¥è¯¢</h2> <p><strong><code>Term</code>ï¼ˆè¯é¡¹ï¼‰æ˜¯è¡¨è¾¾è¯­æ„çš„æœ€å°å•ä½</strong>ã€‚æœç´¢å’Œåˆ©ç”¨ç»Ÿè®¡è¯­è¨€æ¨¡å‹è¿›è¡Œè‡ªç„¶è¯­è¨€å¤„ç†éƒ½éœ€è¦å¤„ç† Termã€‚</p> <p>å…¨æ–‡æŸ¥è¯¢åœ¨æ‰§è¡ŒæŸ¥è¯¢ä¹‹å‰ä¼šåˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p> <p>ä¸å…¨æ–‡æŸ¥è¯¢ä¸åŒï¼Œè¯é¡¹æŸ¥è¯¢ä¸ä¼šåˆ†è¯ï¼Œè€Œæ˜¯å°†è¾“å…¥ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œåœ¨å€’æ’ç´¢å¼•ä¸­æŸ¥æ‰¾å‡†ç¡®çš„è¯é¡¹ã€‚å¹¶ä¸”ä½¿ç”¨ç›¸å…³åº¦è®¡ç®—å…¬å¼ä¸ºæ¯ä¸ªåŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£è¿›è¡Œç›¸å…³åº¦è®¡ç®—ã€‚ä¸€è¨€ä»¥æ¦‚ä¹‹ï¼š<strong>è¯é¡¹æŸ¥è¯¢æ˜¯å¯¹è¯é¡¹è¿›è¡Œç²¾ç¡®åŒ¹é…</strong>ã€‚è¯é¡¹æŸ¥è¯¢é€šå¸¸ç”¨äºç»“æ„åŒ–æ•°æ®ï¼Œå¦‚æ•°å­—ã€æ—¥æœŸå’Œæšä¸¾ç±»å‹ã€‚</p> <p>è¯é¡¹æŸ¥è¯¢æœ‰ä»¥ä¸‹ç±»å‹ï¼š</p> <ul><li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer"><code>exists</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="noopener noreferrer"><code>fuzzy</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="noopener noreferrer"><code>ids</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html" target="_blank" rel="noopener noreferrer"><code>prefix</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="noopener noreferrer"><code>range</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><code>regexp</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><code>term</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="noopener noreferrer"><code>terms</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="noopener noreferrer"><code>type</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li> <li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><code>wildcard</code> query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li></ul> <h3 id="_2-1-exists-query"><a href="#_2-1-exists-query" class="header-anchor">#</a> 2.1. exists query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer"><strong><code>exists query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¼šè¿”å›å­—æ®µä¸­è‡³å°‘æœ‰ä¸€ä¸ªéç©ºå€¼çš„æ–‡æ¡£ã€‚</p> <p>ç”±äºå¤šç§åŸå› ï¼Œæ–‡æ¡£å­—æ®µå¯èƒ½ä¸å­˜åœ¨ç´¢å¼•å€¼ï¼š</p> <ul><li>JSON ä¸­çš„å­—æ®µä¸º <code>null</code> æˆ– <code>[]</code></li> <li>è¯¥å­—æ®µåœ¨ mapping ä¸­é…ç½®äº† <code>&quot;index&quot; : false</code></li> <li>å­—æ®µå€¼çš„é•¿åº¦è¶…è¿‡äº† mapping ä¸­çš„ <code>ignore_above</code> è®¾ç½®</li> <li>å­—æ®µå€¼æ ¼å¼é”™è¯¯ï¼Œå¹¶ä¸”åœ¨ mapping ä¸­å®šä¹‰äº† <code>ignore_malformed</code></li></ul> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;exists&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;email&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä»¥ä¸‹æ–‡æ¡£ä¼šåŒ¹é…ä¸Šé¢çš„æŸ¥è¯¢ï¼š</p> <ul><li><code>{ &quot;user&quot; : &quot;jane&quot; }</code> æœ‰ user å­—æ®µï¼Œä¸”ä¸ä¸ºç©ºã€‚</li> <li><code>{ &quot;user&quot; : &quot;&quot; }</code> æœ‰ user å­—æ®µï¼Œå€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li> <li><code>{ &quot;user&quot; : &quot;-&quot; }</code> æœ‰ user å­—æ®µï¼Œå€¼ä¸ä¸ºç©ºã€‚</li> <li><code>{ &quot;user&quot; : [ &quot;jane&quot; ] }</code> æœ‰ user å­—æ®µï¼Œå€¼ä¸ä¸ºç©ºã€‚</li> <li><code>{ &quot;user&quot; : [ &quot;jane&quot;, null ] }</code> æœ‰ user å­—æ®µï¼Œè‡³å°‘ä¸€ä¸ªå€¼ä¸ä¸ºç©ºå³å¯ã€‚</li></ul> <p>ä¸‹é¢çš„æ–‡æ¡£éƒ½ä¸ä¼šè¢«åŒ¹é…ï¼š</p> <ul><li><code>{ &quot;user&quot; : null }</code> è™½ç„¶æœ‰ user å­—æ®µï¼Œä½†æ˜¯å€¼ä¸ºç©ºã€‚</li> <li><code>{ &quot;user&quot; : [] }</code> è™½ç„¶æœ‰ user å­—æ®µï¼Œä½†æ˜¯å€¼ä¸ºç©ºã€‚</li> <li><code>{ &quot;user&quot; : [null] }</code> è™½ç„¶æœ‰ user å­—æ®µï¼Œä½†æ˜¯å€¼ä¸ºç©ºã€‚</li> <li><code>{ &quot;foo&quot; : &quot;bar&quot; }</code> æ²¡æœ‰ user å­—æ®µã€‚</li></ul> <h3 id="_2-2-fuzzy-query"><a href="#_2-2-fuzzy-query" class="header-anchor">#</a> 2.2. fuzzy query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="noopener noreferrer"><strong><code>fuzzy query</code></strong>ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>è¿”å›åŒ…å«ä¸æœç´¢è¯ç›¸ä¼¼çš„è¯çš„æ–‡æ¡£ã€‚ES ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Levenshtein_distance" target="_blank" rel="noopener noreferrer">Levenshtein edit distanceï¼ˆLevenshtein ç¼–è¾‘è·ç¦»ï¼‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æµ‹é‡ç›¸ä¼¼åº¦æˆ–æ¨¡ç³Šåº¦ã€‚</p> <p>ç¼–è¾‘è·ç¦»æ˜¯å°†ä¸€ä¸ªæœ¯è¯­è½¬æ¢ä¸ºå¦ä¸€ä¸ªæœ¯è¯­æ‰€éœ€çš„å•ä¸ªå­—ç¬¦æ›´æ”¹çš„æ•°é‡ã€‚è¿™äº›å˜åŒ–å¯èƒ½åŒ…æ‹¬ï¼š</p> <ul><li>æ”¹å˜ä¸€ä¸ªå­—ç¬¦ï¼šï¼ˆ<strong>b</strong>ox -&gt; <strong>f</strong>oxï¼‰</li> <li>åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼šï¼ˆ<strong>b</strong>lack -&gt; lackï¼‰</li> <li>æ’å…¥ä¸€ä¸ªå­—ç¬¦ï¼šï¼ˆsic -&gt; sic<strong>k</strong>ï¼‰</li> <li>åè½¬ä¸¤ä¸ªç›¸é‚»å­—ç¬¦ï¼šï¼ˆ<strong>ac</strong>t â†’ <strong>ca</strong>tï¼‰</li></ul> <p>ä¸ºäº†æ‰¾åˆ°ç›¸ä¼¼çš„è¯æ¡ï¼Œfuzzy query ä¼šåœ¨æŒ‡å®šçš„ç¼–è¾‘è·ç¦»å†…åˆ›å»ºæœç´¢è¯æ¡çš„æ‰€æœ‰å¯èƒ½å˜ä½“æˆ–æ‰©å±•é›†ã€‚ç„¶åè¿”å›å®Œå…¨åŒ¹é…ä»»æ„æ‰©å±•çš„æ–‡æ¡£ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET books/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;fuzzy&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;user.id&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ki&quot;</span>,
        <span class="token string">&quot;fuzziness&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;AUTO&quot;</span>,
        <span class="token string">&quot;max_expansions&quot;</span><span class="token builtin class-name">:</span> <span class="token number">50</span>,
        <span class="token string">&quot;prefix_length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">&quot;transpositions&quot;</span><span class="token builtin class-name">:</span> true,
        <span class="token string">&quot;rewrite&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;constant_score&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„ï¼šå¦‚æœé…ç½®äº† <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ï¼Œåˆ™ fuzzy query ä¸èƒ½æ‰§è¡Œã€‚</p> <h3 id="_2-3-ids-query"><a href="#_2-3-ids-query" class="header-anchor">#</a> 2.3. ids query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="noopener noreferrer"><strong><code>ids query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ ¹æ® ID è¿”å›æ–‡æ¡£ã€‚ æ­¤æŸ¥è¯¢ä½¿ç”¨å­˜å‚¨åœ¨ <code>_id</code> å­—æ®µä¸­çš„æ–‡æ¡£ IDã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ids&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;values&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span>, <span class="token string">&quot;4&quot;</span>, <span class="token string">&quot;100&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-4-prefix-query"><a href="#_2-4-prefix-query" class="header-anchor">#</a> 2.4. prefix query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html#prefix-query-ex-request" target="_blank" rel="noopener noreferrer"><strong><code>prefix query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç”¨äºæŸ¥è¯¢æŸä¸ªå­—æ®µä¸­åŒ…å«æŒ‡å®šå‰ç¼€çš„æ–‡æ¡£ã€‚</p> <p>æ¯”å¦‚æŸ¥è¯¢ <code>user.id</code> ä¸­å«æœ‰ä»¥ <code>ki</code> ä¸ºå‰ç¼€çš„å…³é”®è¯çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆå«æœ‰ <code>kind</code>ã€<code>kid</code> ç­‰æ‰€æœ‰ä»¥ <code>ki</code> å¼€å¤´å…³é”®è¯çš„æ–‡æ¡£éƒ½ä¼šè¢«åŒ¹é…ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;user.id&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ki&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-5-range-query"><a href="#_2-5-range-query" class="header-anchor">#</a> 2.5. range query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="noopener noreferrer"><strong><code>range query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å³èŒƒå›´æŸ¥è¯¢ï¼Œç”¨äºåŒ¹é…åœ¨æŸä¸€èŒƒå›´å†…çš„æ•°å€¼å‹ã€æ—¥æœŸç±»å‹æˆ–è€…å­—ç¬¦ä¸²å‹å­—æ®µçš„æ–‡æ¡£ã€‚æ¯”å¦‚æœç´¢å“ªäº›ä¹¦ç±çš„ä»·æ ¼åœ¨ 50 åˆ° 100 ä¹‹é—´ã€å“ªäº›ä¹¦ç±çš„å‡ºç‰ˆæ—¶é—´åœ¨ 2015 å¹´åˆ° 2019 å¹´ä¹‹é—´ã€‚<strong>ä½¿ç”¨ range æŸ¥è¯¢åªèƒ½æŸ¥è¯¢ä¸€ä¸ªå­—æ®µï¼Œä¸èƒ½ä½œç”¨åœ¨å¤šä¸ªå­—æ®µä¸Š</strong>ã€‚</p> <p>range æŸ¥è¯¢æ”¯æŒçš„å‚æ•°æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p> <ul><li><p><strong><code>gt</code></strong>ï¼šå¤§äº</p></li> <li><p><strong><code>gte</code></strong>ï¼šå¤§äºç­‰äº</p></li> <li><p><strong><code>lt</code></strong>ï¼šå°äº</p></li> <li><p><strong><code>lte</code></strong>ï¼šå°äºç­‰äº</p></li> <li><p><strong><code>format</code></strong>ï¼šå¦‚æœå­—æ®µæ˜¯ Date ç±»å‹ï¼Œå¯ä»¥è®¾ç½®æ—¥æœŸæ ¼å¼åŒ–</p></li> <li><p><strong><code>time_zone</code></strong>ï¼šæ—¶åŒº</p></li> <li><p><strong><code>relation</code></strong>ï¼šæŒ‡ç¤ºèŒƒå›´æŸ¥è¯¢å¦‚ä½•åŒ¹é…èŒƒå›´å­—æ®µçš„å€¼ã€‚</p> <ul><li><strong><code>INTERSECTS</code> (Default)</strong>ï¼šåŒ¹é…ä¸æŸ¥è¯¢å­—æ®µå€¼èŒƒå›´ç›¸äº¤çš„æ–‡æ¡£ã€‚</li> <li><strong><code>CONTAINS</code></strong>ï¼šåŒ¹é…å®Œå…¨åŒ…å«æŸ¥è¯¢å­—æ®µå€¼çš„æ–‡æ¡£ã€‚</li> <li><strong><code>WITHIN</code></strong>ï¼šåŒ¹é…å…·æœ‰å®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†…çš„èŒƒå›´å­—æ®µå€¼çš„æ–‡æ¡£ã€‚</li></ul></li></ul> <p>ç¤ºä¾‹ï¼šæ•°å€¼èŒƒå›´æŸ¥è¯¢</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;taxful_total_price&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
        <span class="token string">&quot;lte&quot;</span><span class="token builtin class-name">:</span> <span class="token number">50</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç¤ºä¾‹ï¼šæ—¥æœŸèŒƒå›´æŸ¥è¯¢</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET kibana_sample_data_ecommerce/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;order_date&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;time_zone&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;+00:00&quot;</span>,
        <span class="token string">&quot;gte&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2018-01-01T00:00:00&quot;</span>,
        <span class="token string">&quot;lte&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;now&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-6-regexp-query"><a href="#_2-6-regexp-query" class="header-anchor">#</a> 2.6. regexp query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><strong><code>regexp query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> è¿”å›ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„ term æ‰€å±çš„æ–‡æ¡£ã€‚</p> <p><a href="https://zh.wikipedia.org/zh-hans/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F" target="_blank" rel="noopener noreferrer">æ­£åˆ™è¡¨è¾¾å¼<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ˜¯ä¸€ç§ä½¿ç”¨å ä½ç¬¦å­—ç¬¦åŒ¹é…æ•°æ®æ¨¡å¼çš„æ–¹æ³•ï¼Œç§°ä¸ºè¿ç®—ç¬¦ã€‚</p> <p>ç¤ºä¾‹ï¼šä»¥ä¸‹æœç´¢è¿”å› <code>user.id</code> å­—æ®µåŒ…å«ä»»ä½•ä»¥ <code>k</code> å¼€å¤´å¹¶ä»¥ <code>y</code> ç»“å°¾çš„æ–‡æ¡£ã€‚ <code>.*</code> è¿ç®—ç¬¦åŒ¹é…ä»»ä½•é•¿åº¦çš„ä»»ä½•å­—ç¬¦ï¼ŒåŒ…æ‹¬æ— å­—ç¬¦ã€‚åŒ¹é…é¡¹å¯ä»¥åŒ…æ‹¬ <code>ky</code>ã€<code>kay</code> å’Œ <code>kimchy</code>ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;regexp&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;user.id&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;k.*y&quot;</span>,
        <span class="token string">&quot;flags&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ALL&quot;</span>,
        <span class="token string">&quot;case_insensitive&quot;</span><span class="token builtin class-name">:</span> true,
        <span class="token string">&quot;max_determinized_states&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10000</span>,
        <span class="token string">&quot;rewrite&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;constant_score&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ³¨æ„ï¼šå¦‚æœé…ç½®äº†<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ï¼Œåˆ™ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><strong><code>regexp query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¼šè¢«ç¦ç”¨ã€‚</p></blockquote> <h3 id="_2-7-term-query"><a href="#_2-7-term-query" class="header-anchor">#</a> 2.7. term query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><strong><code>term query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç”¨æ¥æŸ¥æ‰¾æŒ‡å®šå­—æ®µä¸­åŒ…å«ç»™å®šå•è¯çš„æ–‡æ¡£ï¼Œterm æŸ¥è¯¢ä¸è¢«è§£æï¼Œåªæœ‰æŸ¥è¯¢è¯å’Œæ–‡æ¡£ä¸­çš„è¯ç²¾ç¡®åŒ¹é…æ‰ä¼šè¢«æœç´¢åˆ°ï¼Œåº”ç”¨åœºæ™¯ä¸ºæŸ¥è¯¢äººåã€åœ°åç­‰éœ€è¦ç²¾å‡†åŒ¹é…çš„éœ€æ±‚ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 1. åˆ›å»ºä¸€ä¸ªç´¢å¼•</span>
DELETE my-index-000001
PUT my-index-000001
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;full_text&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 2. ä½¿ç”¨ &quot;Quick Brown Foxes!&quot; å…³é”®å­—æŸ¥ &quot;full_text&quot; å­—æ®µ</span>
PUT my-index-000001/_doc/1
<span class="token punctuation">{</span>
  <span class="token string">&quot;full_text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Quick Brown Foxes!&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 3. ä½¿ç”¨ term æŸ¥è¯¢</span>
GET my-index-000001/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;full_text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Quick Brown Foxes!&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># å› ä¸º full_text å­—æ®µä¸å†åŒ…å«ç¡®åˆ‡çš„ Term â€”â€” &quot;Quick Brown Foxes!&quot;ï¼Œæ‰€ä»¥ term query æœç´¢ä¸åˆ°ä»»ä½•ç»“æœ</span>

<span class="token comment"># 4. ä½¿ç”¨ match æŸ¥è¯¢</span>
GET my-index-000001/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;full_text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Quick Brown Foxes!&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

DELETE my-index-000001
</code></pre></div><blockquote><p>âš ï¸ æ³¨æ„ï¼šåº”é¿å… term æŸ¥è¯¢å¯¹ text å­—æ®µä½¿ç”¨æŸ¥è¯¢ã€‚</p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearch é’ˆå¯¹ text å­—æ®µçš„å€¼è¿›è¡Œè§£æåˆ†è¯ï¼Œè¿™ä¼šä½¿æŸ¥æ‰¾ text å­—æ®µå€¼çš„ç²¾ç¡®åŒ¹é…å˜å¾—å›°éš¾ã€‚</p> <p>è¦æœç´¢ text å­—æ®µå€¼ï¼Œéœ€æ”¹ç”¨ match æŸ¥è¯¢ã€‚</p></blockquote> <h3 id="_2-8-terms-query"><a href="#_2-8-terms-query" class="header-anchor">#</a> 2.8. terms query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="noopener noreferrer"><strong><code>terms query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><strong><code>term query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç›¸åŒï¼Œä½†å¯ä»¥æœç´¢å¤šä¸ªå€¼ã€‚</p> <p>terms query æŸ¥è¯¢å‚æ•°ï¼š</p> <ul><li><strong><code>index</code></strong>ï¼šç´¢å¼•å</li> <li><strong><code>id</code></strong>ï¼šæ–‡æ¡£ ID</li> <li><strong><code>path</code></strong>ï¼šè¦ä»ä¸­è·å–å­—æ®µå€¼çš„å­—æ®µçš„åç§°ï¼Œå³æœç´¢å…³é”®å­—</li> <li><strong><code>routing</code></strong>ï¼ˆé€‰å¡«ï¼‰ï¼šè¦ä»ä¸­è·å– term å€¼çš„æ–‡æ¡£çš„è‡ªå®šä¹‰è·¯ç”±å€¼ã€‚å¦‚æœåœ¨ç´¢å¼•æ–‡æ¡£æ—¶æä¾›äº†è‡ªå®šä¹‰è·¯ç”±å€¼ï¼Œåˆ™æ­¤å‚æ•°æ˜¯å¿…éœ€çš„ã€‚</li></ul> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 1. åˆ›å»ºä¸€ä¸ªç´¢å¼•</span>
DELETE my-index-000001
PUT my-index-000001
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;color&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 2. å†™å…¥ä¸€ä¸ªæ–‡æ¡£</span>
PUT my-index-000001/_doc/1
<span class="token punctuation">{</span>
  <span class="token string">&quot;color&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;blue&quot;</span>,
    <span class="token string">&quot;green&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment"># 3. å†™å…¥å¦ä¸€ä¸ªæ–‡æ¡£</span>
PUT my-index-000001/_doc/2
<span class="token punctuation">{</span>
  <span class="token string">&quot;color&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;blue&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 3. ä½¿ç”¨ terms query</span>
GET my-index-000001/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;color&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my-index-000001&quot;</span>,
        <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2&quot;</span>,
        <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;color&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

DELETE my-index-000001
</code></pre></div><h3 id="_2-9-type-query"><a href="#_2-9-type-query" class="header-anchor">#</a> 2.9. type query</h3> <blockquote><p>7.0.0 ååºŸå¼ƒ</p></blockquote> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="noopener noreferrer"><strong><code>type query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç”¨äºæŸ¥è¯¢å…·æœ‰æŒ‡å®šç±»å‹çš„æ–‡æ¡£ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;_doc&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-10-wildcard-query"><a href="#_2-10-wildcard-query" class="header-anchor">#</a> 2.10. wildcard query</h3> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><strong><code>wildcard query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å³é€šé…ç¬¦æŸ¥è¯¢ï¼Œè¿”å›ä¸é€šé…ç¬¦æ¨¡å¼åŒ¹é…çš„æ–‡æ¡£ã€‚</p> <p><code>?</code> ç”¨æ¥åŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œ<code>*</code> ç”¨æ¥åŒ¹é…é›¶ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦ã€‚</p> <p>ç¤ºä¾‹ï¼šä»¥ä¸‹æœç´¢è¿”å› <code>user.id</code> å­—æ®µåŒ…å«ä»¥ <code>ki</code> å¼€å¤´å¹¶ä»¥ <code>y</code> ç»“å°¾çš„æœ¯è¯­çš„æ–‡æ¡£ã€‚è¿™äº›åŒ¹é…é¡¹å¯ä»¥åŒ…æ‹¬ <code>kiy</code>ã€<code>kity</code> æˆ– <code>kimchy</code>ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;wildcard&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;user.id&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ki*y&quot;</span>,
        <span class="token string">&quot;boost&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1.0</span>,
        <span class="token string">&quot;rewrite&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;constant_score&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ³¨æ„ï¼šå¦‚æœé…ç½®äº†<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ï¼Œåˆ™<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><strong><code>wildcard query</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¼šè¢«ç¦ç”¨ã€‚</p></blockquote> <h3 id="_2-11-è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹"><a href="#_2-11-è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹" class="header-anchor">#</a> 2.11. è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>DELETE products
PUT products
<span class="token punctuation">{</span>
  <span class="token string">&quot;settings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;number_of_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /products/_bulk
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;productID&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;XHDK-A-1293-#fJ3&quot;</span>,<span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;iPhone&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;productID&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;KDKE-B-9947-#kL5&quot;</span>,<span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;iPad&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;productID&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;JODL-X-1937-#pV7&quot;</span>,<span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;MBP&quot;</span> <span class="token punctuation">}</span>

GET /products

POST /products/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;desc&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        //<span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;iPhone&quot;</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;iphone&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /products/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;desc.keyword&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        //<span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;iPhone&quot;</span>
        //<span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;iphone&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /products/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;productID&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;XHDK-A-1293-#fJ3&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /products/_search
<span class="token punctuation">{</span>
  //<span class="token string">&quot;explain&quot;</span><span class="token builtin class-name">:</span> true,
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;productID.keyword&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;XHDK-A-1293-#fJ3&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /products/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;explain&quot;</span><span class="token builtin class-name">:</span> true,
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;constant_score&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;productID.keyword&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;XHDK-A-1293-#fJ3&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-å¤åˆæŸ¥è¯¢"><a href="#_3-å¤åˆæŸ¥è¯¢" class="header-anchor">#</a> 3. å¤åˆæŸ¥è¯¢</h2> <p>å¤åˆæŸ¥è¯¢å°±æ˜¯æŠŠä¸€äº›ç®€å•æŸ¥è¯¢ç»„åˆåœ¨ä¸€èµ·å®ç°æ›´å¤æ‚çš„æŸ¥è¯¢éœ€æ±‚ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¤åˆæŸ¥è¯¢è¿˜å¯ä»¥æ§åˆ¶å¦å¤–ä¸€ä¸ªæŸ¥è¯¢çš„è¡Œä¸ºã€‚</p> <h3 id="_3-1-bool-query"><a href="#_3-1-bool-query" class="header-anchor">#</a> 3.1. bool query</h3> <p>bool æŸ¥è¯¢å¯ä»¥æŠŠä»»æ„å¤šä¸ªç®€å•æŸ¥è¯¢ç»„åˆåœ¨ä¸€èµ·ï¼Œä½¿ç”¨ mustã€shouldã€must_notã€filter é€‰é¡¹æ¥è¡¨ç¤ºç®€å•æŸ¥è¯¢ä¹‹é—´çš„é€»è¾‘ï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¯ä»¥å‡ºç° 0 æ¬¡åˆ°å¤šæ¬¡ï¼Œå®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š</p> <ul><li>must æ–‡æ¡£å¿…é¡»åŒ¹é… must é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äºé€»è¾‘è¿ç®—çš„ ANDï¼Œä¸”å‚ä¸æ–‡æ¡£ç›¸å…³åº¦çš„è¯„åˆ†ã€‚</li> <li>should æ–‡æ¡£å¯ä»¥åŒ¹é… should é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶ä¹Ÿå¯ä»¥ä¸åŒ¹é…ï¼Œç›¸å½“äºé€»è¾‘è¿ç®—çš„ ORï¼Œä¸”å‚ä¸æ–‡æ¡£ç›¸å…³åº¦çš„è¯„åˆ†ã€‚</li> <li>must_not ä¸ must ç›¸åï¼ŒåŒ¹é…è¯¥é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£ä¸ä¼šè¢«è¿”å›ï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>must_not è¯­å¥ä¸ä¼šå½±å“è¯„åˆ†ï¼Œå®ƒçš„ä½œç”¨åªæ˜¯å°†ä¸ç›¸å…³çš„æ–‡æ¡£æ’é™¤</strong>ã€‚</li> <li>filter å’Œ must ä¸€æ ·ï¼ŒåŒ¹é… filter é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè¢«è¿”å›ï¼Œ<strong>ä½†æ˜¯ filter ä¸è¯„åˆ†ï¼Œåªèµ·åˆ°è¿‡æ»¤åŠŸèƒ½ï¼Œä¸ must_not ç›¸å</strong>ã€‚</li></ul> <p>å‡è®¾è¦æŸ¥è¯¢ title ä¸­åŒ…å«å…³é”®è¯ javaï¼Œå¹¶ä¸” price ä¸èƒ½é«˜äº 70ï¼Œdescription å¯ä»¥åŒ…å«ä¹Ÿå¯ä»¥ä¸åŒ…å«è™šæ‹Ÿæœºçš„ä¹¦ç±ï¼Œæ„é€  bool æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;filter&quot;: {
        &quot;term&quot;: {
          &quot;status&quot;: 1
        }
      },
      &quot;must_not&quot;: {
        &quot;range&quot;: {
          &quot;price&quot;: {
            &quot;gte&quot;: 70
          }
        }
      },
      &quot;must&quot;: {
        &quot;match&quot;: {
          &quot;title&quot;: &quot;java&quot;
        }
      },
      &quot;should&quot;: [
        {
          &quot;match&quot;: {
            &quot;description&quot;: &quot;è™šæ‹Ÿæœº&quot;
          }
        }
      ],
      &quot;minimum_should_match&quot;: 1
    }
  }
}
</code></pre></div><p>æœ‰å…³å¸ƒå°”æŸ¥è¯¢æ›´è¯¦ç»†çš„ä¿¡æ¯å‚è€ƒ <a href="https://www.knowledgedict.com/tutorial/elasticsearch-query-bool.html" target="_blank" rel="noopener noreferrer">bool queryï¼ˆç»„åˆæŸ¥è¯¢ï¼‰è¯¦è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <h3 id="_3-2-boosting-query"><a href="#_3-2-boosting-query" class="header-anchor">#</a> 3.2. boosting query</h3> <p>boosting æŸ¥è¯¢ç”¨äºéœ€è¦å¯¹ä¸¤ä¸ªæŸ¥è¯¢çš„è¯„åˆ†è¿›è¡Œè°ƒæ•´çš„åœºæ™¯ï¼Œboosting æŸ¥è¯¢ä¼šæŠŠä¸¤ä¸ªæŸ¥è¯¢å°è£…åœ¨ä¸€èµ·å¹¶é™ä½å…¶ä¸­ä¸€ä¸ªæŸ¥è¯¢çš„è¯„åˆ†ã€‚</p> <p>boosting æŸ¥è¯¢åŒ…æ‹¬ positiveã€negative å’Œ negative_boost ä¸‰ä¸ªéƒ¨åˆ†ï¼Œpositive ä¸­çš„æŸ¥è¯¢è¯„åˆ†ä¿æŒä¸å˜ï¼Œnegative ä¸­çš„æŸ¥è¯¢ä¼šé™ä½æ–‡æ¡£è¯„åˆ†ï¼Œnegative_boost æŒ‡æ˜ negative ä¸­é™ä½çš„æƒå€¼ã€‚å¦‚æœæˆ‘ä»¬æƒ³å¯¹ 2015 å¹´ä¹‹å‰å‡ºç‰ˆçš„ä¹¦é™ä½è¯„åˆ†ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ª boosting æŸ¥è¯¢ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
	&quot;query&quot;: {
		&quot;boosting&quot;: {
			&quot;positive&quot;: {
				&quot;match&quot;: {
					&quot;title&quot;: &quot;python&quot;
				}
			},
			&quot;negative&quot;: {
				&quot;range&quot;: {
					&quot;publish_time&quot;: {
						&quot;lte&quot;: &quot;2015-01-01&quot;
					}
				}
			},
			&quot;negative_boost&quot;: 0.2
		}
	}
}
</code></pre></div><p>boosting æŸ¥è¯¢ä¸­æŒ‡å®šäº†æŠ‘åˆ¶å› å­ä¸º 0.2ï¼Œpublish_time çš„å€¼åœ¨ 2015-01-01 ä¹‹åçš„æ–‡æ¡£å¾—åˆ†ä¸å˜ï¼Œpublish_time çš„å€¼åœ¨ 2015-01-01 ä¹‹å‰çš„æ–‡æ¡£å¾—åˆ†ä¸ºåŸå¾—åˆ†çš„ 0.2 å€ã€‚</p> <h3 id="_3-3-constant-score-query"><a href="#_3-3-constant-score-query" class="header-anchor">#</a> 3.3. constant_score query</h3> <p>constant<em>score query åŒ…è£…ä¸€ä¸ª filter queryï¼Œå¹¶è¿”å›åŒ¹é…è¿‡æ»¤å™¨æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£ï¼Œä¸”å®ƒä»¬çš„ç›¸å…³æ€§è¯„åˆ†éƒ½ç­‰äº _boost</em> å‚æ•°å€¼ï¼ˆå¯ä»¥ç†è§£ä¸ºåŸæœ‰çš„åŸºäº tf-idf æˆ– bm25 çš„ç›¸å…³åˆ†å›ºå®šä¸º 1.0ï¼Œæ‰€ä»¥æœ€ç»ˆè¯„åˆ†ä¸º <em>1.0 * boost</em>ï¼Œå³ç­‰äº <em>boost</em> å‚æ•°å€¼ï¼‰ã€‚ä¸‹é¢çš„æŸ¥è¯¢è¯­å¥ä¼šè¿”å› title å­—æ®µä¸­å«æœ‰å…³é”®è¯ <em>elasticsearch</em> çš„æ–‡æ¡£ï¼Œæ‰€æœ‰æ–‡æ¡£çš„è¯„åˆ†éƒ½æ˜¯ 1.8ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
  &quot;query&quot;: {
    &quot;constant_score&quot;: {
      &quot;filter&quot;: {
        &quot;term&quot;: {
          &quot;title&quot;: &quot;elasticsearch&quot;
        }
      },
      &quot;boost&quot;: 1.8
    }
  }
}
</code></pre></div><h3 id="_3-4-dis-max-query"><a href="#_3-4-dis-max-query" class="header-anchor">#</a> 3.4. dis_max query</h3> <p>dis_max query ä¸ bool query æœ‰ä¸€å®šè”ç³»ä¹Ÿæœ‰ä¸€å®šåŒºåˆ«ï¼Œdis_max query æ”¯æŒå¤šå¹¶å‘æŸ¥è¯¢ï¼Œå¯è¿”å›ä¸ä»»æ„æŸ¥è¯¢æ¡ä»¶å­å¥åŒ¹é…çš„ä»»ä½•æ–‡æ¡£ç±»å‹ã€‚ä¸ bool æŸ¥è¯¢å¯ä»¥å°†æ‰€æœ‰åŒ¹é…æŸ¥è¯¢çš„åˆ†æ•°ç›¸ç»“åˆä½¿ç”¨çš„æ–¹å¼ä¸åŒï¼Œdis_max æŸ¥è¯¢åªä½¿ç”¨æœ€ä½³åŒ¹é…æŸ¥è¯¢æ¡ä»¶çš„åˆ†æ•°ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
	&quot;query&quot;: {
		&quot;dis_max&quot;: {
			&quot;tie_breaker&quot;: 0.7,
			&quot;boost&quot;: 1.2,
			&quot;queries&quot;: [{
					&quot;term&quot;: {
						&quot;age&quot;: 34
					}
				},
				{
					&quot;term&quot;: {
						&quot;age&quot;: 35
					}
				}
			]
		}
	}
}
</code></pre></div><h3 id="_3-5-function-score-query"><a href="#_3-5-function-score-query" class="header-anchor">#</a> 3.5. function_score query</h3> <p>function_score query å¯ä»¥ä¿®æ”¹æŸ¥è¯¢çš„æ–‡æ¡£å¾—åˆ†ï¼Œè¿™ä¸ªæŸ¥è¯¢åœ¨æœ‰äº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚é€šè¿‡è¯„åˆ†å‡½æ•°è®¡ç®—æ–‡æ¡£å¾—åˆ†ä»£ä»·è¾ƒé«˜ï¼Œå¯ä»¥æ”¹ç”¨è¿‡æ»¤å™¨åŠ è‡ªå®šä¹‰è¯„åˆ†å‡½æ•°çš„æ–¹å¼æ¥å–ä»£ä¼ ç»Ÿçš„è¯„åˆ†æ–¹å¼ã€‚</p> <p>ä½¿ç”¨ function_score queryï¼Œç”¨æˆ·éœ€è¦å®šä¹‰ä¸€ä¸ªæŸ¥è¯¢å’Œä¸€è‡³å¤šä¸ªè¯„åˆ†å‡½æ•°ï¼Œè¯„åˆ†å‡½æ•°ä¼šå¯¹æŸ¥è¯¢åˆ°çš„æ¯ä¸ªæ–‡æ¡£åˆ†åˆ«è®¡ç®—å¾—åˆ†ã€‚</p> <p>ä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šè¿”å› books ç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£ï¼Œæ–‡æ¡£çš„æœ€å¤§å¾—åˆ†ä¸º 5ï¼Œæ¯ä¸ªæ–‡æ¡£çš„å¾—åˆ†éšæœºç”Ÿæˆï¼Œæƒé‡çš„è®¡ç®—æ¨¡å¼ä¸ºç›¸ä¹˜æ¨¡å¼ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
  &quot;query&quot;: {
    &quot;function_score&quot;: {
      &quot;query&quot;: {
        &quot;match all&quot;: {}
      },
      &quot;boost&quot;: &quot;5&quot;,
      &quot;random_score&quot;: {},
      &quot;boost_mode&quot;: &quot;multiply&quot;
    }
  }
}
</code></pre></div><p>ä½¿ç”¨è„šæœ¬è‡ªå®šä¹‰è¯„åˆ†å…¬å¼ï¼Œè¿™é‡ŒæŠŠ price å€¼çš„ååˆ†ä¹‹ä¸€å¼€æ–¹ä½œä¸ºæ¯ä¸ªæ–‡æ¡£çš„å¾—åˆ†ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
  &quot;query&quot;: {
    &quot;function_score&quot;: {
      &quot;query&quot;: {
        &quot;match&quot;: {
          &quot;title&quot;: &quot;java&quot;
        }
      },
      &quot;script_score&quot;: {
        &quot;inline&quot;: &quot;Math.sqrt(doc['price'].value/10)&quot;
      }
    }
  }
}
</code></pre></div><p>å…³äº function_score çš„æ›´å¤šè¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹ <a href="https://www.knowledgedict.com/tutorial/elasticsearch-function_score.html" target="_blank" rel="noopener noreferrer">Elasticsearch function_score æŸ¥è¯¢æœ€å¼ºè¯¦è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <h3 id="_3-6-indices-query"><a href="#_3-6-indices-query" class="header-anchor">#</a> 3.6. indices query</h3> <p>indices query é€‚ç”¨äºéœ€è¦åœ¨å¤šä¸ªç´¢å¼•ä¹‹é—´è¿›è¡ŒæŸ¥è¯¢çš„åœºæ™¯ï¼Œå®ƒå…è®¸æŒ‡å®šä¸€ä¸ªç´¢å¼•åå­—åˆ—è¡¨å’Œå†…éƒ¨æŸ¥è¯¢ã€‚indices query ä¸­æœ‰ query å’Œ no_match_query ä¸¤éƒ¨åˆ†ï¼Œquery ä¸­ç”¨äºæœç´¢æŒ‡å®šç´¢å¼•åˆ—è¡¨ä¸­çš„æ–‡æ¡£ï¼Œno_match_query ä¸­çš„æŸ¥è¯¢æ¡ä»¶ç”¨äºæœç´¢æŒ‡å®šç´¢å¼•åˆ—è¡¨ä¹‹å¤–çš„æ–‡æ¡£ã€‚ä¸‹é¢çš„æŸ¥è¯¢è¯­å¥å®ç°äº†æœç´¢ç´¢å¼• booksã€books2 ä¸­ title å­—æ®µåŒ…å«å…³é”®å­— javascriptï¼Œå…¶ä»–ç´¢å¼•ä¸­ title å­—æ®µåŒ…å« basketball çš„æ–‡æ¡£ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
	&quot;query&quot;: {
		&quot;indices&quot;: {
			&quot;indices&quot;: [&quot;books&quot;, &quot;books2&quot;],
			&quot;query&quot;: {
				&quot;match&quot;: {
					&quot;title&quot;: &quot;javascript&quot;
				}
			},
			&quot;no_match_query&quot;: {
				&quot;term&quot;: {
					&quot;title&quot;: &quot;basketball&quot;
				}
			}
		}
	}
}
</code></pre></div><h2 id="_4-åµŒå¥—æŸ¥è¯¢"><a href="#_4-åµŒå¥—æŸ¥è¯¢" class="header-anchor">#</a> 4. åµŒå¥—æŸ¥è¯¢</h2> <p>åœ¨ Elasticsearch è¿™æ ·çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ‰§è¡Œå…¨ SQL é£æ ¼çš„è¿æ¥æŸ¥è¯¢ä»£ä»·æ˜‚è´µï¼Œæ˜¯ä¸å¯è¡Œçš„ã€‚ç›¸åº”åœ°ï¼Œä¸ºäº†å®ç°æ°´å¹³è§„æ¨¡åœ°æ‰©å±•ï¼ŒElasticsearch æä¾›äº†ä»¥ä¸‹ä¸¤ç§å½¢å¼çš„ joinï¼š</p> <ul><li><p>nested queryï¼ˆåµŒå¥—æŸ¥è¯¢ï¼‰</p> <p>æ–‡æ¡£ä¸­å¯èƒ½åŒ…å«åµŒå¥—ç±»å‹çš„å­—æ®µï¼Œè¿™äº›å­—æ®µç”¨æ¥ç´¢å¼•ä¸€äº›æ•°ç»„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€æ¡ç‹¬ç«‹çš„æ–‡æ¡£è¢«æŸ¥è¯¢å‡ºæ¥ã€‚</p></li> <li><p>has_child queryï¼ˆæœ‰å­æŸ¥è¯¢ï¼‰å’Œ has_parent queryï¼ˆæœ‰çˆ¶æŸ¥è¯¢ï¼‰</p> <p>çˆ¶å­å…³ç³»å¯ä»¥å­˜åœ¨å•ä¸ªçš„ç´¢å¼•çš„ä¸¤ä¸ªç±»å‹çš„æ–‡æ¡£ä¹‹é—´ã€‚has_child æŸ¥è¯¢å°†è¿”å›å…¶å­æ–‡æ¡£èƒ½æ»¡è¶³ç‰¹å®šæŸ¥è¯¢çš„çˆ¶æ–‡æ¡£ï¼Œè€Œ has_parent åˆ™è¿”å›å…¶çˆ¶æ–‡æ¡£èƒ½æ»¡è¶³ç‰¹å®šæŸ¥è¯¢çš„å­æ–‡æ¡£ã€‚</p></li></ul> <h3 id="_4-1-nested-query"><a href="#_4-1-nested-query" class="header-anchor">#</a> 4.1. nested query</h3> <p>æ–‡æ¡£ä¸­å¯èƒ½åŒ…å«åµŒå¥—ç±»å‹çš„å­—æ®µï¼Œè¿™äº›å­—æ®µç”¨æ¥ç´¢å¼•ä¸€äº›æ•°ç»„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€æ¡ç‹¬ç«‹çš„æ–‡æ¡£è¢«æŸ¥è¯¢å‡ºæ¥ï¼ˆç”¨åµŒå¥—æŸ¥è¯¢ï¼‰ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>PUT /my_index
{
	&quot;mappings&quot;: {
		&quot;type1&quot;: {
			&quot;properties&quot;: {
				&quot;obj1&quot;: {
					&quot;type&quot;: &quot;nested&quot;
				}
			}
		}
	}
}
</code></pre></div><h3 id="_4-2-has-child-query"><a href="#_4-2-has-child-query" class="header-anchor">#</a> 4.2. has_child query</h3> <p>æ–‡æ¡£çš„çˆ¶å­å…³ç³»åˆ›å»ºç´¢å¼•æ—¶åœ¨æ˜ å°„ä¸­å£°æ˜ï¼Œè¿™é‡Œä»¥å‘˜å·¥ï¼ˆemployeeï¼‰å’Œå·¥ä½œåŸå¸‚ï¼ˆbranchï¼‰ä¸ºä¾‹ï¼Œå®ƒä»¬å±äºä¸åŒçš„ç±»å‹ï¼Œç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸¤å¼ è¡¨ï¼Œå¦‚æœæƒ³æŠŠå‘˜å·¥å’Œä»–ä»¬å·¥ä½œçš„åŸå¸‚å…³è”èµ·æ¥ï¼Œéœ€è¦å‘Šè¯‰ Elasticsearch æ–‡æ¡£ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œè¿™é‡Œ employee æ˜¯ child typeï¼Œbranch æ˜¯ parent typeï¼Œåœ¨æ˜ å°„ä¸­å£°æ˜ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>PUT /company
{
	&quot;mappings&quot;: {
		&quot;branch&quot;: {},
		&quot;employee&quot;: {
			&quot;parent&quot;: { &quot;type&quot;: &quot;branch&quot; }
		}
	}
}
</code></pre></div><p>ä½¿ç”¨ bulk api ç´¢å¼• branch ç±»å‹ä¸‹çš„æ–‡æ¡£ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>POST company/branch/_bulk
{ &quot;index&quot;: { &quot;_id&quot;: &quot;london&quot; }}
{ &quot;name&quot;: &quot;London Westminster&quot;,&quot;city&quot;: &quot;London&quot;,&quot;country&quot;: &quot;UK&quot; }
{ &quot;index&quot;: { &quot;_id&quot;: &quot;liverpool&quot; }}
{ &quot;name&quot;: &quot;Liverpool Central&quot;,&quot;city&quot;: &quot;Liverpool&quot;,&quot;country&quot;: &quot;UK&quot; }
{ &quot;index&quot;: { &quot;_id&quot;: &quot;paris&quot; }}
{ &quot;name&quot;: &quot;Champs Elysees&quot;,&quot;city&quot;: &quot;Paris&quot;,&quot;country&quot;: &quot;France&quot; }
</code></pre></div><p>æ·»åŠ å‘˜å·¥æ•°æ®ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>POST company/employee/_bulk
{ &quot;index&quot;: { &quot;_id&quot;: 1,&quot;parent&quot;:&quot;london&quot; }}
{ &quot;name&quot;: &quot;Alice Smith&quot;,&quot;dob&quot;: &quot;1970-10-24&quot;,&quot;hobby&quot;: &quot;hiking&quot; }
{ &quot;index&quot;: { &quot;_id&quot;: 2,&quot;parent&quot;:&quot;london&quot; }}
{ &quot;name&quot;: &quot;Mark Tomas&quot;,&quot;dob&quot;: &quot;1982-05-16&quot;,&quot;hobby&quot;: &quot;diving&quot; }
{ &quot;index&quot;: { &quot;_id&quot;: 3,&quot;parent&quot;:&quot;liverpool&quot; }}
{ &quot;name&quot;: &quot;Barry Smith&quot;,&quot;dob&quot;: &quot;1979-04-01&quot;,&quot;hobby&quot;: &quot;hiking&quot; }
{ &quot;index&quot;: { &quot;_id&quot;: 4,&quot;parent&quot;:&quot;paris&quot; }}
{ &quot;name&quot;: &quot;Adrien Grand&quot;,&quot;dob&quot;: &quot;1987-05-11&quot;,&quot;hobby&quot;: &quot;horses&quot; }
</code></pre></div><p>é€šè¿‡å­æ–‡æ¡£æŸ¥è¯¢çˆ¶æ–‡æ¡£è¦ä½¿ç”¨ has_child æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œæœç´¢ 1980 å¹´ä»¥åå‡ºç”Ÿçš„å‘˜å·¥æ‰€åœ¨çš„åˆ†æ”¯æœºæ„ï¼Œemployee ä¸­ 1980 å¹´ä»¥åå‡ºç”Ÿçš„æœ‰ Mark Thomas å’Œ Adrien Grandï¼Œä»–ä»¬åˆ†åˆ«åœ¨ london å’Œ parisï¼Œæ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET company/branch/_search
{
	&quot;query&quot;: {
		&quot;has_child&quot;: {
			&quot;type&quot;: &quot;employee&quot;,
			&quot;query&quot;: {
				&quot;range&quot;: { &quot;dob&quot;: { &quot;gte&quot;: &quot;1980-01-01&quot; } }
			}
		}
	}
}
</code></pre></div><p>æœç´¢å“ªäº›æœºæ„ä¸­æœ‰åä¸º â€œAlice Smithâ€ çš„å‘˜å·¥ï¼Œå› ä¸ºä½¿ç”¨ match æŸ¥è¯¢ï¼Œä¼šè§£æä¸º â€œAliceâ€ å’Œ â€œSmithâ€ï¼Œæ‰€ä»¥ Alice Smith å’Œ Barry Smith æ‰€åœ¨çš„æœºæ„ä¼šè¢«åŒ¹é…ï¼Œæ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET company/branch/_search
{
	&quot;query&quot;: {
		&quot;has_child&quot;: {
			&quot;type&quot;: &quot;employee&quot;,
			&quot;score_mode&quot;: &quot;max&quot;,
			&quot;query&quot;: {
				&quot;match&quot;: { &quot;name&quot;: &quot;Alice Smith&quot; }
			}
		}
	}
}
</code></pre></div><p>å¯ä»¥ä½¿ç”¨ min_children æŒ‡å®šå­æ–‡æ¡£çš„æœ€å°ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œæœç´¢æœ€å°‘å«æœ‰ä¸¤ä¸ª employee çš„æœºæ„ï¼ŒæŸ¥è¯¢å‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET company/branch/_search?pretty
{
	&quot;query&quot;: {
		&quot;has_child&quot;: {
			&quot;type&quot;: &quot;employee&quot;,
			&quot;min_children&quot;: 2,
			&quot;query&quot;: {
				&quot;match_all&quot;: {}
			}
		}
	}
}
</code></pre></div><h3 id="_4-3-has-parent-query"><a href="#_4-3-has-parent-query" class="header-anchor">#</a> 4.3. has_parent query</h3> <p>é€šè¿‡çˆ¶æ–‡æ¡£æŸ¥è¯¢å­æ–‡æ¡£ä½¿ç”¨ has_parent æŸ¥è¯¢ã€‚æ¯”å¦‚ï¼Œæœç´¢å“ªäº› employee å·¥ä½œåœ¨ UKï¼ŒæŸ¥è¯¢å‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET company/employee/_search
{
	&quot;query&quot;: {
		&quot;has_parent&quot;: {
			&quot;parent_type&quot;: &quot;branch&quot;,
			&quot;query&quot;: {
				&quot;match&quot;: { &quot;country&quot;: &quot;UK }
			}
		}
	}
}
</code></pre></div><h2 id="_5-ä½ç½®æŸ¥è¯¢"><a href="#_5-ä½ç½®æŸ¥è¯¢" class="header-anchor">#</a> 5. ä½ç½®æŸ¥è¯¢</h2> <p>Elasticsearch å¯ä»¥å¯¹åœ°ç†ä½ç½®ç‚¹ geo_point ç±»å‹å’Œåœ°ç†ä½ç½®å½¢çŠ¶ geo_shape ç±»å‹çš„æ•°æ®è¿›è¡Œæœç´¢ã€‚ä¸ºäº†å­¦ä¹ æ–¹ä¾¿ï¼Œè¿™é‡Œå‡†å¤‡ä¸€äº›åŸå¸‚çš„åœ°ç†åæ ‡ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œæ¯ä¸€æ¡æ–‡æ¡£éƒ½åŒ…å«åŸå¸‚åç§°å’Œåœ°ç†åæ ‡è¿™ä¸¤ä¸ªå­—æ®µï¼Œè¿™é‡Œçš„åæ ‡ç‚¹å–çš„æ˜¯å„ä¸ªåŸå¸‚ä¸­å¿ƒçš„ä¸€ä¸ªä½ç½®ã€‚é¦–å…ˆæŠŠä¸‹é¢çš„å†…å®¹ä¿å­˜åˆ° geo.json æ–‡ä»¶ä¸­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>{&quot;index&quot;:{ &quot;_index&quot;:&quot;geo&quot;,&quot;_type&quot;:&quot;city&quot;,&quot;_id&quot;:&quot;1&quot; }}
{&quot;name&quot;:&quot;åŒ—äº¬&quot;,&quot;location&quot;:&quot;39.9088145109,116.3973999023&quot;}
{&quot;index&quot;:{ &quot;_index&quot;:&quot;geo&quot;,&quot;_type&quot;:&quot;city&quot;,&quot;_id&quot;: &quot;2&quot; }}
{&quot;name&quot;:&quot;ä¹Œé²æœ¨é½&quot;,&quot;location&quot;:&quot;43.8266300000,87.6168800000&quot;}
{&quot;index&quot;:{ &quot;_index&quot;:&quot;geo&quot;,&quot;_type&quot;:&quot;city&quot;,&quot;_id&quot;:&quot;3&quot; }}
{&quot;name&quot;:&quot;è¥¿å®‰&quot;,&quot;location&quot;:&quot;34.3412700000,108.9398400000&quot;}
{&quot;index&quot;:{ &quot;_index&quot;:&quot;geo&quot;,&quot;_type&quot;:&quot;city&quot;,&quot;_id&quot;:&quot;4&quot; }}
{&quot;name&quot;:&quot;éƒ‘å·&quot;,&quot;location&quot;:&quot;34.7447157466,113.6587142944&quot;}
{&quot;index&quot;:{ &quot;_index&quot;:&quot;geo&quot;,&quot;_type&quot;:&quot;city&quot;,&quot;_id&quot;:&quot;5&quot; }}
{&quot;name&quot;:&quot;æ­å·&quot;,&quot;location&quot;:&quot;30.2294080260,120.1492309570&quot;}
{&quot;index&quot;:{ &quot;_index&quot;:&quot;geo&quot;,&quot;_type&quot;:&quot;city&quot;,&quot;_id&quot;:&quot;6&quot; }}
{&quot;name&quot;:&quot;æµå—&quot;,&quot;location&quot;:&quot;36.6518400000,117.1200900000&quot;}
</code></pre></div><p>åˆ›å»ºä¸€ä¸ªç´¢å¼•å¹¶è®¾ç½®æ˜ å°„ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>PUT geo
{
	&quot;mappings&quot;: {
		&quot;city&quot;: {
			&quot;properties&quot;: {
				&quot;name&quot;: {
					&quot;type&quot;: &quot;keyword&quot;
				},
				&quot;location&quot;: {
					&quot;type&quot;: &quot;geo_point&quot;
				}
			}
		}
	}
}
</code></pre></div><p>ç„¶åæ‰§è¡Œæ‰¹é‡å¯¼å…¥å‘½ä»¤ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>curl -XPOST &quot;http://localhost:9200/_bulk?pretty&quot; --data-binary @geo.json
</code></pre></div><h3 id="_5-1-geo-distance-query"><a href="#_5-1-geo-distance-query" class="header-anchor">#</a> 5.1. geo_distance query</h3> <p>geo_distance query å¯ä»¥æŸ¥æ‰¾åœ¨ä¸€ä¸ªä¸­å¿ƒç‚¹æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ç‚¹æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾è·ç¦»å¤©æ´¥ 200km ä»¥å†…çš„åŸå¸‚ï¼Œæœç´¢ç»“æœä¸­ä¼šè¿”å›åŒ—äº¬ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET geo/_search
{
	&quot;query&quot;: {
		&quot;bool&quot;: {
			&quot;must&quot;: {
				&quot;match_all&quot;: {}
			},
			&quot;filter&quot;: {
				&quot;geo_distance&quot;: {
					&quot;distance&quot;: &quot;200km&quot;,
					&quot;location&quot;: {
						&quot;lat&quot;: 39.0851000000,
						&quot;lon&quot;: 117.1993700000
					}
				}
			}
		}
	}
}
</code></pre></div><p>æŒ‰å„åŸå¸‚ç¦»åŒ—äº¬çš„è·ç¦»æ’åºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET geo/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;sort&quot;: [{
    &quot;_geo_distance&quot;: {
      &quot;location&quot;: &quot;39.9088145109,116.3973999023&quot;,
      &quot;unit&quot;: &quot;km&quot;,
      &quot;order&quot;: &quot;asc&quot;,
      &quot;distance_type&quot;: &quot;plane&quot;
    }
  }]
}
</code></pre></div><p>å…¶ä¸­ location å¯¹åº”çš„ç»çº¬åº¦å­—æ®µï¼›unit ä¸º <code>km</code> è¡¨ç¤ºå°†è·ç¦»ä»¥ <code>km</code> ä¸ºå•ä½å†™å…¥åˆ°æ¯ä¸ªè¿”å›ç»“æœçš„ sort é”®ä¸­ï¼›distance_type ä¸º <code>plane</code> è¡¨ç¤ºä½¿ç”¨å¿«é€Ÿä½†ç²¾åº¦ç•¥å·®çš„ <code>plane</code> è®¡ç®—æ–¹å¼ã€‚</p> <h3 id="_5-2-geo-bounding-box-query"><a href="#_5-2-geo-bounding-box-query" class="header-anchor">#</a> 5.2. geo_bounding_box query</h3> <p>geo_bounding_box query ç”¨äºæŸ¥æ‰¾è½å…¥æŒ‡å®šçš„çŸ©å½¢å†…çš„åœ°ç†åæ ‡ã€‚æŸ¥è¯¢ä¸­ç”±ä¸¤ä¸ªç‚¹ç¡®å®šä¸€ä¸ªçŸ©å½¢ï¼Œç„¶ååœ¨çŸ©å½¢åŒºåŸŸå†…æŸ¥è¯¢åŒ¹é…çš„æ–‡æ¡£ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>GET geo/_search
{
	&quot;query&quot;: {
		&quot;bool&quot;: {
			&quot;must&quot;: {
				&quot;match_all&quot;: {}
			},
			&quot;filter&quot;: {
				&quot;geo_bounding_box&quot;: {
					&quot;location&quot;: {
						&quot;top_left&quot;: {
							&quot;lat&quot;: 38.4864400000,
							&quot;lon&quot;: 106.2324800000
						},
						&quot;bottom_right&quot;: {
							&quot;lat&quot;: 28.6820200000,
							&quot;lon&quot;: 115.8579400000
						}
					}
				}
			}
		}
	}
}
</code></pre></div><h3 id="_5-3-geo-polygon-query"><a href="#_5-3-geo-polygon-query" class="header-anchor">#</a> 5.3. geo_polygon query</h3> <p>geo_polygon query ç”¨äºæŸ¥æ‰¾åœ¨æŒ‡å®š<strong>å¤šè¾¹å½¢</strong>å†…çš„åœ°ç†ç‚¹ã€‚ä¾‹å¦‚ï¼Œå‘¼å’Œæµ©ç‰¹ã€é‡åº†ã€ä¸Šæµ·ä¸‰åœ°ç»„æˆä¸€ä¸ªä¸‰è§’å½¢ï¼ŒæŸ¥è¯¢ä½ç½®åœ¨è¯¥ä¸‰è§’å½¢åŒºåŸŸå†…çš„åŸå¸‚ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET geo/_search
{
	&quot;query&quot;: {
		&quot;bool&quot;: {
			&quot;must&quot;: {
				&quot;match_all&quot;: {}
			}
		},
		&quot;filter&quot;: {
			&quot;geo_polygon&quot;: {
				&quot;location&quot;: {
					&quot;points&quot;: [{
						&quot;lat&quot;: 40.8414900000,
						&quot;lon&quot;: 111.7519900000
					}, {
						&quot;lat&quot;: 29.5647100000,
						&quot;lon&quot;: 106.5507300000
					}, {
						&quot;lat&quot;: 31.2303700000,
						&quot;lon&quot;: 121.4737000000
					}]
				}
			}
		}
	}
}
</code></pre></div><h3 id="_5-4-geo-shape-query"><a href="#_5-4-geo-shape-query" class="header-anchor">#</a> 5.4. geo_shape query</h3> <p>geo_shape query ç”¨äºæŸ¥è¯¢ geo_shape ç±»å‹çš„åœ°ç†æ•°æ®ï¼Œåœ°ç†å½¢çŠ¶ä¹‹é—´çš„å…³ç³»æœ‰ç›¸äº¤ã€åŒ…å«ã€ä¸ç›¸äº¤ä¸‰ç§ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ç”¨äºæµ‹è¯•ï¼Œå…¶ä¸­ location å­—æ®µçš„ç±»å‹è®¾ä¸º geo_shape ç±»å‹ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>PUT geoshape
{
	&quot;mappings&quot;: {
		&quot;city&quot;: {
			&quot;properties&quot;: {
				&quot;name&quot;: {
					&quot;type&quot;: &quot;keyword&quot;
				},
				&quot;location&quot;: {
					&quot;type&quot;: &quot;geo_shape&quot;
				}
			}
		}
	}
}
</code></pre></div><p>å…³äºç»çº¬åº¦çš„é¡ºåºè¿™é‡Œåšä¸€ä¸ªè¯´æ˜ï¼Œgeo_point ç±»å‹çš„å­—æ®µçº¬åº¦åœ¨å‰ç»åº¦åœ¨åï¼Œä½†æ˜¯å¯¹äº geo_shape ç±»å‹ä¸­çš„ç‚¹ï¼Œæ˜¯ç»åº¦åœ¨å‰çº¬åº¦åœ¨åï¼Œè¿™ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p> <p>æŠŠè¥¿å®‰å’Œéƒ‘å·è¿æˆçš„çº¿å†™å…¥ç´¢å¼•ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>POST geoshape/city/1
{
	&quot;name&quot;: &quot;è¥¿å®‰-éƒ‘å·&quot;,
	&quot;location&quot;: {
		&quot;type&quot;: &quot;linestring&quot;,
		&quot;coordinates&quot;: [
			[108.9398400000, 34.3412700000],
			[113.6587142944, 34.7447157466]
		]
	}
}
</code></pre></div><p>æŸ¥è¯¢åŒ…å«åœ¨ç”±é“¶å·å’Œå—æ˜Œä½œä¸ºå¯¹è§’çº¿ä¸Šçš„ç‚¹ç»„æˆçš„çŸ©å½¢çš„åœ°ç†å½¢çŠ¶ï¼Œç”±äºè¥¿å®‰å’Œéƒ‘å·ç»„æˆçš„ç›´çº¿è½åœ¨è¯¥çŸ©å½¢åŒºåŸŸå†…ï¼Œå› æ­¤å¯ä»¥è¢«æŸ¥è¯¢åˆ°ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET geoshape/_search
{
	&quot;query&quot;: {
		&quot;bool&quot;: {
			&quot;must&quot;: {
				&quot;match_all&quot;: {}
			},
			&quot;filter&quot;: {
				&quot;geo_shape&quot;: {
					&quot;location&quot;: {
						&quot;shape&quot;: {
							&quot;type&quot;: &quot;envelope&quot;,
							&quot;coordinates&quot;: [
								[106.23248, 38.48644],
								[115.85794, 28.68202]
							]
						},
						&quot;relation&quot;: &quot;within&quot;
					}
				}
			}
		}
	}
}
</code></pre></div><h2 id="_6-ç‰¹æ®ŠæŸ¥è¯¢"><a href="#_6-ç‰¹æ®ŠæŸ¥è¯¢" class="header-anchor">#</a> 6. ç‰¹æ®ŠæŸ¥è¯¢</h2> <h3 id="_6-1-more-like-this-query"><a href="#_6-1-more-like-this-query" class="header-anchor">#</a> 6.1. more_like_this query</h3> <p>more_like_this query å¯ä»¥æŸ¥è¯¢å’Œæä¾›æ–‡æœ¬ç±»ä¼¼çš„æ–‡æ¡£ï¼Œé€šå¸¸ç”¨äºè¿‘ä¼¼æ–‡æœ¬çš„æ¨èç­‰åœºæ™¯ã€‚æŸ¥è¯¢å‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
	&quot;query&quot;: {
		&quot;more_like_ this&quot;: {
			&quot;fields&quot;: [&quot;title&quot;, &quot;description&quot;],
			&quot;like&quot;: &quot;java virtual machine&quot;,
			&quot;min_term_freq&quot;: 1,
			&quot;max_query_terms&quot;: 12
		}
	}
}
</code></pre></div><p>å¯é€‰çš„å‚æ•°åŠå–å€¼è¯´æ˜å¦‚ä¸‹ï¼š</p> <ul><li>fields è¦åŒ¹é…çš„å­—æ®µï¼Œé»˜è®¤æ˜¯ _all å­—æ®µã€‚</li> <li>like è¦åŒ¹é…çš„æ–‡æœ¬ã€‚</li> <li>min_term_freq æ–‡æ¡£ä¸­è¯é¡¹çš„æœ€ä½é¢‘ç‡ï¼Œé»˜è®¤æ˜¯ 2ï¼Œä½äºæ­¤é¢‘ç‡çš„æ–‡æ¡£ä¼šè¢«å¿½ç•¥ã€‚</li> <li>max_query_terms query ä¸­èƒ½åŒ…å«çš„æœ€å¤§è¯é¡¹æ•°ç›®ï¼Œé»˜è®¤ä¸º 25ã€‚</li> <li>min_doc_freq æœ€å°çš„æ–‡æ¡£é¢‘ç‡ï¼Œé»˜è®¤ä¸º 5ã€‚</li> <li>max_doc_freq æœ€å¤§æ–‡æ¡£é¢‘ç‡ã€‚</li> <li>min_word length å•è¯çš„æœ€å°é•¿åº¦ã€‚</li> <li>max_word length å•è¯çš„æœ€å¤§é•¿åº¦ã€‚</li> <li>stop_words åœç”¨è¯åˆ—è¡¨ã€‚</li> <li>analyzer åˆ†è¯å™¨ã€‚</li> <li>minimum_should_match æ–‡æ¡£åº”åŒ¹é…çš„æœ€å°è¯é¡¹æ•°ï¼Œé»˜è®¤ä¸º query åˆ†è¯åè¯é¡¹æ•°çš„ 30%ã€‚</li> <li>boost terms è¯é¡¹çš„æƒé‡ã€‚</li> <li>include æ˜¯å¦æŠŠè¾“å…¥æ–‡æ¡£ä½œä¸ºç»“æœè¿”å›ã€‚</li> <li>boost æ•´ä¸ª query çš„æƒé‡ï¼Œé»˜è®¤ä¸º 1.0ã€‚</li></ul> <h3 id="_6-2-script-query"><a href="#_6-2-script-query" class="header-anchor">#</a> 6.2. script query</h3> <p>Elasticsearch æ”¯æŒä½¿ç”¨è„šæœ¬è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ä»·æ ¼å¤§äº 180 çš„æ–‡æ¡£ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET books/_search
{
  &quot;query&quot;: {
    &quot;script&quot;: {
      &quot;script&quot;: {
        &quot;inline&quot;: &quot;doc['price'].value &gt; 180&quot;,
        &quot;lang&quot;: &quot;painless&quot;
      }
    }
  }
}
</code></pre></div><h3 id="_6-3-percolate-query"><a href="#_6-3-percolate-query" class="header-anchor">#</a> 6.3. percolate query</h3> <p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å…ˆæŠŠæ–‡æ¡£å†™å…¥åˆ° Elasticsearch ä¸­ï¼Œé€šè¿‡æŸ¥è¯¢è¯­å¥å¯¹æ–‡æ¡£è¿›è¡Œæœç´¢ã€‚percolate query åˆ™æ˜¯åå…¶é“è€Œè¡Œä¹‹çš„åšæ³•ï¼Œå®ƒä¼šå…ˆæ³¨å†ŒæŸ¥è¯¢æ¡ä»¶ï¼Œæ ¹æ®æ–‡æ¡£æ¥æŸ¥è¯¢ queryã€‚ä¾‹å¦‚ï¼Œåœ¨ my-index ç´¢å¼•ä¸­æœ‰ä¸€ä¸ª laptop ç±»å‹ï¼Œæ–‡æ¡£æœ‰ price å’Œ name ä¸¤ä¸ªå­—æ®µï¼Œåœ¨æ˜ å°„ä¸­å£°æ˜ä¸€ä¸ª percolator ç±»å‹çš„ queryï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index
{
	&quot;mappings&quot;: {
		&quot;laptop&quot;: {
			&quot;properties&quot;: {
				&quot;price&quot;: { &quot;type&quot;: &quot;long&quot; },
				&quot;name&quot;: { &quot;type&quot;: &quot;text&quot; }
			},
			&quot;queries&quot;: {
				&quot;properties&quot;: {
					&quot;query&quot;: { &quot;type&quot;: &quot;percolator&quot; }
				}
			}
		}
	}
}
</code></pre></div><p>æ³¨å†Œä¸€ä¸ª bool queryï¼Œbool query ä¸­åŒ…å«ä¸€ä¸ª range queryï¼Œè¦æ±‚ price å­—æ®µçš„å–å€¼å°äºç­‰äº 10000ï¼Œå¹¶ä¸” name å­—æ®µä¸­å«æœ‰å…³é”®è¯ macbookï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>PUT /my-index/queries/1?refresh
{
	&quot;query&quot;: {
		&quot;bool&quot;: {
			&quot;must&quot;: [{
				&quot;range&quot;: { &quot;price&quot;: { &quot;lte&quot;: 10000 } }
			}, {
				&quot;match&quot;: { &quot;name&quot;: &quot;macbook&quot; }
			}]
		}
	}
}
</code></pre></div><p>é€šè¿‡æ–‡æ¡£æŸ¥è¯¢ queryï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>GET /my-index/_search
{
	&quot;query&quot;: {
		&quot;percolate&quot;: {
			&quot;field&quot;: &quot;query&quot;,
			&quot;document_type&quot;: &quot;laptop&quot;,
			&quot;document&quot;: {
				&quot;price&quot;: 9999,
				&quot;name&quot;: &quot;macbook pro on sale&quot;
			}
		}
	}
}
</code></pre></div><p>æ–‡æ¡£ç¬¦åˆ query ä¸­çš„æ¡ä»¶ï¼Œè¿”å›ç»“æœä¸­å¯ä»¥æŸ¥åˆ°ä¸Šæ–‡ä¸­æ³¨å†Œçš„ bool queryã€‚percolate query çš„è¿™ç§ç‰¹æ€§é€‚ç”¨äºæ•°æ®åˆ†ç±»ã€æ•°æ®è·¯ç”±ã€äº‹ä»¶ç›‘æ§å’Œé¢„è­¦ç­‰åœºæ™¯ã€‚</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/db-tutorial/edit/master/docs/nosql/elasticsearch/ElasticsearchæŸ¥è¯¢.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">3 days ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/db-tutorial/assets/js/app.3241dbe7.js" defer></script><script src="/db-tutorial/assets/js/4.4288f8e2.js" defer></script><script src="/db-tutorial/assets/js/21.bb9e859e.js" defer></script><script src="/db-tutorial/assets/js/5.9d6e4fe2.js" defer></script>
  </body>
</html>
